(self["webpackChunksuperhero_wallet"]=self["webpackChunksuperhero_wallet"]||[]).push([[8563],{50448:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CLIENT_CONTEXT:()=>vu,CLIENT_STORAGE_OPTIONS:()=>Eu,CLIENT_STORAGE_PREFIX:()=>_u,IWalletKit:()=>xu,IWalletKitEngine:()=>Pu,IWalletKitEvents:()=>Su,PROTOCOL:()=>wu,PROTOCOL_VERSION:()=>bu,REQUEST_CONTEXT:()=>Iu,WalletKit:()=>Mu,default:()=>$u});var i=n(37007),r=n.n(i),s=n(93532),o=n(55669),a=n(29838),c=n(72225),h=n(88900),l=n(13554),u=n(38236),p=n(48468),d=n(38196),g=n(42063),f=n(31027),y=n(76271),m=n(86729),w=n(43228),b=n(65606),v=n(48287)["Buffer"];const _=":";function E(e){const[t,n]=e.split(_);return{namespace:t,reference:n}}function I(e,t){return e.includes(":")?[e]:t.chains||[]}const S="ReactNative",x={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},P="js";function R(){return typeof b<"u"&&typeof b.versions<"u"&&typeof b.versions.node<"u"}function O(){return!(0,d.getDocument)()&&!!(0,d.getNavigator)()&&navigator.product===S}function T(){return O()&&typeof n.g<"u"&&typeof(null==n.g?void 0:n.g.Platform)<"u"&&"android"===(null==n.g?void 0:n.g.Platform.OS)}function k(){return O()&&typeof n.g<"u"&&typeof(null==n.g?void 0:n.g.Platform)<"u"&&"ios"===(null==n.g?void 0:n.g.Platform.OS)}function A(){return!R()&&!!(0,d.getNavigator)()&&!!(0,d.getDocument)()}function N(){return O()?x.reactNative:R()?x.node:A()?x.browser:x.unknown}function C(){var e;try{return O()&&typeof n.g<"u"&&typeof(null==n.g?void 0:n.g.Application)<"u"?null==(e=n.g.Application)?void 0:e.applicationId:void 0}catch{return}}function q(e,t){const n=new URLSearchParams(e);for(const i of Object.keys(t).sort())if(t.hasOwnProperty(i)){const e=t[i];void 0!==e&&n.set(i,e)}return n.toString()}function D(){return(0,g.g)()||{name:"",description:"",url:"",icons:[""]}}function L(){if(N()===x.reactNative&&typeof n.g<"u"&&typeof(null==n.g?void 0:n.g.Platform)<"u"){const{OS:e,Version:t}=n.g.Platform;return[e,t].join("-")}const e=(0,p.o0)();if(null===e)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return"browser"===e.type?[t,e.name,e.version].join("-"):[t,e.version].join("-")}function U(){var e;const t=N();return t===x.browser?[t,(null==(e=(0,d.getLocation)())?void 0:e.host)||"unknown"].join(":"):t}function j(e,t,n){const i=L(),r=U();return[[e,t].join("-"),[P,n].join("-"),i,r].join("/")}function $({protocol:e,version:t,relayUrl:n,sdkVersion:i,auth:r,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const h=n.split("?"),l=j(e,t,i),u={auth:r,ua:l,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},p=q(h[1]||"",u);return h[0]+"?"+p}function M(e,t){return e.filter((e=>t.includes(e))).length===e.length}function K(e){return Object.fromEntries(e.entries())}function z(e){return new Map(Object.entries(e))}function B(e=h.FIVE_MINUTES,t){const n=(0,h.toMiliseconds)(e||h.FIVE_MINUTES);let i,r,s,o;return{resolve:e=>{s&&i&&(clearTimeout(s),i(e),o=Promise.resolve(e))},reject:e=>{s&&r&&(clearTimeout(s),r(e))},done:()=>new Promise(((e,a)=>{if(o)return e(o);s=setTimeout((()=>{const e=new Error(t);o=Promise.reject(e),a(e)}),n),i=e,r=a}))}}function V(e,t,n){return new Promise((async(i,r)=>{const s=setTimeout((()=>r(new Error(n))),t);try{const t=await e;i(t)}catch(o){r(o)}clearTimeout(s)}))}function F(e,t){if("string"==typeof t&&t.startsWith(`${e}:`))return t;if("topic"===e.toLowerCase()){if("string"!=typeof t)throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}if("id"===e.toLowerCase()){if("number"!=typeof t)throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${e}`)}function H(e){return F("topic",e)}function G(e){return F("id",e)}function J(e){const[t,n]=e.split(":"),i={id:void 0,topic:void 0};if("topic"===t&&"string"==typeof n)i.topic=n;else{if("id"!==t||!Number.isInteger(Number(n)))throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${n}`);i.id=Number(n)}return i}function Q(e,t){return(0,h.fromMiliseconds)((t||Date.now())+(0,h.toMiliseconds)(e))}function W(e){return Date.now()>=(0,h.toMiliseconds)(e)}function Y(e,t){return`${e}${t?`:${t}`:""}`}function Z(e=[],t=[]){return[...new Set([...e,...t])]}async function X({id:e,topic:t,wcDeepLink:i}){var r;try{if(!i)return;const s="string"==typeof i?JSON.parse(i):i,o=s?.href;if("string"!=typeof o)return;const a=ee(o,e,t),c=N();if(c===x.browser){if(null==(r=(0,d.getDocument)())||!r.hasFocus())return void console.warn("Document does not have focus, skipping deeplink.");te(a)}else c===x.reactNative&&typeof(null==n.g?void 0:n.g.Linking)<"u"&&await n.g.Linking.openURL(a)}catch(iu){console.error(iu)}}function ee(e,t,n){const i=`requestId=${t}&sessionTopic=${n}`;e.endsWith("/")&&(e=e.slice(0,-1));let r=`${e}`;if(e.startsWith("https://t.me")){const t=e.includes("?")?"&startapp=":"?startapp=";r=`${r}${t}${ce(i,!0)}`}else r=`${r}/wc?${i}`;return r}function te(e){let t="_self";ae()?t="_top":(oe()||e.startsWith("https://")||e.startsWith("http://"))&&(t="_blank"),window.open(e,t,"noreferrer noopener")}async function ne(e,t){let n="";try{if(A()&&(n=localStorage.getItem(t),n))return n;n=await e.getItem(t)}catch(i){console.error(i)}return n}function ie(e,t){if(!e.includes(t))return null;const n=e.split(/([&,?,=])/),i=n.indexOf(t);return n[i+2]}function re(){return typeof crypto<"u"&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function se(){return typeof b<"u"&&"true"===b.env.IS_VITEST}function oe(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function ae(){try{return window.self!==window.top}catch{return!1}}function ce(e,t=!1){const n=v.from(e).toString("base64");return t?n.replace(/[=]/g,""):n}function he(e){return v.from(e,"base64").toString("utf-8")}function le(e){return new Promise((t=>setTimeout(t,e)))}function ue(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function pe(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function de(e,...t){if(!pe(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ge(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");ue(e.outputLen),ue(e.blockLen)}function fe(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ye(e,t){de(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const me=BigInt(2**32-1),we=BigInt(32);function be(e,t=!1){return t?{h:Number(e&me),l:Number(e>>we&me)}:{h:0|Number(e>>we&me),l:0|Number(e&me)}}function ve(e,t=!1){let n=new Uint32Array(e.length),i=new Uint32Array(e.length);for(let r=0;r<e.length;r++){const{h:s,l:o}=be(e[r],t);[n[r],i[r]]=[s,o]}return[n,i]}const _e=(e,t,n)=>e<<n|t>>>32-n,Ee=(e,t,n)=>t<<n|e>>>32-n,Ie=(e,t,n)=>t<<n-32|e>>>64-n,Se=(e,t,n)=>e<<n-32|t>>>64-n,xe="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function Pe(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Re(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Oe(e,t){return e<<32-t|e>>>t}const Te=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function ke(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function Ae(e){for(let t=0;t<e.length;t++)e[t]=ke(e[t])}function Ne(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}function Ce(e){return"string"==typeof e&&(e=Ne(e)),de(e),e}class qe{clone(){return this._cloneInto()}}function De(e){const t=t=>e().update(Ce(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Le(e=32){if(xe&&"function"==typeof xe.getRandomValues)return xe.getRandomValues(new Uint8Array(e));if(xe&&"function"==typeof xe.randomBytes)return xe.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}const Ue=[],je=[],$e=[],Me=BigInt(0),Ke=BigInt(1),ze=BigInt(2),Be=BigInt(7),Ve=BigInt(256),Fe=BigInt(113);for(let Ku=0,zu=Ke,Bu=1,Vu=0;Ku<24;Ku++){[Bu,Vu]=[Vu,(2*Bu+3*Vu)%5],Ue.push(2*(5*Vu+Bu)),je.push((Ku+1)*(Ku+2)/2%64);let e=Me;for(let t=0;t<7;t++)zu=(zu<<Ke^(zu>>Be)*Fe)%Ve,zu&ze&&(e^=Ke<<(Ke<<BigInt(t))-Ke);$e.push(e)}const[He,Ge]=ve($e,!0),Je=(e,t,n)=>n>32?Ie(e,t,n):_e(e,t,n),Qe=(e,t,n)=>n>32?Se(e,t,n):Ee(e,t,n);function We(e,t=24){const n=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let i=0;i<10;i++)n[i]=e[i]^e[i+10]^e[i+20]^e[i+30]^e[i+40];for(let i=0;i<10;i+=2){const t=(i+8)%10,r=(i+2)%10,s=n[r],o=n[r+1],a=Je(s,o,1)^n[t],c=Qe(s,o,1)^n[t+1];for(let n=0;n<50;n+=10)e[i+n]^=a,e[i+n+1]^=c}let t=e[2],r=e[3];for(let n=0;n<24;n++){const i=je[n],s=Je(t,r,i),o=Qe(t,r,i),a=Ue[n];t=e[a],r=e[a+1],e[a]=s,e[a+1]=o}for(let i=0;i<50;i+=10){for(let t=0;t<10;t++)n[t]=e[i+t];for(let t=0;t<10;t++)e[i+t]^=~n[(t+2)%10]&n[(t+4)%10]}e[0]^=He[i],e[1]^=Ge[i]}n.fill(0)}class Ye extends qe{constructor(e,t,n,i=!1,r=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=i,this.rounds=r,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,ue(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Pe(this.state)}keccak(){Te||Ae(this.state32),We(this.state32,this.rounds),Te||Ae(this.state32),this.posOut=0,this.pos=0}update(e){fe(this);const{blockLen:t,state:n}=this;e=Ce(e);const i=e.length;for(let r=0;r<i;){const s=Math.min(t-this.pos,i-r);for(let t=0;t<s;t++)n[this.pos++]^=e[r++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:i}=this;e[n]^=t,0!==(128&t)&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){fe(this,!1),de(e),this.finish();const t=this.state,{blockLen:n}=this;for(let i=0,r=e.length;i<r;){this.posOut>=n&&this.keccak();const s=Math.min(n-this.posOut,r-i);e.set(t.subarray(this.posOut,this.posOut+s),i),this.posOut+=s,i+=s}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ue(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ye(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:i,rounds:r,enableXOF:s}=this;return e||(e=new Ye(t,n,i,s,r)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=r,e.suffix=n,e.outputLen=i,e.enableXOF=s,e.destroyed=this.destroyed,e}}const Ze=(e,t,n)=>De((()=>new Ye(t,e,n))),Xe=Ze(1,136,32),et="https://rpc.walletconnect.org/v1";function tt(e){const t=`Ethereum Signed Message:\n${e.length}`,n=(new TextEncoder).encode(t+e);return"0x"+v.from(Xe(n)).toString("hex")}async function nt(e,t,n,i,r,s){switch(n.t){case"eip191":return it(e,t,n.s);case"eip1271":return await rt(e,t,n.s,i,r,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}function it(e,t,n){return(0,f.x_)(tt(t),n).toLowerCase()===e.toLowerCase()}async function rt(e,t,n,i,r,s){const o=E(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const o="0x1626ba7e",a="0000000000000000000000000000000000000000000000000000000000000040",c="0000000000000000000000000000000000000000000000000000000000000041",h=n.substring(2),l=tt(t).substring(2),u=o+l+a+c+h,p=await fetch(`${s||et}/?chainId=${i}&projectId=${r}`,{method:"POST",body:JSON.stringify({id:st(),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:u},"latest"]})}),{result:d}=await p.json();return!!d&&d.slice(0,o.length).toLowerCase()===o.toLowerCase()}catch(Cl){return console.error("isValidEip1271Signature: ",Cl),!1}}function st(){return Date.now()+Math.floor(1e3*Math.random())}var ot=Object.defineProperty,at=Object.defineProperties,ct=Object.getOwnPropertyDescriptors,ht=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,ut=Object.prototype.propertyIsEnumerable,pt=(e,t,n)=>t in e?ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,dt=(e,t)=>{for(var n in t||(t={}))lt.call(t,n)&&pt(e,n,t[n]);if(ht)for(var n of ht(t))ut.call(t,n)&&pt(e,n,t[n]);return e},gt=(e,t)=>at(e,ct(t));const ft="did:pkh:",yt=e=>e?.split(":"),mt=e=>{const t=e&&yt(e);if(t)return e.includes(ft)?t[3]:t[1]},wt=e=>{const t=e&&yt(e);if(t)return t[2]+":"+t[3]},bt=e=>{const t=e&&yt(e);if(t)return t.pop()};async function vt(e){const{cacao:t,projectId:n}=e,{s:i,p:r}=t,s=_t(r,r.iss),o=bt(r.iss);return await nt(o,s,i,wt(r.iss),n)}const _t=(e,t)=>{const n=`${e.domain} wants you to sign in with your Ethereum account:`,i=bt(t);if(!e.aud&&!e.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let r=e.statement||void 0;const s=`URI: ${e.aud||e.uri}`,o=`Version: ${e.version}`,a=`Chain ID: ${mt(t)}`,c=`Nonce: ${e.nonce}`,h=`Issued At: ${e.iat}`,l=e.exp?`Expiration Time: ${e.exp}`:void 0,u=e.nbf?`Not Before: ${e.nbf}`:void 0,p=e.requestId?`Request ID: ${e.requestId}`:void 0,d=e.resources?`Resources:${e.resources.map((e=>`\n- ${e}`)).join("")}`:void 0,g=Lt(e.resources);if(g){const e=Ot(g);r=Ct(r,e)}return[n,i,"",r,"",s,o,a,c,h,l,u,p,d].filter((e=>null!=e)).join("\n")};function Et(e){return v.from(JSON.stringify(e)).toString("base64")}function It(e){return JSON.parse(v.from(e,"base64").toString("utf-8"))}function St(e){if(!e)throw new Error("No recap provided, value is undefined");if(!e.att)throw new Error("No `att` property found");const t=Object.keys(e.att);if(null==t||!t.length)throw new Error("No resources found in `att` property");t.forEach((t=>{const n=e.att[t];if(Array.isArray(n))throw new Error(`Resource must be an object: ${t}`);if("object"!=typeof n)throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(n).forEach((e=>{const t=n[e];if(!Array.isArray(t))throw new Error(`Ability limits ${e} must be an array of objects, found: ${t}`);if(!t.length)throw new Error(`Value of ${e} is empty array, must be an array with objects`);t.forEach((t=>{if("object"!=typeof t)throw new Error(`Ability limits (${e}) must be an array of objects, found: ${t}`)}))}))}))}function xt(e,t,n,i={}){return n?.sort(((e,t)=>e.localeCompare(t))),{att:{[e]:Pt(t,n,i)}}}function Pt(e,t,n={}){t=t?.sort(((e,t)=>e.localeCompare(t)));const i=t.map((t=>({[`${e}/${t}`]:[n]})));return Object.assign({},...i)}function Rt(e){return St(e),`urn:recap:${Et(e).replace(/=/g,"")}`}function Ot(e){const t=It(e.replace("urn:recap:",""));return St(t),t}function Tt(e,t,n){const i=xt(e,t,n);return Rt(i)}function kt(e){return e&&e.includes("urn:recap:")}function At(e,t){const n=Ot(e),i=Ot(t),r=Nt(n,i);return Rt(r)}function Nt(e,t){St(e),St(t);const n=Object.keys(e.att).concat(Object.keys(t.att)).sort(((e,t)=>e.localeCompare(t))),i={att:{}};return n.forEach((n=>{var r,s;Object.keys((null==(r=e.att)?void 0:r[n])||{}).concat(Object.keys((null==(s=t.att)?void 0:s[n])||{})).sort(((e,t)=>e.localeCompare(t))).forEach((r=>{var s,o;i.att[n]=gt(dt({},i.att[n]),{[r]:(null==(s=e.att[n])?void 0:s[r])||(null==(o=t.att[n])?void 0:o[r])})}))})),i}function Ct(e="",t){St(t);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(n))return e;const i=[];let r=0;Object.keys(t.att).forEach((e=>{const n=Object.keys(t.att[e]).map((e=>({ability:e.split("/")[0],action:e.split("/")[1]})));n.sort(((e,t)=>e.action.localeCompare(t.action)));const s={};n.forEach((e=>{s[e.ability]||(s[e.ability]=[]),s[e.ability].push(e.action)}));const o=Object.keys(s).map((t=>(r++,`(${r}) '${t}': '${s[t].join("', '")}' for '${e}'.`)));i.push(o.join(", ").replace(".,","."))}));const s=i.join(" "),o=`${n}${s}`;return`${e?e+" ":""}${o}`}function qt(e){var t;const n=Ot(e);St(n);const i=null==(t=n.att)?void 0:t.eip155;return i?Object.keys(i).map((e=>e.split("/")[1])):[]}function Dt(e){const t=Ot(e);St(t);const n=[];return Object.values(t.att).forEach((e=>{Object.values(e).forEach((e=>{var t;null!=(t=e?.[0])&&t.chains&&n.push(e[0].chains)}))})),[...new Set(n.flat())]}function Lt(e){if(!e)return;const t=e?.[e.length-1];return kt(t)?t:void 0}function Ut(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function jt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function $t(e,...t){if(!jt(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Mt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Kt(e,t){$t(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function zt(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}const Bt=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Vt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Ft=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];if(!Ft)throw new Error("Non little-endian hardware is not supported");function Ht(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}function Gt(e){if("string"==typeof e)e=Ht(e);else{if(!jt(e))throw new Error("Uint8Array expected, got "+typeof e);e=en(e)}return e}function Jt(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");return Object.assign(e,t)}function Qt(e,t){if(e.length!==t.length)return!1;let n=0;for(let i=0;i<e.length;i++)n|=e[i]^t[i];return 0===n}const Wt=(e,t)=>{function n(n,...i){if($t(n),void 0!==e.nonceLength){const t=i[0];if(!t)throw new Error("nonce / iv required");e.varSizeNonce?$t(t):$t(t,e.nonceLength)}const r=e.tagLength;r&&void 0!==i[1]&&$t(i[1]);const s=t(n,...i),o=(e,t)=>{if(void 0!==t){if(2!==e)throw new Error("cipher output not supported");$t(t)}};let a=!1;return{encrypt(e,t){if(a)throw new Error("cannot encrypt() twice with same key + nonce");return a=!0,$t(e),o(s.encrypt.length,t),s.encrypt(e,t)},decrypt(e,t){if($t(e),r&&e.length<r)throw new Error("invalid ciphertext length: smaller than tagLength="+r);return o(s.decrypt.length,t),s.decrypt(e,t)}}}return Object.assign(n,e),n};function Yt(e,t,n=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(n&&!Xt(t))throw new Error("invalid output, must be aligned");return t}function Zt(e,t,n,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,i);const r=BigInt(32),s=BigInt(4294967295),o=Number(n>>r&s),a=Number(n&s),c=i?4:0,h=i?0:4;e.setUint32(t+c,o,i),e.setUint32(t+h,a,i)}function Xt(e){return e.byteOffset%4===0}function en(e){return Uint8Array.from(e)}function tn(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const nn=e=>Uint8Array.from(e.split("").map((e=>e.charCodeAt(0)))),rn=nn("expand 16-byte k"),sn=nn("expand 32-byte k"),on=Bt(rn),an=Bt(sn);function cn(e,t){return e<<t|e>>>32-t}function hn(e){return e.byteOffset%4===0}const ln=64,un=16,pn=2**32-1,dn=new Uint32Array;function gn(e,t,n,i,r,s,o,a){const c=r.length,h=new Uint8Array(ln),l=Bt(h),u=hn(r)&&hn(s),p=u?Bt(r):dn,d=u?Bt(s):dn;for(let g=0;g<c;o++){if(e(t,n,i,l,o,a),o>=pn)throw new Error("arx: counter overflow");const f=Math.min(ln,c-g);if(u&&f===ln){const e=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let t,n=0;n<un;n++)t=e+n,d[t]=p[t]^l[n];g+=ln}else{for(let e,t=0;t<f;t++)e=g+t,s[e]=r[e]^h[t];g+=f}}}function fn(e,t){const{allowShortKeys:n,extendNonceFn:i,counterLength:r,counterRight:s,rounds:o}=Jt({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw new Error("core must be a function");return Ut(r),Ut(o),zt(s),zt(n),(t,a,c,h,l=0)=>{$t(t),$t(a),$t(c);const u=c.length;if(void 0===h&&(h=new Uint8Array(u)),$t(h),Ut(l),l<0||l>=pn)throw new Error("arx: counter overflow");if(h.length<u)throw new Error(`arx: output (${h.length}) is shorter than data (${u})`);const p=[];let d,g,f=t.length;if(32===f)p.push(d=en(t)),g=an;else{if(16!==f||!n)throw new Error(`arx: invalid 32-byte key, got length=${f}`);d=new Uint8Array(32),d.set(t),d.set(t,16),g=on,p.push(d)}hn(a)||p.push(a=en(a));const y=Bt(d);if(i){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");i(g,y,Bt(a.subarray(0,16)),y),a=a.subarray(16)}const m=16-r;if(m!==a.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(12!==m){const e=new Uint8Array(12);e.set(a,s?0:12-a.length),a=e,p.push(a)}const w=Bt(a);return gn(e,g,y,w,c,h,l,o),tn(...p),h}}const yn=(e,t)=>255&e[t++]|(255&e[t++])<<8;class mn{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Gt(e),$t(e,32);const t=yn(e,0),n=yn(e,2),i=yn(e,4),r=yn(e,6),s=yn(e,8),o=yn(e,10),a=yn(e,12),c=yn(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|n<<3),this.r[2]=7939&(n>>>10|i<<6),this.r[3]=8191&(i>>>7|r<<9),this.r[4]=255&(r>>>4|s<<12),this.r[5]=s>>>1&8190,this.r[6]=8191&(s>>>14|o<<2),this.r[7]=8065&(o>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let h=0;h<8;h++)this.pad[h]=yn(e,16+2*h)}process(e,t,n=!1){const i=n?0:2048,{h:r,r:s}=this,o=s[0],a=s[1],c=s[2],h=s[3],l=s[4],u=s[5],p=s[6],d=s[7],g=s[8],f=s[9],y=yn(e,t+0),m=yn(e,t+2),w=yn(e,t+4),b=yn(e,t+6),v=yn(e,t+8),_=yn(e,t+10),E=yn(e,t+12),I=yn(e,t+14);let S=r[0]+(8191&y),x=r[1]+(8191&(y>>>13|m<<3)),P=r[2]+(8191&(m>>>10|w<<6)),R=r[3]+(8191&(w>>>7|b<<9)),O=r[4]+(8191&(b>>>4|v<<12)),T=r[5]+(v>>>1&8191),k=r[6]+(8191&(v>>>14|_<<2)),A=r[7]+(8191&(_>>>11|E<<5)),N=r[8]+(8191&(E>>>8|I<<8)),C=r[9]+(I>>>5|i),q=0,D=q+S*o+x*(5*f)+P*(5*g)+R*(5*d)+O*(5*p);q=D>>>13,D&=8191,D+=T*(5*u)+k*(5*l)+A*(5*h)+N*(5*c)+C*(5*a),q+=D>>>13,D&=8191;let L=q+S*a+x*o+P*(5*f)+R*(5*g)+O*(5*d);q=L>>>13,L&=8191,L+=T*(5*p)+k*(5*u)+A*(5*l)+N*(5*h)+C*(5*c),q+=L>>>13,L&=8191;let U=q+S*c+x*a+P*o+R*(5*f)+O*(5*g);q=U>>>13,U&=8191,U+=T*(5*d)+k*(5*p)+A*(5*u)+N*(5*l)+C*(5*h),q+=U>>>13,U&=8191;let j=q+S*h+x*c+P*a+R*o+O*(5*f);q=j>>>13,j&=8191,j+=T*(5*g)+k*(5*d)+A*(5*p)+N*(5*u)+C*(5*l),q+=j>>>13,j&=8191;let $=q+S*l+x*h+P*c+R*a+O*o;q=$>>>13,$&=8191,$+=T*(5*f)+k*(5*g)+A*(5*d)+N*(5*p)+C*(5*u),q+=$>>>13,$&=8191;let M=q+S*u+x*l+P*h+R*c+O*a;q=M>>>13,M&=8191,M+=T*o+k*(5*f)+A*(5*g)+N*(5*d)+C*(5*p),q+=M>>>13,M&=8191;let K=q+S*p+x*u+P*l+R*h+O*c;q=K>>>13,K&=8191,K+=T*a+k*o+A*(5*f)+N*(5*g)+C*(5*d),q+=K>>>13,K&=8191;let z=q+S*d+x*p+P*u+R*l+O*h;q=z>>>13,z&=8191,z+=T*c+k*a+A*o+N*(5*f)+C*(5*g),q+=z>>>13,z&=8191;let B=q+S*g+x*d+P*p+R*u+O*l;q=B>>>13,B&=8191,B+=T*h+k*c+A*a+N*o+C*(5*f),q+=B>>>13,B&=8191;let V=q+S*f+x*g+P*d+R*p+O*u;q=V>>>13,V&=8191,V+=T*l+k*h+A*c+N*a+C*o,q+=V>>>13,V&=8191,q=(q<<2)+q|0,q=q+D|0,D=8191&q,q>>>=13,L+=q,r[0]=D,r[1]=L,r[2]=U,r[3]=j,r[4]=$,r[5]=M,r[6]=K,r[7]=z,r[8]=B,r[9]=V}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let o=2;o<10;o++)e[o]+=i,i=e[o]>>>13,e[o]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let o=1;o<10;o++)n[o]=e[o]+i,i=n[o]>>>13,n[o]&=8191;n[9]-=8192;let r=(1^i)-1;for(let o=0;o<10;o++)n[o]&=r;r=~r;for(let o=0;o<10;o++)e[o]=e[o]&r|n[o];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let s=e[0]+t[0];e[0]=65535&s;for(let o=1;o<8;o++)s=(e[o]+t[o]|0)+(s>>>16)|0,e[o]=65535&s;tn(n)}update(e){Mt(this);const{buffer:t,blockLen:n}=this;e=Gt(e);const i=e.length;for(let r=0;r<i;){const s=Math.min(n-this.pos,i-r);if(s!==n)t.set(e.subarray(r,r+s),this.pos),this.pos+=s,r+=s,this.pos===n&&(this.process(t,0,!1),this.pos=0);else for(;n<=i-r;r+=n)this.process(e,r)}return this}destroy(){tn(this.h,this.r,this.buffer,this.pad)}digestInto(e){Mt(this),Kt(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let r=0;for(let s=0;s<8;s++)e[r++]=n[s]>>>0,e[r++]=n[s]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function wn(e){const t=(t,n)=>e(n).update(Gt(t)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t}const bn=wn((e=>new mn(e)));function vn(e,t,n,i,r,s=20){let o=e[0],a=e[1],c=e[2],h=e[3],l=t[0],u=t[1],p=t[2],d=t[3],g=t[4],f=t[5],y=t[6],m=t[7],w=r,b=n[0],v=n[1],_=n[2],E=o,I=a,S=c,x=h,P=l,R=u,O=p,T=d,k=g,A=f,N=y,C=m,q=w,D=b,L=v,U=_;for(let $=0;$<s;$+=2)E=E+P|0,q=cn(q^E,16),k=k+q|0,P=cn(P^k,12),E=E+P|0,q=cn(q^E,8),k=k+q|0,P=cn(P^k,7),I=I+R|0,D=cn(D^I,16),A=A+D|0,R=cn(R^A,12),I=I+R|0,D=cn(D^I,8),A=A+D|0,R=cn(R^A,7),S=S+O|0,L=cn(L^S,16),N=N+L|0,O=cn(O^N,12),S=S+O|0,L=cn(L^S,8),N=N+L|0,O=cn(O^N,7),x=x+T|0,U=cn(U^x,16),C=C+U|0,T=cn(T^C,12),x=x+T|0,U=cn(U^x,8),C=C+U|0,T=cn(T^C,7),E=E+R|0,U=cn(U^E,16),N=N+U|0,R=cn(R^N,12),E=E+R|0,U=cn(U^E,8),N=N+U|0,R=cn(R^N,7),I=I+O|0,q=cn(q^I,16),C=C+q|0,O=cn(O^C,12),I=I+O|0,q=cn(q^I,8),C=C+q|0,O=cn(O^C,7),S=S+T|0,D=cn(D^S,16),k=k+D|0,T=cn(T^k,12),S=S+T|0,D=cn(D^S,8),k=k+D|0,T=cn(T^k,7),x=x+P|0,L=cn(L^x,16),A=A+L|0,P=cn(P^A,12),x=x+P|0,L=cn(L^x,8),A=A+L|0,P=cn(P^A,7);let j=0;i[j++]=o+E|0,i[j++]=a+I|0,i[j++]=c+S|0,i[j++]=h+x|0,i[j++]=l+P|0,i[j++]=u+R|0,i[j++]=p+O|0,i[j++]=d+T|0,i[j++]=g+k|0,i[j++]=f+A|0,i[j++]=y+N|0,i[j++]=m+C|0,i[j++]=w+q|0,i[j++]=b+D|0,i[j++]=v+L|0,i[j++]=_+U|0}const _n=fn(vn,{counterRight:!1,counterLength:4,allowShortKeys:!1}),En=new Uint8Array(16),In=(e,t)=>{e.update(t);const n=t.length%16;n&&e.update(En.subarray(n))},Sn=new Uint8Array(32);function xn(e,t,n,i,r){const s=e(t,n,Sn),o=bn.create(s);r&&In(o,r),In(o,i);const a=new Uint8Array(16),c=Vt(a);Zt(c,0,BigInt(r?r.length:0),!0),Zt(c,8,BigInt(i.length),!0),o.update(a);const h=o.digest();return tn(s,a),h}const Pn=e=>(t,n,i)=>({encrypt(r,s){const o=r.length;s=Yt(o+16,s,!1),s.set(r);const a=s.subarray(0,-16);e(t,n,a,a,1);const c=xn(e,t,n,a,i);return s.set(c,o),tn(c),s},decrypt(r,s){s=Yt(r.length-16,s,!1);const o=r.subarray(0,-16),a=r.subarray(-16),c=xn(e,t,n,o,i);if(!Qt(a,c))throw new Error("invalid tag");return s.set(r.subarray(0,-16)),e(t,n,s,s,1),tn(c),s}}),Rn=Wt({blockSize:64,nonceLength:12,tagLength:16},Pn(_n));class On extends qe{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,ge(e);const n=Ce(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,r=new Uint8Array(i);r.set(n.length>i?e.create().update(n).digest():n);for(let s=0;s<r.length;s++)r[s]^=54;this.iHash.update(r),this.oHash=e.create();for(let s=0;s<r.length;s++)r[s]^=106;this.oHash.update(r),r.fill(0)}update(e){return fe(this),this.iHash.update(e),this}digestInto(e){fe(this),de(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:r,blockLen:s,outputLen:o}=this;return e.finished=i,e.destroyed=r,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Tn=(e,t,n)=>new On(e,t).update(n).digest();function kn(e,t,n){return ge(e),void 0===n&&(n=new Uint8Array(e.outputLen)),Tn(e,Ce(n),Ce(t))}Tn.create=(e,t)=>new On(e,t);const An=new Uint8Array([0]),Nn=new Uint8Array;function Cn(e,t,n,i=32){if(ge(e),ue(i),i>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const r=Math.ceil(i/e.outputLen);void 0===n&&(n=Nn);const s=new Uint8Array(r*e.outputLen),o=Tn.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let h=0;h<r;h++)An[0]=h+1,a.update(0===h?Nn:c).update(n).update(An).digestInto(c),s.set(c,e.outputLen*h),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),An.fill(0),s.slice(0,i)}const qn=(e,t,n,i,r)=>Cn(e,kn(e,t,n),i,r);function Dn(e,t,n,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,i);const r=BigInt(32),s=BigInt(4294967295),o=Number(n>>r&s),a=Number(n&s),c=i?4:0,h=i?0:4;e.setUint32(t+c,o,i),e.setUint32(t+h,a,i)}function Ln(e,t,n){return e&t^~e&n}function Un(e,t,n){return e&t^e&n^t&n}class jn extends qe{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Re(this.buffer)}update(e){fe(this);const{view:t,buffer:n,blockLen:i}=this;e=Ce(e);const r=e.length;for(let s=0;s<r;){const o=Math.min(i-this.pos,r-s);if(o!==i)n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(t,0),this.pos=0);else{const t=Re(e);for(;i<=r-s;s+=i)this.process(t,s)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){fe(this),ye(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:r}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let l=s;l<i;l++)t[l]=0;Dn(n,i-8,BigInt(8*this.length),r),this.process(n,0);const o=Re(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)o.setUint32(4*l,h[l],r)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:r,destroyed:s,pos:o}=this;return e.length=i,e.pos=o,e.finished=r,e.destroyed=s,i%t&&e.buffer.set(n),e}}const $n=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Mn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Kn=new Uint32Array(64);class zn extends jn{constructor(){super(64,32,8,!1),this.A=0|Mn[0],this.B=0|Mn[1],this.C=0|Mn[2],this.D=0|Mn[3],this.E=0|Mn[4],this.F=0|Mn[5],this.G=0|Mn[6],this.H=0|Mn[7]}get(){const{A:e,B:t,C:n,D:i,E:r,F:s,G:o,H:a}=this;return[e,t,n,i,r,s,o,a]}set(e,t,n,i,r,s,o,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|i,this.E=0|r,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let l=0;l<16;l++,t+=4)Kn[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){const e=Kn[l-15],t=Kn[l-2],n=Oe(e,7)^Oe(e,18)^e>>>3,i=Oe(t,17)^Oe(t,19)^t>>>10;Kn[l]=i+Kn[l-7]+n+Kn[l-16]|0}let{A:n,B:i,C:r,D:s,E:o,F:a,G:c,H:h}=this;for(let l=0;l<64;l++){const e=Oe(o,6)^Oe(o,11)^Oe(o,25),t=h+e+Ln(o,a,c)+$n[l]+Kn[l]|0,u=(Oe(n,2)^Oe(n,13)^Oe(n,22))+Un(n,i,r)|0;h=c,c=a,a=o,o=s+t|0,s=r,r=i,i=n,n=t+u|0}n=n+this.A|0,i=i+this.B|0,r=r+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,i,r,s,o,a,c,h)}roundClean(){Kn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Bn=De((()=>new zn)),Vn=BigInt(0);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Fn(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function Hn(e){if(!Fn(e))throw new Error("Uint8Array expected")}const Gn=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Jn(e){Hn(e);let t="";for(let n=0;n<e.length;n++)t+=Gn[e[n]];return t}function Qn(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?Vn:BigInt("0x"+e)}const Wn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Yn(e){return e>=Wn._0&&e<=Wn._9?e-Wn._0:e>=Wn.A&&e<=Wn.F?e-(Wn.A-10):e>=Wn.a&&e<=Wn.f?e-(Wn.a-10):void 0}function Zn(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const i=new Uint8Array(n);for(let r=0,s=0;r<n;r++,s+=2){const t=Yn(e.charCodeAt(s)),n=Yn(e.charCodeAt(s+1));if(void 0===t||void 0===n){const t=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+s)}i[r]=16*t+n}return i}function Xn(e){return Hn(e),Qn(Jn(Uint8Array.from(e).reverse()))}function ei(e,t){return Zn(e.toString(16).padStart(2*t,"0"))}function ti(e,t){return ei(e,t).reverse()}function ni(e,t,n){let i;if("string"==typeof t)try{i=Zn(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else{if(!Fn(t))throw new Error(e+" must be hex string or Uint8Array");i=Uint8Array.from(t)}const r=i.length;if("number"==typeof n&&r!==n)throw new Error(e+" of length "+n+" expected, got "+r);return i}const ii=e=>"bigint"==typeof e&&Vn<=e;function ri(e,t,n){return ii(e)&&ii(t)&&ii(n)&&t<=e&&e<n}function si(e,t,n,i){if(!ri(t,n,i))throw new Error("expected valid "+e+": "+n+" <= n < "+i+", got "+t)}const oi={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||Fn(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function ai(e,t,n={}){const i=(t,n,i)=>{const r=oi[n];if("function"!=typeof r)throw new Error("invalid validator function");const s=e[t];if((!i||void 0!==s)&&!r(s,e))throw new Error("param "+String(t)+" is invalid. Expected "+n+", got "+s)};for(const[r,s]of Object.entries(t))i(r,s,!1);for(const[r,s]of Object.entries(n))i(r,s,!0);return e}const ci=BigInt(0),hi=BigInt(1);function li(e,t){const n=e%t;return n>=ci?n:t+n}function ui(e,t,n){if(t<ci)throw new Error("invalid exponent, negatives unsupported");if(n<=ci)throw new Error("invalid modulus");if(n===hi)return ci;let i=hi;for(;t>ci;)t&hi&&(i=i*e%n),e=e*e%n,t>>=hi;return i}function pi(e,t,n){let i=e;for(;t-- >ci;)i*=i,i%=n;return i}BigInt(0),BigInt(1),BigInt(0),BigInt(1),BigInt(2),BigInt(8);const di=BigInt(0),gi=BigInt(1);function fi(e){return ai(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...e})}function yi(e){const t=fi(e),{P:n}=t,i=e=>li(e,n),r=t.montgomeryBits,s=Math.ceil(r/8),o=t.nByteLength,a=t.adjustScalarBytes||(e=>e),c=t.powPminus2||(e=>ui(e,n-BigInt(2),n));function h(e,t,n){const r=i(e*(t-n));return t=i(t-r),n=i(n+r),[t,n]}const l=(t.a-BigInt(2))/BigInt(4);function u(e,t){si("u",e,di,n),si("scalar",t,di,n);const s=t,o=e;let a,u=gi,p=di,d=e,g=gi,f=di;for(let n=BigInt(r-1);n>=di;n--){const e=s>>n&gi;f^=e,a=h(f,u,d),u=a[0],d=a[1],a=h(f,p,g),p=a[0],g=a[1],f=e;const t=u+p,r=i(t*t),c=u-p,y=i(c*c),m=r-y,w=d+g,b=d-g,v=i(b*t),_=i(w*c),E=v+_,I=v-_;d=i(E*E),g=i(o*i(I*I)),u=i(r*y),p=i(m*(r+i(l*m)))}a=h(f,u,d),u=a[0],d=a[1],a=h(f,p,g),p=a[0],g=a[1];const y=c(p);return i(u*y)}function p(e){return ti(i(e),s)}function d(e){const t=ni("u coordinate",e,s);return 32===o&&(t[31]&=127),Xn(t)}function g(e){const t=ni("scalar",e),n=t.length;if(n!==s&&n!==o){let e=s+" or "+o;throw new Error("invalid scalar, expected "+e+" bytes, got "+n)}return Xn(a(t))}function f(e,t){const n=d(t),i=g(e),r=u(n,i);if(r===di)throw new Error("invalid private or public key received");return p(r)}const y=p(t.Gu);function m(e){return f(e,y)}return{scalarMult:f,scalarMultBase:m,getSharedSecret:(e,t)=>f(e,t),getPublicKey:e=>m(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:y}}const mi=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const wi=BigInt(1),bi=BigInt(2),vi=BigInt(3),_i=BigInt(5);function Ei(e){const t=BigInt(10),n=BigInt(20),i=BigInt(40),r=BigInt(80),s=mi,o=e*e%s*e%s,a=pi(o,bi,s)*o%s,c=pi(a,wi,s)*e%s,h=pi(c,_i,s)*c%s,l=pi(h,t,s)*h%s,u=pi(l,n,s)*l%s,p=pi(u,i,s)*u%s,d=pi(p,r,s)*p%s,g=pi(d,r,s)*p%s,f=pi(g,t,s)*h%s;return{pow_p_5_8:pi(f,bi,s)*e%s,b2:o}}function Ii(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}BigInt(8);const Si=yi({P:mi,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{const t=mi,{pow_p_5_8:n,b2:i}=Ei(e);return li(pi(n,vi,t)*i,t)},adjustScalarBytes:Ii,randomBytes:Le}),xi="base10",Pi="base16",Ri="base64pad",Oi="base64url",Ti="utf8",ki=0,Ai=1,Ni=2,Ci=0,qi=1,Di=12,Li=32;function Ui(){const e=Si.utils.randomPrivateKey(),t=Si.getPublicKey(e);return{privateKey:(0,y.dI)(e,Pi),publicKey:(0,y.dI)(t,Pi)}}function ji(){const e=Le(Li);return(0,y.dI)(e,Pi)}function $i(e,t){const n=Si.getSharedSecret((0,y.sH)(e,Pi),(0,y.sH)(t,Pi)),i=qn(Bn,n,void 0,void 0,Li);return(0,y.dI)(i,Pi)}function Mi(e){const t=Bn((0,y.sH)(e,Pi));return(0,y.dI)(t,Pi)}function Ki(e){const t=Bn((0,y.sH)(e,Ti));return(0,y.dI)(t,Pi)}function zi(e){return(0,y.sH)(`${e}`,xi)}function Bi(e){return Number((0,y.dI)(e,xi))}function Vi(e){const t=zi(typeof e.type<"u"?e.type:ki);if(Bi(t)===Ai&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof e.senderPublicKey<"u"?(0,y.sH)(e.senderPublicKey,Pi):void 0,i=typeof e.iv<"u"?(0,y.sH)(e.iv,Pi):Le(Di),r=(0,y.sH)(e.symKey,Pi),s=Rn(r,i).encrypt((0,y.sH)(e.message,Ti));return Ji({type:t,sealed:s,iv:i,senderPublicKey:n,encoding:e.encoding})}function Fi(e){const t=(0,y.sH)(e.symKey,Pi),{sealed:n,iv:i}=Qi(e),r=Rn(t,i).decrypt(n);if(null===r)throw new Error("Failed to decrypt");return(0,y.dI)(r,Ti)}function Hi(e,t){const n=zi(Ni),i=Le(Di),r=(0,y.sH)(e,Ti);return Ji({type:n,sealed:r,iv:i,encoding:t})}function Gi(e,t){const{sealed:n}=Qi({encoded:e,encoding:t});return(0,y.dI)(n,Ti)}function Ji(e){const{encoding:t=Ri}=e;if(Bi(e.type)===Ni)return(0,y.dI)((0,y.xW)([e.type,e.sealed]),t);if(Bi(e.type)===Ai){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return(0,y.dI)((0,y.xW)([e.type,e.senderPublicKey,e.iv,e.sealed]),t)}return(0,y.dI)((0,y.xW)([e.type,e.iv,e.sealed]),t)}function Qi(e){const{encoded:t,encoding:n=Ri}=e,i=(0,y.sH)(t,n),r=i.slice(Ci,qi),s=qi;if(Bi(r)===Ai){const e=s+Li,t=e+Di,n=i.slice(s,e),o=i.slice(e,t),a=i.slice(t);return{type:r,sealed:a,iv:o,senderPublicKey:n}}if(Bi(r)===Ni){const e=i.slice(s),t=Le(Di);return{type:r,sealed:e,iv:t}}const o=s+Di,a=i.slice(s,o),c=i.slice(o);return{type:r,sealed:c,iv:a}}function Wi(e,t){const n=Qi({encoded:e,encoding:t?.encoding});return Yi({type:Bi(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?(0,y.dI)(n.senderPublicKey,Pi):void 0,receiverPublicKey:t?.receiverPublicKey})}function Yi(e){const t=e?.type||ki;if(t===Ai){if(typeof e?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function Zi(e){return e.type===Ai&&"string"==typeof e.senderPublicKey&&"string"==typeof e.receiverPublicKey}function Xi(e){return e.type===Ni}function er(e){return new m.ec("p256").keyFromPublic({x:v.from(e.x,"base64").toString("hex"),y:v.from(e.y,"base64").toString("hex")},"hex")}function tr(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n>0&&(t+="=".repeat(4-n)),t}function nr(e){return v.from(tr(e),"base64")}function ir(e,t){const[n,i,r]=e.split("."),s=nr(r);if(64!==s.length)throw new Error("Invalid signature length");const o=s.slice(0,32).toString("hex"),a=s.slice(32,64).toString("hex"),c=`${n}.${i}`,h=Bn(c),l=er(t),p=(0,y.dI)(h,Pi);if(!l.verify(p,{r:o,s:a}))throw new Error("Invalid signature");return(0,u.Cq)(e).payload}const rr="irn";function sr(e){return e?.relay||{protocol:rr}}function or(e){const t=w.CG[e];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${e}`);return t}function ar(e,t="-"){const n={},i="relay"+t;return Object.keys(e).forEach((t=>{if(t.startsWith(i)){const r=t.replace(i,""),s=e[t];n[r]=s}})),n}function cr(e){if(!e.includes("wc:")){const t=he(e);null!=t&&t.includes("wc:")&&(e=t)}e=e.includes("wc://")?e.replace("wc://",""):e,e=e.includes("wc:")?e.replace("wc:",""):e;const t=e.indexOf(":"),n=-1!==e.indexOf("?")?e.indexOf("?"):void 0,i=e.substring(0,t),r=e.substring(t+1,n).split("@"),s=typeof n<"u"?e.substring(n):"",o=new URLSearchParams(s),a={};o.forEach(((e,t)=>{a[t]=e}));const c="string"==typeof a.methods?a.methods.split(","):void 0;return{protocol:i,topic:hr(r[0]),version:parseInt(r[1],10),symKey:a.symKey,relay:ar(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function hr(e){return e.startsWith("//")?e.substring(2):e}function lr(e,t="-"){const n="relay",i={};return Object.keys(e).forEach((r=>{const s=n+t+r;e[r]&&(i[s]=e[r])})),i}function ur(e){const t=new URLSearchParams,n=lr(e.relay);Object.keys(n).sort().forEach((e=>{t.set(e,n[e])})),t.set("symKey",e.symKey),e.expiryTimestamp&&t.set("expiryTimestamp",e.expiryTimestamp.toString()),e.methods&&t.set("methods",e.methods.join(","));const i=t.toString();return`${e.protocol}:${e.topic}@${e.version}?${i}`}function pr(e,t,n){return`${e}?wc_ev=${n}&topic=${t}`}Object.defineProperty,Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;function dr(e){const t=[];return e.forEach((e=>{const[n,i]=e.split(":");t.push(`${n}:${i}`)})),t}function gr(e){const t=[];return Object.values(e).forEach((e=>{t.push(...dr(e.accounts))})),t}function fr(e,t){const n=[];return Object.values(e).forEach((e=>{dr(e.accounts).includes(t)&&n.push(...e.methods)})),n}function yr(e,t){const n=[];return Object.values(e).forEach((e=>{dr(e.accounts).includes(t)&&n.push(...e.events)})),n}function mr(e){const t={};return e?.forEach((e=>{const[n,i]=e.split(":");t[n]||(t[n]={accounts:[],chains:[],events:[]}),t[n].accounts.push(e),t[n].chains.push(`${n}:${i}`)})),t}function wr(e,t){t=t.map((e=>e.replace("did:pkh:","")));const n=mr(t);for(const[i,r]of Object.entries(n))r.methods?r.methods=Z(r.methods,e):r.methods=e,r.events=["chainChanged","accountsChanged"];return n}const br={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},vr={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function _r(e,t){const{message:n,code:i}=vr[e];return{message:t?`${n} ${t}`:n,code:i}}function Er(e,t){const{message:n,code:i}=br[e];return{message:t?`${n} ${t}`:n,code:i}}function Ir(e,t){return!!Array.isArray(e)&&(!(typeof t<"u"&&e.length)||e.every(t))}function Sr(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function xr(e){return typeof e>"u"}function Pr(e,t){return!(!t||!xr(e))||"string"==typeof e&&!!e.trim().length}function Rr(e,t){return!(!t||!xr(e))||"number"==typeof e&&!isNaN(e)}function Or(e,t){const{requiredNamespaces:n}=t,i=Object.keys(e.namespaces),r=Object.keys(n);let s=!0;return!!M(r,i)&&(i.forEach((t=>{const{accounts:i,methods:r,events:o}=e.namespaces[t],a=dr(i),c=n[t];(!M(I(t,c),a)||!M(c.methods,r)||!M(c.events,o))&&(s=!1)})),s)}function Tr(e){return!(!Pr(e,!1)||!e.includes(":"))&&2===e.split(":").length}function kr(e){if(Pr(e,!1)&&e.includes(":")){const t=e.split(":");if(3===t.length){const e=t[0]+":"+t[1];return!!t[2]&&Tr(e)}}return!1}function Ar(e){function t(e){try{return typeof new URL(e)<"u"}catch{return!1}}try{if(Pr(e,!1)){if(t(e))return!0;const n=he(e);return t(n)}}catch{}return!1}function Nr(e){var t;return null==(t=e?.proposer)?void 0:t.publicKey}function Cr(e){return e?.topic}function qr(e,t){let n=null;return Pr(e?.publicKey,!1)||(n=_r("MISSING_OR_INVALID",`${t} controller public key should be a string`)),n}function Dr(e){let t=!0;return Ir(e)?e.length&&(t=e.every((e=>Pr(e,!1)))):t=!1,t}function Lr(e,t,n){let i=null;return Ir(t)&&t.length?t.forEach((e=>{i||Tr(e)||(i=Er("UNSUPPORTED_CHAINS",`${n}, chain ${e} should be a string and conform to "namespace:chainId" format`))})):Tr(e)||(i=Er("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function Ur(e,t,n){let i=null;return Object.entries(e).forEach((([e,r])=>{if(i)return;const s=Lr(e,I(e,r),`${t} ${n}`);s&&(i=s)})),i}function jr(e,t){let n=null;return Ir(e)?e.forEach((e=>{n||kr(e)||(n=Er("UNSUPPORTED_ACCOUNTS",`${t}, account ${e} should be a string and conform to "namespace:chainId:address" format`))})):n=Er("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function $r(e,t){let n=null;return Object.values(e).forEach((e=>{if(n)return;const i=jr(e?.accounts,`${t} namespace`);i&&(n=i)})),n}function Mr(e,t){let n=null;return Dr(e?.methods)?Dr(e?.events)||(n=Er("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):n=Er("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),n}function Kr(e,t){let n=null;return Object.values(e).forEach((e=>{if(n)return;const i=Mr(e,`${t}, namespace`);i&&(n=i)})),n}function zr(e,t,n){let i=null;if(e&&Sr(e)){const r=Kr(e,t);r&&(i=r);const s=Ur(e,t,n);s&&(i=s)}else i=_r("MISSING_OR_INVALID",`${t}, ${n} should be an object with data`);return i}function Br(e,t){let n=null;if(e&&Sr(e)){const i=Kr(e,t);i&&(n=i);const r=$r(e,t);r&&(n=r)}else n=_r("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return n}function Vr(e){return Pr(e.protocol,!0)}function Fr(e,t){let n=!1;return t&&!e?n=!0:e&&Ir(e)&&e.length&&e.forEach((e=>{n=Vr(e)})),n}function Hr(e){return"number"==typeof e}function Gr(e){return typeof e<"u"&&null!==typeof e}function Jr(e){return!(!e||"object"!=typeof e||!e.code||!Rr(e.code,!1)||!e.message||!Pr(e.message,!1))}function Qr(e){return!(xr(e)||!Pr(e.method,!1))}function Wr(e){return!(xr(e)||xr(e.result)&&xr(e.error)||!Rr(e.id,!1)||!Pr(e.jsonrpc,!1))}function Yr(e){return!(xr(e)||!Pr(e.name,!1))}function Zr(e,t){return!(!Tr(t)||!gr(e).includes(t))}function Xr(e,t,n){return!!Pr(n,!1)&&fr(e,t).includes(n)}function es(e,t,n){return!!Pr(n,!1)&&yr(e,t).includes(n)}function ts(e,t,n){let i=null;const r=ns(e),s=rs(t),o=Object.keys(r),a=Object.keys(s),c=is(Object.keys(e)),h=is(Object.keys(t)),l=c.filter((e=>!h.includes(e)));return l.length&&(i=_r("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.\n      Required: ${l.toString()}\n      Received: ${Object.keys(t).toString()}`)),M(o,a)||(i=_r("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.\n      Required: ${o.toString()}\n      Approved: ${a.toString()}`)),Object.keys(t).forEach((e=>{if(!e.includes(":")||i)return;const r=dr(t[e].accounts);r.includes(e)||(i=_r("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${e}\n        Required: ${e}\n        Approved: ${r.toString()}`))})),o.forEach((e=>{i||(M(r[e].methods,s[e].methods)?M(r[e].events,s[e].events)||(i=_r("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${e}`)):i=_r("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${e}`))})),i}function ns(e){const t={};return Object.keys(e).forEach((n=>{var i;n.includes(":")?t[n]=e[n]:null==(i=e[n].chains)||i.forEach((i=>{t[i]={methods:e[n].methods,events:e[n].events}}))})),t}function is(e){return[...new Set(e.map((e=>e.includes(":")?e.split(":")[0]:e)))]}function rs(e){const t={};return Object.keys(e).forEach((n=>{if(n.includes(":"))t[n]=e[n];else{const i=dr(e[n].accounts);i?.forEach((i=>{t[i]={accounts:e[n].accounts.filter((e=>e.includes(`${i}:`))),methods:e[n].methods,events:e[n].events}}))}})),t}function ss(e,t){return Rr(e,!1)&&e<=t.max&&e>=t.min}function os(){const e=N();return new Promise((t=>{switch(e){case x.browser:t(as());break;case x.reactNative:t(cs());break;case x.node:t(hs());break;default:t(!0)}}))}function as(){return A()&&navigator?.onLine}async function cs(){if(O()&&typeof n.g<"u"&&null!=n.g&&n.g.NetInfo){const e=await(null==n.g?void 0:n.g.NetInfo.fetch());return e?.isConnected}return!0}function hs(){return!0}function ls(e){switch(N()){case x.browser:us(e);break;case x.reactNative:ps(e);break;case x.node:break}}function us(e){!O()&&A()&&(window.addEventListener("online",(()=>e(!0))),window.addEventListener("offline",(()=>e(!1))))}function ps(e){O()&&typeof n.g<"u"&&null!=n.g&&n.g.NetInfo&&n.g?.NetInfo.addEventListener((t=>e(t?.isConnected)))}const ds={};class gs{static get(e){return ds[e]}static set(e,t){ds[e]=t}static delete(e){delete ds[e]}}var fs=n(27907),ys=n(39031),ms=n(84365),ws=n(85761),bs=n.n(ws);const vs="wc",_s=2,Es="core",Is=`${vs}@2:${Es}:`,Ss={name:Es,logger:"error"},xs={database:":memory:"},Ps="crypto",Rs="client_ed25519_seed",Os=h.ONE_DAY,Ts="keychain",ks="0.3",As="messages",Ns="0.3",Cs=h.SIX_HOURS,qs="publisher",Ds="irn",Ls="error",Us="wss://relay.walletconnect.org",js="relayer",$s={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Ms="_subscription",Ks={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},zs=.1,Bs="2.18.1",Vs={link_mode:"link_mode",relay:"relay"},Fs="0.3",Hs="WALLETCONNECT_CLIENT_ID",Gs="WALLETCONNECT_LINK_MODE_APPS",Js={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Qs="subscription",Ws="0.3",Ys=1e3*h.FIVE_SECONDS,Zs="pairing",Xs="0.3",eo={wc_pairingDelete:{req:{ttl:h.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:h.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:h.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:h.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:h.ONE_DAY,prompt:!1,tag:0},res:{ttl:h.ONE_DAY,prompt:!1,tag:0}}},to={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},no={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},io="history",ro="0.3",so="expirer",oo={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},ao="0.3",co="verify-api",ho="https://verify.walletconnect.com",lo="https://verify.walletconnect.org",uo=lo,po=`${uo}/v3`,go=[ho,lo],fo="echo",yo="https://echo.walletconnect.com",mo={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},wo={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},bo={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},vo={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},_o={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Eo={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},Io=.1,So="event-client",xo=86400,Po="https://pulse.walletconnect.org/batch";function Ro(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),i=0;i<n.length;i++)n[i]=255;for(var r=0;r<e.length;r++){var s=e.charAt(r),o=s.charCodeAt(0);if(255!==n[o])throw new TypeError(s+" is ambiguous");n[o]=r}var a=e.length,c=e.charAt(0),h=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function u(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,i=0,r=0,s=t.length;r!==s&&0===t[r];)r++,n++;for(var o=(s-r)*l+1>>>0,h=new Uint8Array(o);r!==s;){for(var u=t[r],p=0,d=o-1;(0!==u||p<i)&&-1!==d;d--,p++)u+=256*h[d]>>>0,h[d]=u%a>>>0,u=u/a>>>0;if(0!==u)throw new Error("Non-zero carry");i=p,r++}for(var g=o-i;g!==o&&0===h[g];)g++;for(var f=c.repeat(n);g<o;++g)f+=e.charAt(h[g]);return f}function p(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var i=0,r=0;e[t]===c;)i++,t++;for(var s=(e.length-t)*h+1>>>0,o=new Uint8Array(s);e[t];){var l=n[e.charCodeAt(t)];if(255===l)return;for(var u=0,p=s-1;(0!==l||u<r)&&-1!==p;p--,u++)l+=a*o[p]>>>0,o[p]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");r=u,t++}if(" "!==e[t]){for(var d=s-r;d!==s&&0===o[d];)d++;for(var g=new Uint8Array(i+(s-d)),f=i;d!==s;)g[f++]=o[d++];return g}}}function d(e){var n=p(e);if(n)return n;throw new Error(`Non-${t} character`)}return{encode:u,decodeUnsafe:p,decode:d}}var Oo=Ro,To=Oo;const ko=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},Ao=e=>(new TextEncoder).encode(e),No=e=>(new TextDecoder).decode(e);class Co{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class qo{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Lo(this,e)}}class Do{constructor(e){this.decoders=e}or(e){return Lo(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Lo=(e,t)=>new Do({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Uo{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Co(e,t,n),this.decoder=new qo(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const jo=({name:e,prefix:t,encode:n,decode:i})=>new Uo(e,t,n,i),$o=({prefix:e,name:t,alphabet:n})=>{const{encode:i,decode:r}=To(n,t);return jo({prefix:e,name:t,encode:i,decode:e=>ko(r(e))})},Mo=(e,t,n,i)=>{const r={};for(let l=0;l<t.length;++l)r[t[l]]=l;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,h=0;for(let l=0;l<s;++l){const t=r[e[l]];if(void 0===t)throw new SyntaxError(`Non-${i} character`);c=c<<n|t,a+=n,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Ko=(e,t,n)=>{const i="="===t[t.length-1],r=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],o+=8;o>n;)o-=n,s+=t[r&a>>o];if(o&&(s+=t[r&a<<n-o]),i)for(;s.length*n&7;)s+="=";return s},zo=({name:e,prefix:t,bitsPerChar:n,alphabet:i})=>jo({prefix:t,name:e,encode(e){return Ko(e,i,n)},decode(t){return Mo(t,i,n,e)}}),Bo=jo({prefix:"\0",name:"identity",encode:e=>No(e),decode:e=>Ao(e)});var Vo=Object.freeze({__proto__:null,identity:Bo});const Fo=zo({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ho=Object.freeze({__proto__:null,base2:Fo});const Go=zo({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Jo=Object.freeze({__proto__:null,base8:Go});const Qo=$o({prefix:"9",name:"base10",alphabet:"0123456789"});var Wo=Object.freeze({__proto__:null,base10:Qo});const Yo=zo({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Zo=zo({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Xo=Object.freeze({__proto__:null,base16:Yo,base16upper:Zo});const ea=zo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ta=zo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),na=zo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ia=zo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ra=zo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),sa=zo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),oa=zo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),aa=zo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ca=zo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var ha=Object.freeze({__proto__:null,base32:ea,base32upper:ta,base32pad:na,base32padupper:ia,base32hex:ra,base32hexupper:sa,base32hexpad:oa,base32hexpadupper:aa,base32z:ca});const la=$o({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ua=$o({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var pa=Object.freeze({__proto__:null,base36:la,base36upper:ua});const da=$o({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ga=$o({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var fa=Object.freeze({__proto__:null,base58btc:da,base58flickr:ga});const ya=zo({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ma=zo({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),wa=zo({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ba=zo({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var va=Object.freeze({__proto__:null,base64:ya,base64pad:ma,base64url:wa,base64urlpad:ba});const _a=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Ea=_a.reduce(((e,t,n)=>(e[n]=t,e)),[]),Ia=_a.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);function Sa(e){return e.reduce(((e,t)=>(e+=Ea[t],e)),"")}function xa(e){const t=[];for(const n of e){const e=Ia[n.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${n}`);t.push(e)}return new Uint8Array(t)}const Pa=jo({prefix:"🚀",name:"base256emoji",encode:Sa,decode:xa});var Ra=Object.freeze({__proto__:null,base256emoji:Pa}),Oa=Ca,Ta=128,ka=127,Aa=~ka,Na=Math.pow(2,31);function Ca(e,t,n){t=t||[],n=n||0;for(var i=n;e>=Na;)t[n++]=255&e|Ta,e/=128;for(;e&Aa;)t[n++]=255&e|Ta,e>>>=7;return t[n]=0|e,Ca.bytes=n-i+1,t}var qa=Ua,Da=128,La=127;function Ua(e,t){var n,i=0,r=(t=t||0,0),s=t,o=e.length;do{if(s>=o)throw Ua.bytes=0,new RangeError("Could not decode varint");n=e[s++],i+=r<28?(n&La)<<r:(n&La)*Math.pow(2,r),r+=7}while(n>=Da);return Ua.bytes=s-t,i}var ja=Math.pow(2,7),$a=Math.pow(2,14),Ma=Math.pow(2,21),Ka=Math.pow(2,28),za=Math.pow(2,35),Ba=Math.pow(2,42),Va=Math.pow(2,49),Fa=Math.pow(2,56),Ha=Math.pow(2,63),Ga=function(e){return e<ja?1:e<$a?2:e<Ma?3:e<Ka?4:e<za?5:e<Ba?6:e<Va?7:e<Fa?8:e<Ha?9:10},Ja={encode:Oa,decode:qa,encodingLength:Ga},Qa=Ja;const Wa=(e,t,n=0)=>(Qa.encode(e,t,n),t),Ya=e=>Qa.encodingLength(e),Za=(e,t)=>{const n=t.byteLength,i=Ya(e),r=i+Ya(n),s=new Uint8Array(r+n);return Wa(e,s,0),Wa(n,s,i),s.set(t,r),new Xa(e,n,t,s)};class Xa{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}}const ec=({name:e,code:t,encode:n})=>new tc(e,t,n);class tc{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Za(this.code,t):t.then((e=>Za(this.code,e)))}throw Error("Unknown type, must be binary type")}}const nc=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),ic=ec({name:"sha2-256",code:18,encode:nc("SHA-256")}),rc=ec({name:"sha2-512",code:19,encode:nc("SHA-512")});Object.freeze({__proto__:null,sha256:ic,sha512:rc});const sc=0,oc="identity",ac=ko,cc=e=>Za(sc,ac(e)),hc={code:sc,name:oc,encode:ac,digest:cc};Object.freeze({__proto__:null,identity:hc});new TextEncoder,new TextDecoder;const lc={...Vo,...Ho,...Jo,...Wo,...Xo,...ha,...pa,...fa,...va,...Ra};function uc(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}function pc(e,t,n,i){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:i}}}const dc=pc("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),gc=pc("ascii","a",(e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}),(e=>{e=e.substring(1);const t=uc(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t})),fc={utf8:dc,"utf-8":dc,hex:lc.base16,latin1:gc,ascii:gc,binary:gc,...lc};function yc(e,t="utf8"){const n=fc[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode(`${n.prefix}${e}`):globalThis.Buffer.from(e,"utf8")}var mc=Object.defineProperty,wc=(e,t,n)=>t in e?mc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,bc=(e,t,n)=>wc(e,"symbol"!=typeof t?t+"":t,n);class vc{constructor(e,t){this.core=e,this.logger=t,bc(this,"keychain",new Map),bc(this,"name",Ts),bc(this,"version",ks),bc(this,"initialized",!1),bc(this,"storagePrefix",Is),bc(this,"init",(async()=>{if(!this.initialized){const e=await this.getKeyChain();typeof e<"u"&&(this.keychain=e),this.initialized=!0}})),bc(this,"has",(e=>(this.isInitialized(),this.keychain.has(e)))),bc(this,"set",(async(e,t)=>{this.isInitialized(),this.keychain.set(e,t),await this.persist()})),bc(this,"get",(e=>{this.isInitialized();const t=this.keychain.get(e);if(typeof t>"u"){const{message:t}=_r("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(t)}return t})),bc(this,"del",(async e=>{this.isInitialized(),this.keychain.delete(e),await this.persist()})),this.core=e,this.logger=(0,a.U5)(t,this.name)}get context(){return(0,a.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,K(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?z(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=_r("NOT_INITIALIZED",this.name);throw new Error(e)}}}var _c=Object.defineProperty,Ec=(e,t,n)=>t in e?_c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ic=(e,t,n)=>Ec(e,"symbol"!=typeof t?t+"":t,n);class Sc{constructor(e,t,n){this.core=e,this.logger=t,Ic(this,"name",Ps),Ic(this,"keychain"),Ic(this,"randomSessionIdentifier",ji()),Ic(this,"initialized",!1),Ic(this,"init",(async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)})),Ic(this,"hasKeys",(e=>(this.isInitialized(),this.keychain.has(e)))),Ic(this,"getClientId",(async()=>{this.isInitialized();const e=await this.getClientSeed(),t=u.TZ(e);return u.UF(t.publicKey)})),Ic(this,"generateKeyPair",(()=>{this.isInitialized();const e=Ui();return this.setPrivateKey(e.publicKey,e.privateKey)})),Ic(this,"signJWT",(async e=>{this.isInitialized();const t=await this.getClientSeed(),n=u.TZ(t),i=this.randomSessionIdentifier,r=Os;return await u.FA(i,e,r,n)})),Ic(this,"generateSharedKey",((e,t,n)=>{this.isInitialized();const i=this.getPrivateKey(e),r=$i(i,t);return this.setSymKey(r,n)})),Ic(this,"setSymKey",(async(e,t)=>{this.isInitialized();const n=t||Mi(e);return await this.keychain.set(n,e),n})),Ic(this,"deleteKeyPair",(async e=>{this.isInitialized(),await this.keychain.del(e)})),Ic(this,"deleteSymKey",(async e=>{this.isInitialized(),await this.keychain.del(e)})),Ic(this,"encode",(async(e,t,n)=>{this.isInitialized();const i=Yi(n),r=(0,l.h)(t);if(Xi(i))return Hi(r,n?.encoding);if(Zi(i)){const t=i.senderPublicKey,n=i.receiverPublicKey;e=await this.generateSharedKey(t,n)}const s=this.getSymKey(e),{type:o,senderPublicKey:a}=i;return Vi({type:o,symKey:s,message:r,senderPublicKey:a,encoding:n?.encoding})})),Ic(this,"decode",(async(e,t,n)=>{this.isInitialized();const i=Wi(t,n);if(Xi(i)){const e=Gi(t,n?.encoding);return(0,l.j)(e)}if(Zi(i)){const t=i.receiverPublicKey,n=i.senderPublicKey;e=await this.generateSharedKey(t,n)}try{const i=this.getSymKey(e),r=Fi({symKey:i,encoded:t,encoding:n?.encoding});return(0,l.j)(r)}catch(Cl){this.logger.error(`Failed to decode message from topic: '${e}', clientId: '${await this.getClientId()}'`),this.logger.error(Cl)}})),Ic(this,"getPayloadType",((e,t=Ri)=>{const n=Qi({encoded:e,encoding:t});return Bi(n.type)})),Ic(this,"getPayloadSenderPublicKey",((e,t=Ri)=>{const n=Qi({encoded:e,encoding:t});return n.senderPublicKey?(0,y.dI)(n.senderPublicKey,Pi):void 0})),this.core=e,this.logger=(0,a.U5)(t,this.name),this.keychain=n||new vc(this.core,this.logger)}get context(){return(0,a.oI)(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Rs)}catch{e=ji(),await this.keychain.set(Rs,e)}return yc(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=_r("NOT_INITIALIZED",this.name);throw new Error(e)}}}var xc=Object.defineProperty,Pc=(e,t,n)=>t in e?xc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Rc=(e,t,n)=>Pc(e,"symbol"!=typeof t?t+"":t,n);class Oc extends c.dQ{constructor(e,t){super(e,t),this.logger=e,this.core=t,Rc(this,"messages",new Map),Rc(this,"name",As),Rc(this,"version",Ns),Rc(this,"initialized",!1),Rc(this,"storagePrefix",Is),Rc(this,"init",(async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const e=await this.getRelayerMessages();typeof e<"u"&&(this.messages=e),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}finally{this.initialized=!0}}})),Rc(this,"set",(async(e,t)=>{this.isInitialized();const n=Ki(t);let i=this.messages.get(e);return typeof i>"u"&&(i={}),typeof i[n]<"u"||(i[n]=t,this.messages.set(e,i),await this.persist()),n})),Rc(this,"get",(e=>{this.isInitialized();let t=this.messages.get(e);return typeof t>"u"&&(t={}),t})),Rc(this,"has",((e,t)=>{this.isInitialized();const n=this.get(e),i=Ki(t);return typeof n[i]<"u"})),Rc(this,"del",(async e=>{this.isInitialized(),this.messages.delete(e),await this.persist()})),this.logger=(0,a.U5)(e,this.name),this.core=t}get context(){return(0,a.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,K(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?z(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=_r("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Tc=Object.defineProperty,kc=Object.defineProperties,Ac=Object.getOwnPropertyDescriptors,Nc=Object.getOwnPropertySymbols,Cc=Object.prototype.hasOwnProperty,qc=Object.prototype.propertyIsEnumerable,Dc=(e,t,n)=>t in e?Tc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Lc=(e,t)=>{for(var n in t||(t={}))Cc.call(t,n)&&Dc(e,n,t[n]);if(Nc)for(var n of Nc(t))qc.call(t,n)&&Dc(e,n,t[n]);return e},Uc=(e,t)=>kc(e,Ac(t)),jc=(e,t,n)=>Dc(e,"symbol"!=typeof t?t+"":t,n);class $c extends c.qE{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,jc(this,"events",new i.EventEmitter),jc(this,"name",qs),jc(this,"queue",new Map),jc(this,"publishTimeout",(0,h.toMiliseconds)(h.ONE_MINUTE)),jc(this,"initialPublishTimeout",(0,h.toMiliseconds)(15*h.ONE_SECOND)),jc(this,"needsTransportRestart",!1),jc(this,"publish",(async(e,t,n)=>{var i;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,message:t,opts:n}});const r=n?.ttl||Cs,s=sr(n),o=n?.prompt||!1,a=n?.tag||0,c=n?.id||(0,ys.getBigIntRpcId)().toString(),h={topic:e,message:t,opts:{ttl:r,relay:s,prompt:o,tag:a,id:c,attestation:n?.attestation,tvf:n?.tvf}},l=`Failed to publish payload, please try again. id:${c} tag:${a}`;try{const i=new Promise((async i=>{const s=({id:e})=>{h.opts.id===e&&(this.removeRequestFromQueue(e),this.relayer.events.removeListener($s.publish,s),i(h))};this.relayer.events.on($s.publish,s);const l=V(new Promise(((i,s)=>{this.rpcPublish({topic:e,message:t,ttl:r,prompt:o,tag:a,id:c,attestation:n?.attestation,tvf:n?.tvf}).then(i).catch((e=>{this.logger.warn(e,e?.message),s(e)}))})),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${c} tag:${a}`);try{await l,this.events.removeListener($s.publish,s)}catch($u){this.queue.set(c,Uc(Lc({},h),{attempt:1})),this.logger.warn($u,$u?.message)}}));this.logger.trace({type:"method",method:"publish",params:{id:c,topic:e,message:t,opts:n}}),await V(i,this.publishTimeout,l)}catch(Zl){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(Zl),null!=(i=n?.internal)&&i.throwOnFailedPublish)throw Zl}finally{this.queue.delete(c)}})),jc(this,"on",((e,t)=>{this.events.on(e,t)})),jc(this,"once",((e,t)=>{this.events.once(e,t)})),jc(this,"off",((e,t)=>{this.events.off(e,t)})),jc(this,"removeListener",((e,t)=>{this.events.removeListener(e,t)})),this.relayer=e,this.logger=(0,a.U5)(t,this.name),this.registerEventListeners()}get context(){return(0,a.oI)(this.logger)}async rpcPublish(e){var t,n,i,r;const{topic:s,message:o,ttl:a=Cs,prompt:c,tag:h,id:l,attestation:u,tvf:p}=e,d={method:or(sr().protocol).publish,params:Lc({topic:s,message:o,ttl:a,prompt:c,tag:h,attestation:u},p),id:l};xr(null==(t=d.params)?void 0:t.prompt)&&(null==(n=d.params)||delete n.prompt),xr(null==(i=d.params)?void 0:i.tag)&&(null==(r=d.params)||delete r.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:d});const g=await this.relayer.request(d);return this.relayer.events.emit($s.publish,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach((async(e,t)=>{const n=e.attempt+1;this.queue.set(t,Uc(Lc({},e),{attempt:n}));const{topic:i,message:r,opts:s,attestation:o}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${n}`),await this.rpcPublish(Uc(Lc({},e),{topic:i,message:r,ttl:s.ttl,prompt:s.prompt,tag:s.tag,id:s.id,attestation:o,tvf:s.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)}))}registerEventListeners(){this.relayer.core.heartbeat.on(s.li.pulse,(()=>{if(this.needsTransportRestart)return this.needsTransportRestart=!1,void this.relayer.events.emit($s.connection_stalled);this.checkQueue()})),this.relayer.on($s.message_ack,(e=>{this.removeRequestFromQueue(e.id.toString())}))}}var Mc=Object.defineProperty,Kc=(e,t,n)=>t in e?Mc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,zc=(e,t,n)=>Kc(e,"symbol"!=typeof t?t+"":t,n);class Bc{constructor(){zc(this,"map",new Map),zc(this,"set",((e,t)=>{const n=this.get(e);this.exists(e,t)||this.map.set(e,[...n,t])})),zc(this,"get",(e=>this.map.get(e)||[])),zc(this,"exists",((e,t)=>this.get(e).includes(t))),zc(this,"delete",((e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,t))return;const i=n.filter((e=>e!==t));i.length?this.map.set(e,i):this.map.delete(e)})),zc(this,"clear",(()=>{this.map.clear()}))}get topics(){return Array.from(this.map.keys())}}var Vc=Object.defineProperty,Fc=Object.defineProperties,Hc=Object.getOwnPropertyDescriptors,Gc=Object.getOwnPropertySymbols,Jc=Object.prototype.hasOwnProperty,Qc=Object.prototype.propertyIsEnumerable,Wc=(e,t,n)=>t in e?Vc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Yc=(e,t)=>{for(var n in t||(t={}))Jc.call(t,n)&&Wc(e,n,t[n]);if(Gc)for(var n of Gc(t))Qc.call(t,n)&&Wc(e,n,t[n]);return e},Zc=(e,t)=>Fc(e,Hc(t)),Xc=(e,t,n)=>Wc(e,"symbol"!=typeof t?t+"":t,n);class eh extends c.mF{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Xc(this,"subscriptions",new Map),Xc(this,"topicMap",new Bc),Xc(this,"events",new i.EventEmitter),Xc(this,"name",Qs),Xc(this,"version",Ws),Xc(this,"pending",new Map),Xc(this,"cached",[]),Xc(this,"initialized",!1),Xc(this,"pendingSubscriptionWatchLabel","pending_sub_watch_label"),Xc(this,"pollingInterval",20),Xc(this,"storagePrefix",Is),Xc(this,"subscribeTimeout",(0,h.toMiliseconds)(h.ONE_MINUTE)),Xc(this,"initialSubscribeTimeout",(0,h.toMiliseconds)(15*h.ONE_SECOND)),Xc(this,"clientId"),Xc(this,"batchSubscribeTopicsLimit",500),Xc(this,"init",(async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0})),Xc(this,"subscribe",(async(e,t)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{const n=sr(t),i={topic:e,relay:n,transportType:t?.transportType};this.pending.set(e,i);const r=await this.rpcSubscribe(e,n,t);return"string"==typeof r&&(this.onSubscribe(r,i),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}})),r}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}})),Xc(this,"unsubscribe",(async(e,t)=>{await this.restartToComplete(),this.isInitialized(),typeof t?.id<"u"?await this.unsubscribeById(e,t.id,t):await this.unsubscribeByTopic(e,t)})),Xc(this,"isSubscribed",(async e=>{if(this.topics.includes(e))return!0;const t=`${this.pendingSubscriptionWatchLabel}_${e}`;return await new Promise(((n,i)=>{const r=new h.Watch;r.start(t);const s=setInterval((()=>{(!this.pending.has(e)&&this.topics.includes(e)||this.cached.some((t=>t.topic===e)))&&(clearInterval(s),r.stop(t),n(!0)),r.elapsed(t)>=Ys&&(clearInterval(s),r.stop(t),i(new Error("Subscription resolution timeout")))}),this.pollingInterval)})).catch((()=>!1))})),Xc(this,"on",((e,t)=>{this.events.on(e,t)})),Xc(this,"once",((e,t)=>{this.events.once(e,t)})),Xc(this,"off",((e,t)=>{this.events.off(e,t)})),Xc(this,"removeListener",((e,t)=>{this.events.removeListener(e,t)})),Xc(this,"start",(async()=>{await this.onConnect()})),Xc(this,"stop",(async()=>{await this.onDisconnect()})),Xc(this,"restart",(async()=>{await this.restore(),await this.onRestart()})),Xc(this,"checkPending",(async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;const e=[];this.pending.forEach((t=>{e.push(t)})),await this.batchSubscribe(e)})),Xc(this,"registerEventListeners",(()=>{this.relayer.core.heartbeat.on(s.li.pulse,(async()=>{await this.checkPending()})),this.events.on(Js.created,(async e=>{const t=Js.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})),this.events.on(Js.deleted,(async e=>{const t=Js.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}))})),this.relayer=e,this.logger=(0,a.U5)(t,this.name),this.clientId=""}get context(){return(0,a.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let n=!1;try{n=this.getSubscription(e).topic===t}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const n=this.topicMap.get(e);await Promise.all(n.map((async n=>await this.unsubscribeById(e,n,t))))}async unsubscribeById(e,t,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:n}});try{const i=sr(n);await this.rpcUnsubscribe(e,t,i);const r=Er("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,r),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,t,n){var i;n?.transportType===Vs.relay&&await this.restartToComplete();const r={method:or(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});const s=null==(i=n?.internal)?void 0:i.throwOnFailedPublish;try{const t=await this.getSubscriptionId(e);if(n?.transportType===Vs.link_mode)return setTimeout((()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(r).catch((e=>this.logger.warn(e)))}),(0,h.toMiliseconds)(h.ONE_SECOND)),t;const i=new Promise((async t=>{const n=i=>{i.topic===e&&(this.events.removeListener(Js.created,n),t(i.id))};this.events.on(Js.created,n);try{const i=await V(new Promise(((e,t)=>{this.relayer.request(r).catch((e=>{this.logger.warn(e,e?.message),t(e)})).then(e)})),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Js.created,n),t(i)}catch{}})),o=await V(i,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!o&&s)throw new Error(`Subscribing to ${e} failed, please try again`);return o?t:null}catch(o){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit($s.connection_stalled),s)throw o}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,n={method:or(t.protocol).batchSubscribe,params:{topics:e.map((e=>e.topic))}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await V(new Promise((e=>{this.relayer.request(n).catch((e=>this.logger.warn(e))).then(e)})),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit($s.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,n={method:or(t.protocol).batchFetchMessages,params:{topics:e.map((e=>e.topic))}};let i;this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{i=await await V(new Promise(((e,t)=>{this.relayer.request(n).catch((e=>{this.logger.warn(e),t(e)})).then(e)})),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit($s.connection_stalled)}return i}rpcUnsubscribe(e,t,n){const i={method:or(n.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,t){this.setSubscription(e,Zc(Yc({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach((e=>{this.setSubscription(e.id,Yc({},e)),this.pending.delete(e.topic)}))}async onUnsubscribe(e,t,n){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,Yc({},t)),this.topicMap.set(t.topic,e),this.events.emit(Js.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:t}=_r("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(t)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(Js.deleted,Zc(Yc({},n),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Js.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<t;n++){const t=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(t)}}this.events.emit(Js.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:e}=_r("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map((async e=>Zc(Yc({},e),{id:await this.getSubscriptionId(e.topic)}))))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await le((0,h.toMiliseconds)(h.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=_r("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){!this.relayer.connected&&!this.relayer.connecting&&await this.relayer.transportOpen()}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Ki(e+await this.getClientId())}}var th=Object.defineProperty,nh=Object.getOwnPropertySymbols,ih=Object.prototype.hasOwnProperty,rh=Object.prototype.propertyIsEnumerable,sh=(e,t,n)=>t in e?th(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,oh=(e,t)=>{for(var n in t||(t={}))ih.call(t,n)&&sh(e,n,t[n]);if(nh)for(var n of nh(t))rh.call(t,n)&&sh(e,n,t[n]);return e},ah=(e,t,n)=>sh(e,"symbol"!=typeof t?t+"":t,n);class ch extends c.m5{constructor(e){super(e),ah(this,"protocol","wc"),ah(this,"version",2),ah(this,"core"),ah(this,"logger"),ah(this,"events",new i.EventEmitter),ah(this,"provider"),ah(this,"messages"),ah(this,"subscriber"),ah(this,"publisher"),ah(this,"name",js),ah(this,"transportExplicitlyClosed",!1),ah(this,"initialized",!1),ah(this,"connectionAttemptInProgress",!1),ah(this,"relayUrl"),ah(this,"projectId"),ah(this,"packageName"),ah(this,"bundleId"),ah(this,"hasExperiencedNetworkDisruption",!1),ah(this,"pingTimeout"),ah(this,"heartBeatTimeout",(0,h.toMiliseconds)(h.THIRTY_SECONDS+h.FIVE_SECONDS)),ah(this,"reconnectTimeout"),ah(this,"connectPromise"),ah(this,"requestsInFlight",[]),ah(this,"connectTimeout",(0,h.toMiliseconds)(15*h.ONE_SECOND)),ah(this,"request",(async e=>{var t,n;this.logger.debug("Publishing Request Payload");const i=e.id||(0,ys.getBigIntRpcId)().toString();await this.toEstablishConnection();try{this.logger.trace({id:i,method:e.method,topic:null==(t=e.params)?void 0:t.topic},"relayer.request - publishing...");const r=`${i}:${(null==(n=e.params)?void 0:n.tag)||""}`;this.requestsInFlight.push(r);const s=await this.provider.request(e);return this.requestsInFlight=this.requestsInFlight.filter((e=>e!==r)),s}catch(iu){throw this.logger.debug(`Failed to Publish Request: ${i}`),iu}})),ah(this,"resetPingTimeout",(()=>{if(R())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout((()=>{var e,t,n;this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(n=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)||n.terminate()}),this.heartBeatTimeout)}catch(e){this.logger.warn(e,e?.message)}})),ah(this,"onPayloadHandler",(e=>{this.onProviderPayload(e),this.resetPingTimeout()})),ah(this,"onConnectHandler",(()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit($s.connect)})),ah(this,"onDisconnectHandler",(()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()})),ah(this,"onProviderErrorHandler",(e=>{this.logger.fatal(e,`Fatal socket error: ${e?.message}`),this.events.emit($s.error,e),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()})),ah(this,"registerProviderListeners",(()=>{this.provider.on(Ks.payload,this.onPayloadHandler),this.provider.on(Ks.connect,this.onConnectHandler),this.provider.on(Ks.disconnect,this.onDisconnectHandler),this.provider.on(Ks.error,this.onProviderErrorHandler)})),this.core=e.core,this.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?(0,a.U5)(e.logger,this.name):(0,a.h6)((0,a.iP)({level:e.logger||Ls})),this.messages=new Oc(this.logger,e.core),this.subscriber=new eh(this,this.logger),this.publisher=new $c(this,this.logger),this.relayUrl=e?.relayUrl||Us,this.projectId=e.projectId,T()?this.packageName=C():k()&&(this.bundleId=C()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.cached.length>0)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return(0,a.oI)(this.logger)}get connected(){var e,t,n;return 1===(null==(n=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:n.readyState)}get connecting(){var e,t,n;return 0===(null==(n=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:n.readyState)}async publish(e,t,n){this.isInitialized(),await this.publisher.publish(e,t,n),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:Vs.relay})}async subscribe(e,t){var n,i,r;this.isInitialized(),(null==t||!t.transportType||"relay"===t?.transportType)&&await this.toEstablishConnection();const s=typeof(null==(n=t?.internal)?void 0:n.throwOnFailedPublish)>"u"||(null==(i=t?.internal)?void 0:i.throwOnFailedPublish);let o,a=(null==(r=this.subscriber.topicMap.get(e))?void 0:r[0])||"";const c=t=>{t.topic===e&&(this.subscriber.off(Js.created,c),o())};return await Promise.all([new Promise((e=>{o=e,this.subscriber.on(Js.created,c)})),new Promise((async(n,i)=>{a=await this.subscriber.subscribe(e,oh({internal:{throwOnFailedPublish:s}},t)).catch((e=>{s&&i(e)}))||a,n()}))]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await V(this.provider.disconnect(),2e3,"provider.disconnect()").catch((()=>this.onProviderDisconnect())):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise((async(t,n)=>{await this.connect(e).then(t).catch(n).finally((()=>{this.connectPromise=void 0}))})),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await os())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(0===e?.length)return void this.logger.trace("Batch message events is empty. Ignoring...");const t=e.sort(((e,t)=>e.publishedAt-t.publishedAt));this.logger.debug(`Batch of ${t.length} message events sorted`);for(const i of t)try{await this.onMessageEvent(i)}catch(n){this.logger.warn(n,"Error while processing batch message event: "+n?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:n}=e;if(!t.sessionExists){const e=Q(h.FIVE_MINUTES),t={topic:n,expiry:e,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,t)}this.events.emit($s.message,e),await this.recordMessageEvent(e)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise((async(e,t)=>{const n=()=>{t(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Ks.disconnect,n),await V(new Promise(((e,t)=>{this.provider.connect().then(e).catch(t)})),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch((e=>{t(e)})).finally((()=>{this.provider.off(Ks.disconnect,n),clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0})),await new Promise((async(e,t)=>{const n=()=>{t(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Ks.disconnect,n),await this.subscriber.start().then(e).catch(t).finally((()=>{this.provider.off(Ks.disconnect,n)}))})),this.hasExperiencedNetworkDisruption=!1,e()}))}catch(n){await this.subscriber.stop();const e=n;this.logger.warn({},e.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise((e=>setTimeout(e,(0,h.toMiliseconds)(1*t)))),t++}}startPingTimeout(){var e,t,n,i,r;if(R())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(r=null==(i=null==(n=this.provider)?void 0:n.connection)?void 0:i.socket)||r.on("ping",(()=>{this.resetPingTimeout()}))),this.resetPingTimeout()}catch(iu){this.logger.warn(iu,iu?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new fs.F(new ms.A($({sdkVersion:Bs,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:n}=e;await this.messages.set(t,n)}async shouldIgnoreMessageEvent(e){const{topic:t,message:n}=e;if(!n||0===n.length)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.warn(`Ignoring message for non-subscribed topic ${t}`),!0;const i=this.messages.has(t,n);return i&&this.logger.warn(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),(0,ys.isJsonRpcRequest)(e)){if(!e.method.endsWith(Ms))return;const t=e.params,{topic:n,message:i,publishedAt:r,attestation:s}=t.data,o={topic:n,message:i,publishedAt:r,transportType:Vs.relay,attestation:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(oh({type:"event",event:t.id},o)),this.events.emit(t.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}else(0,ys.isJsonRpcResponse)(e)&&this.events.emit($s.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit($s.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=(0,ys.formatJsonRpcResult)(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Ks.payload,this.onPayloadHandler),this.provider.off(Ks.connect,this.onConnectHandler),this.provider.off(Ks.disconnect,this.onDisconnectHandler),this.provider.off(Ks.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await os();ls((async t=>{e!==t&&(e=t,t?await this.transportOpen().catch((e=>this.logger.error(e,e?.message))):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}))}async onProviderDisconnect(){await this.subscriber.stop(),clearTimeout(this.pingTimeout),this.events.emit($s.disconnect),this.connectionAttemptInProgress=!1,!this.transportExplicitlyClosed&&(this.reconnectTimeout||this.connectPromise||(this.reconnectTimeout=setTimeout((async()=>{clearTimeout(this.reconnectTimeout),await this.transportOpen().catch((e=>this.logger.error(e,e?.message)))}),(0,h.toMiliseconds)(zs))))}isInitialized(){if(!this.initialized){const{message:e}=_r("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&await this.transportOpen()}}var hh=Object.defineProperty,lh=Object.getOwnPropertySymbols,uh=Object.prototype.hasOwnProperty,ph=Object.prototype.propertyIsEnumerable,dh=(e,t,n)=>t in e?hh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,gh=(e,t)=>{for(var n in t||(t={}))uh.call(t,n)&&dh(e,n,t[n]);if(lh)for(var n of lh(t))ph.call(t,n)&&dh(e,n,t[n]);return e},fh=(e,t,n)=>dh(e,"symbol"!=typeof t?t+"":t,n);class yh extends c.pi{constructor(e,t,n,i=Is,r=void 0){super(e,t,n,i),this.core=e,this.logger=t,this.name=n,fh(this,"map",new Map),fh(this,"version",Fs),fh(this,"cached",[]),fh(this,"initialized",!1),fh(this,"getKey"),fh(this,"storagePrefix",Is),fh(this,"recentlyDeleted",[]),fh(this,"recentlyDeletedLimit",200),fh(this,"init",(async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach((e=>{this.getKey&&null!==e&&!xr(e)?this.map.set(this.getKey(e),e):Nr(e)?this.map.set(e.id,e):Cr(e)&&this.map.set(e.topic,e)})),this.cached=[],this.initialized=!0)})),fh(this,"set",(async(e,t)=>{this.isInitialized(),this.map.has(e)?await this.update(e,t):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:e,value:t}),this.map.set(e,t),await this.persist())})),fh(this,"get",(e=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:e}),this.getData(e)))),fh(this,"getAll",(e=>(this.isInitialized(),e?this.values.filter((t=>Object.keys(e).every((n=>bs()(t[n],e[n]))))):this.values))),fh(this,"update",(async(e,t)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:e,update:t});const n=gh(gh({},this.getData(e)),t);this.map.set(e,n),await this.persist()})),fh(this,"delete",(async(e,t)=>{this.isInitialized(),this.map.has(e)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:e,reason:t}),this.map.delete(e),this.addToRecentlyDeleted(e),await this.persist())})),this.logger=(0,a.U5)(t,this.name),this.storagePrefix=i,this.getKey=r}get context(){return(0,a.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:t}=_r("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(t),new Error(t)}const{message:t}=_r("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(t),new Error(t)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:e}=_r("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=_r("NOT_INITIALIZED",this.name);throw new Error(e)}}}var mh=Object.defineProperty,wh=(e,t,n)=>t in e?mh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,bh=(e,t,n)=>wh(e,"symbol"!=typeof t?t+"":t,n);class vh{constructor(e,t){this.core=e,this.logger=t,bh(this,"name",Zs),bh(this,"version",Xs),bh(this,"events",new(r())),bh(this,"pairings"),bh(this,"initialized",!1),bh(this,"storagePrefix",Is),bh(this,"ignoredPayloadTypes",[Ai]),bh(this,"registeredMethods",[]),bh(this,"init",(async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))})),bh(this,"register",(({methods:e})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...e])]})),bh(this,"create",(async e=>{this.isInitialized();const t=ji(),n=await this.core.crypto.setSymKey(t),i=Q(h.FIVE_MINUTES),r={protocol:Ds},s={topic:n,expiry:i,relay:r,active:!1,methods:e?.methods},o=ur({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:t,relay:r,expiryTimestamp:i,methods:e?.methods});return this.events.emit(to.create,s),this.core.expirer.set(n,i),await this.pairings.set(n,s),await this.core.relayer.subscribe(n,{transportType:e?.transportType}),{topic:n,uri:o}})),bh(this,"pair",(async e=>{this.isInitialized();const t=this.core.eventClient.createEvent({properties:{topic:e?.uri,trace:[mo.pairing_started]}});this.isValidPair(e,t);const{topic:n,symKey:i,relay:r,expiryTimestamp:s,methods:o}=cr(e.uri);let a;if(t.props.properties.topic=n,t.addTrace(mo.pairing_uri_validation_success),t.addTrace(mo.pairing_uri_not_expired),this.pairings.keys.includes(n)){if(a=this.pairings.get(n),t.addTrace(mo.existing_pairing),a.active)throw t.setError(wo.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);t.addTrace(mo.pairing_not_expired)}const c=s||Q(h.FIVE_MINUTES),l={topic:n,relay:r,expiry:c,active:!1,methods:o};this.core.expirer.set(n,c),await this.pairings.set(n,l),t.addTrace(mo.store_new_pairing),e.activatePairing&&await this.activate({topic:n}),this.events.emit(to.create,l),t.addTrace(mo.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(i,n),t.addTrace(mo.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{t.setError(wo.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:r})}catch(Pu){throw t.setError(wo.subscribe_pairing_topic_failure),Pu}return t.addTrace(mo.subscribe_pairing_topic_success),l})),bh(this,"activate",(async({topic:e})=>{this.isInitialized();const t=Q(h.FIVE_MINUTES);this.core.expirer.set(e,t),await this.pairings.update(e,{active:!0,expiry:t})})),bh(this,"ping",(async e=>{this.isInitialized(),await this.isValidPing(e),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:t}=e;if(this.pairings.keys.includes(t)){const e=await this.sendRequest(t,"wc_pairingPing",{}),{done:n,resolve:i,reject:r}=B();this.events.once(Y("pairing_ping",e),(({error:e})=>{e?r(e):i()})),await n()}})),bh(this,"updateExpiry",(async({topic:e,expiry:t})=>{this.isInitialized(),await this.pairings.update(e,{expiry:t})})),bh(this,"updateMetadata",(async({topic:e,metadata:t})=>{this.isInitialized(),await this.pairings.update(e,{peerMetadata:t})})),bh(this,"getPairings",(()=>(this.isInitialized(),this.pairings.values))),bh(this,"disconnect",(async e=>{this.isInitialized(),await this.isValidDisconnect(e);const{topic:t}=e;this.pairings.keys.includes(t)&&(await this.sendRequest(t,"wc_pairingDelete",Er("USER_DISCONNECTED")),await this.deletePairing(t))})),bh(this,"formatUriFromPairing",(e=>{this.isInitialized();const{topic:t,relay:n,expiry:i,methods:r}=e,s=this.core.crypto.keychain.get(t);return ur({protocol:this.core.protocol,version:this.core.version,topic:t,symKey:s,relay:n,expiryTimestamp:i,methods:r})})),bh(this,"sendRequest",(async(e,t,n)=>{const i=(0,ys.formatJsonRpcRequest)(t,n),r=await this.core.crypto.encode(e,i),s=eo[t].req;return this.core.history.set(e,i),this.core.relayer.publish(e,r,s),i.id})),bh(this,"sendResult",(async(e,t,n)=>{const i=(0,ys.formatJsonRpcResult)(e,n),r=await this.core.crypto.encode(t,i),s=await this.core.history.get(t,e),o=eo[s.request.method].res;await this.core.relayer.publish(t,r,o),await this.core.history.resolve(i)})),bh(this,"sendError",(async(e,t,n)=>{const i=(0,ys.formatJsonRpcError)(e,n),r=await this.core.crypto.encode(t,i),s=await this.core.history.get(t,e),o=eo[s.request.method]?eo[s.request.method].res:eo.unregistered_method.res;await this.core.relayer.publish(t,r,o),await this.core.history.resolve(i)})),bh(this,"deletePairing",(async(e,t)=>{await this.core.relayer.unsubscribe(e),await Promise.all([this.pairings.delete(e,Er("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(e),t?Promise.resolve():this.core.expirer.del(e)])})),bh(this,"cleanup",(async()=>{const e=this.pairings.getAll().filter((e=>W(e.expiry)));await Promise.all(e.map((e=>this.deletePairing(e.topic))))})),bh(this,"onRelayEventRequest",(e=>{const{topic:t,payload:n}=e;switch(n.method){case"wc_pairingPing":return this.onPairingPingRequest(t,n);case"wc_pairingDelete":return this.onPairingDeleteRequest(t,n);default:return this.onUnknownRpcMethodRequest(t,n)}})),bh(this,"onRelayEventResponse",(async e=>{const{topic:t,payload:n}=e,i=(await this.core.history.get(t,n.id)).request.method;switch(i){case"wc_pairingPing":return this.onPairingPingResponse(t,n);default:return this.onUnknownRpcMethodResponse(i)}})),bh(this,"onPairingPingRequest",(async(e,t)=>{const{id:n}=t;try{this.isValidPing({topic:e}),await this.sendResult(n,e,!0),this.events.emit(to.ping,{id:n,topic:e})}catch(iu){await this.sendError(n,e,iu),this.logger.error(iu)}})),bh(this,"onPairingPingResponse",((e,t)=>{const{id:n}=t;setTimeout((()=>{(0,ys.isJsonRpcResult)(t)?this.events.emit(Y("pairing_ping",n),{}):(0,ys.isJsonRpcError)(t)&&this.events.emit(Y("pairing_ping",n),{error:t.error})}),500)})),bh(this,"onPairingDeleteRequest",(async(e,t)=>{const{id:n}=t;try{this.isValidDisconnect({topic:e}),await this.deletePairing(e),this.events.emit(to.delete,{id:n,topic:e})}catch(iu){await this.sendError(n,e,iu),this.logger.error(iu)}})),bh(this,"onUnknownRpcMethodRequest",(async(e,t)=>{const{id:n,method:i}=t;try{if(this.registeredMethods.includes(i))return;const t=Er("WC_METHOD_UNSUPPORTED",i);await this.sendError(n,e,t),this.logger.error(t)}catch(r){await this.sendError(n,e,r),this.logger.error(r)}})),bh(this,"onUnknownRpcMethodResponse",(e=>{this.registeredMethods.includes(e)||this.logger.error(Er("WC_METHOD_UNSUPPORTED",e))})),bh(this,"isValidPair",((e,t)=>{var n;if(!Gr(e)){const{message:n}=_r("MISSING_OR_INVALID",`pair() params: ${e}`);throw t.setError(wo.malformed_pairing_uri),new Error(n)}if(!Ar(e.uri)){const{message:n}=_r("MISSING_OR_INVALID",`pair() uri: ${e.uri}`);throw t.setError(wo.malformed_pairing_uri),new Error(n)}const i=cr(e?.uri);if(null==(n=i?.relay)||!n.protocol){const{message:e}=_r("MISSING_OR_INVALID","pair() uri#relay-protocol");throw t.setError(wo.malformed_pairing_uri),new Error(e)}if(null==i||!i.symKey){const{message:e}=_r("MISSING_OR_INVALID","pair() uri#symKey");throw t.setError(wo.malformed_pairing_uri),new Error(e)}if(null!=i&&i.expiryTimestamp&&(0,h.toMiliseconds)(i?.expiryTimestamp)<Date.now()){t.setError(wo.pairing_expired);const{message:e}=_r("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(e)}})),bh(this,"isValidPing",(async e=>{if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`ping() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidPairingTopic(t)})),bh(this,"isValidDisconnect",(async e=>{if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidPairingTopic(t)})),bh(this,"isValidPairingTopic",(async e=>{if(!Pr(e,!1)){const{message:t}=_r("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.pairings.keys.includes(e)){const{message:t}=_r("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(W(this.pairings.get(e).expiry)){await this.deletePairing(e);const{message:t}=_r("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}})),this.core=e,this.logger=(0,a.U5)(t,this.name),this.pairings=new yh(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,a.oI)(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=_r("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on($s.message,(async e=>{const{topic:t,message:n,transportType:i}=e;if(!this.pairings.keys.includes(t)||i===Vs.link_mode||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const r=await this.core.crypto.decode(t,n);try{(0,ys.isJsonRpcRequest)(r)?(this.core.history.set(t,r),this.onRelayEventRequest({topic:t,payload:r})):(0,ys.isJsonRpcResponse)(r)&&(await this.core.history.resolve(r),await this.onRelayEventResponse({topic:t,payload:r}),this.core.history.delete(t,r.id))}catch(iu){this.logger.error(iu)}}))}registerExpirerEvents(){this.core.expirer.on(oo.expired,(async e=>{const{topic:t}=J(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(to.expire,{topic:t}))}))}}var _h=Object.defineProperty,Eh=(e,t,n)=>t in e?_h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ih=(e,t,n)=>Eh(e,"symbol"!=typeof t?t+"":t,n);class Sh extends c.lZ{constructor(e,t){super(e,t),this.core=e,this.logger=t,Ih(this,"records",new Map),Ih(this,"events",new i.EventEmitter),Ih(this,"name",io),Ih(this,"version",ro),Ih(this,"cached",[]),Ih(this,"initialized",!1),Ih(this,"storagePrefix",Is),Ih(this,"init",(async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach((e=>this.records.set(e.id,e))),this.cached=[],this.registerEventListeners(),this.initialized=!0)})),Ih(this,"set",((e,t,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:n}),this.records.has(t.id))return;const i={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:n,expiry:Q(h.THIRTY_DAYS)};this.records.set(i.id,i),this.persist(),this.events.emit(no.created,i)})),Ih(this,"resolve",(async e=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;const t=await this.getRecord(e.id);typeof t.response>"u"&&(t.response=(0,ys.isJsonRpcError)(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.persist(),this.events.emit(no.updated,t))})),Ih(this,"get",(async(e,t)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t}),await this.getRecord(t)))),Ih(this,"delete",((e,t)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach((n=>{if(n.topic===e){if(typeof t<"u"&&n.id!==t)return;this.records.delete(n.id),this.events.emit(no.deleted,n)}})),this.persist()})),Ih(this,"exists",(async(e,t)=>(this.isInitialized(),!!this.records.has(t)&&(await this.getRecord(t)).topic===e))),Ih(this,"on",((e,t)=>{this.events.on(e,t)})),Ih(this,"once",((e,t)=>{this.events.once(e,t)})),Ih(this,"off",((e,t)=>{this.events.off(e,t)})),Ih(this,"removeListener",((e,t)=>{this.events.removeListener(e,t)})),this.logger=(0,a.U5)(t,this.name)}get context(){return(0,a.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach((t=>{if(typeof t.response<"u")return;const n={topic:t.topic,request:(0,ys.formatJsonRpcRequest)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(n)})),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:t}=_r("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(t)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(no.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:e}=_r("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(no.created,(e=>{const t=no.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})})),this.events.on(no.updated,(e=>{const t=no.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})})),this.events.on(no.deleted,(e=>{const t=no.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})})),this.core.heartbeat.on(s.li.pulse,(()=>{this.cleanup()}))}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach((t=>{(0,h.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(no.deleted,t,!1),e=!0)})),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=_r("NOT_INITIALIZED",this.name);throw new Error(e)}}}var xh=Object.defineProperty,Ph=(e,t,n)=>t in e?xh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Rh=(e,t,n)=>Ph(e,"symbol"!=typeof t?t+"":t,n);class Oh extends c.Vx{constructor(e,t){super(e,t),this.core=e,this.logger=t,Rh(this,"expirations",new Map),Rh(this,"events",new i.EventEmitter),Rh(this,"name",so),Rh(this,"version",ao),Rh(this,"cached",[]),Rh(this,"initialized",!1),Rh(this,"storagePrefix",Is),Rh(this,"init",(async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach((e=>this.expirations.set(e.target,e))),this.cached=[],this.registerEventListeners(),this.initialized=!0)})),Rh(this,"has",(e=>{try{const t=this.formatTarget(e);return typeof this.getExpiration(t)<"u"}catch{return!1}})),Rh(this,"set",((e,t)=>{this.isInitialized();const n=this.formatTarget(e),i={target:n,expiry:t};this.expirations.set(n,i),this.checkExpiry(n,i),this.events.emit(oo.created,{target:n,expiration:i})})),Rh(this,"get",(e=>{this.isInitialized();const t=this.formatTarget(e);return this.getExpiration(t)})),Rh(this,"del",(e=>{if(this.isInitialized(),this.has(e)){const t=this.formatTarget(e),n=this.getExpiration(t);this.expirations.delete(t),this.events.emit(oo.deleted,{target:t,expiration:n})}})),Rh(this,"on",((e,t)=>{this.events.on(e,t)})),Rh(this,"once",((e,t)=>{this.events.once(e,t)})),Rh(this,"off",((e,t)=>{this.events.off(e,t)})),Rh(this,"removeListener",((e,t)=>{this.events.removeListener(e,t)})),this.logger=(0,a.U5)(t,this.name)}get context(){return(0,a.oI)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return H(e);if("number"==typeof e)return G(e);const{message:t}=_r("UNKNOWN_TYPE","Target type: "+typeof e);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(oo.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:e}=_r("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:t}=_r("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(t),new Error(t)}return t}checkExpiry(e,t){const{expiry:n}=t;(0,h.toMiliseconds)(n)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(oo.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach(((e,t)=>this.checkExpiry(t,e)))}registerEventListeners(){this.core.heartbeat.on(s.li.pulse,(()=>this.checkExpirations())),this.events.on(oo.created,(e=>{const t=oo.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})),this.events.on(oo.expired,(e=>{const t=oo.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})),this.events.on(oo.deleted,(e=>{const t=oo.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}))}isInitialized(){if(!this.initialized){const{message:e}=_r("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Th=Object.defineProperty,kh=(e,t,n)=>t in e?Th(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ah=(e,t,n)=>kh(e,"symbol"!=typeof t?t+"":t,n);class Nh extends c.zl{constructor(e,t,n){super(e,t,n),this.core=e,this.logger=t,this.store=n,Ah(this,"name",co),Ah(this,"abortController"),Ah(this,"isDevEnv"),Ah(this,"verifyUrlV3",po),Ah(this,"storagePrefix",Is),Ah(this,"version",_s),Ah(this,"publicKey"),Ah(this,"fetchPromise"),Ah(this,"init",(async()=>{var e;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,h.toMiliseconds)(null==(e=this.publicKey)?void 0:e.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))})),Ah(this,"register",(async e=>{if(!A()||this.isDevEnv)return;const t=window.location.origin,{id:n,decryptedId:i}=e,r=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${t}&id=${n}&decryptedId=${i}`;try{const e=(0,d.getDocument)(),t=this.startAbortTimer(5*h.ONE_SECOND),i=await new Promise(((i,s)=>{const o=()=>{window.removeEventListener("message",c),e.body.removeChild(a),s("attestation aborted")};this.abortController.signal.addEventListener("abort",o);const a=e.createElement("iframe");a.src=r,a.style.display="none",a.addEventListener("error",o,{signal:this.abortController.signal});const c=r=>{if(r.data&&"string"==typeof r.data)try{const s=JSON.parse(r.data);if("verify_attestation"===s.type){if((0,u.Cq)(s.attestation).payload.id!==n)return;clearInterval(t),e.body.removeChild(a),this.abortController.signal.removeEventListener("abort",o),window.removeEventListener("message",c),i(null===s.attestation?"":s.attestation)}}catch($u){this.logger.warn($u)}};e.body.appendChild(a),window.addEventListener("message",c,{signal:this.abortController.signal})}));return this.logger.debug("jwt attestation",i),i}catch(Xl){this.logger.warn(Xl)}return""})),Ah(this,"resolve",(async e=>{if(this.isDevEnv)return"";const{attestationId:t,hash:n,encryptedId:i}=e;if(""===t)return void this.logger.debug("resolve: attestationId is empty, skipping");if(t){if((0,u.Cq)(t).payload.id!==i)return;const e=await this.isValidJwtAttestation(t);if(e)return e.isVerified?e:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!n)return;const r=this.getVerifyUrl(e?.verifyUrl);return this.fetchAttestation(n,r)})),Ah(this,"fetchAttestation",(async(e,t)=>{this.logger.debug(`resolving attestation: ${e} from url: ${t}`);const n=this.startAbortTimer(5*h.ONE_SECOND),i=await fetch(`${t}/attestation/${e}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(n),200===i.status?await i.json():void 0})),Ah(this,"getVerifyUrl",(e=>{let t=e||uo;return go.includes(t)||(this.logger.info(`verify url: ${t}, not included in trusted list, assigning default: ${uo}`),t=uo),t})),Ah(this,"fetchPublicKey",(async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const e=this.startAbortTimer(h.FIVE_SECONDS),t=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(e),await t.json()}catch(e){this.logger.warn(e)}})),Ah(this,"persistPublicKey",(async e=>{this.logger.debug("persisting public key to local storage",e),await this.store.setItem(this.storeKey,e),this.publicKey=e})),Ah(this,"removePublicKey",(async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0})),Ah(this,"isValidJwtAttestation",(async e=>{const t=await this.getPublicKey();try{if(t)return this.validateAttestation(e,t)}catch(i){this.logger.error(i),this.logger.warn("error validating attestation")}const n=await this.fetchAndPersistPublicKey();try{if(n)return this.validateAttestation(e,n)}catch(i){this.logger.error(i),this.logger.warn("error validating attestation")}})),Ah(this,"getPublicKey",(async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey())),Ah(this,"fetchAndPersistPublicKey",(async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise((async e=>{const t=await this.fetchPublicKey();t&&(await this.persistPublicKey(t),e(t))}));const e=await this.fetchPromise;return this.fetchPromise=void 0,e})),Ah(this,"validateAttestation",((e,t)=>{const n=ir(e,t.publicKey),i={hasExpired:(0,h.toMiliseconds)(n.exp)<Date.now(),payload:n};if(i.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:i.payload.origin,isScam:i.payload.isScam,isVerified:i.payload.isVerified}})),this.logger=(0,a.U5)(t,this.name),this.abortController=new AbortController,this.isDevEnv=se(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return(0,a.oI)(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout((()=>this.abortController.abort()),(0,h.toMiliseconds)(e))}}var Ch=Object.defineProperty,qh=(e,t,n)=>t in e?Ch(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Dh=(e,t,n)=>qh(e,"symbol"!=typeof t?t+"":t,n);class Lh extends c.GF{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Dh(this,"context",fo),Dh(this,"registerDeviceToken",(async e=>{const{clientId:t,token:n,notificationType:i,enableEncrypted:r=!1}=e,s=`${yo}/${this.projectId}/clients`;await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:t,type:i,token:n,always_raw:r})})})),this.logger=(0,a.U5)(t,this.context)}}var Uh=Object.defineProperty,jh=Object.getOwnPropertySymbols,$h=Object.prototype.hasOwnProperty,Mh=Object.prototype.propertyIsEnumerable,Kh=(e,t,n)=>t in e?Uh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,zh=(e,t)=>{for(var n in t||(t={}))$h.call(t,n)&&Kh(e,n,t[n]);if(jh)for(var n of jh(t))Mh.call(t,n)&&Kh(e,n,t[n]);return e},Bh=(e,t,n)=>Kh(e,"symbol"!=typeof t?t+"":t,n);class Vh extends c.$Q{constructor(e,t,n=!0){super(e,t,n),this.core=e,this.logger=t,Bh(this,"context",So),Bh(this,"storagePrefix",Is),Bh(this,"storageVersion",Io),Bh(this,"events",new Map),Bh(this,"shouldPersist",!1),Bh(this,"init",(async()=>{if(!se())try{const e={eventId:re(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:j(this.core.relayer.protocol,this.core.relayer.version,Bs)}}};await this.sendEvent([e])}catch(e){this.logger.warn(e)}})),Bh(this,"createEvent",(e=>{const{event:t="ERROR",type:n="",properties:{topic:i,trace:r}}=e,s=re(),o=this.core.projectId||"",a=Date.now(),c=zh({eventId:s,timestamp:a,props:{event:t,type:n,properties:{topic:i,trace:r}},bundleId:o,domain:this.getAppDomain()},this.setMethods(s));return this.telemetryEnabled&&(this.events.set(s,c),this.shouldPersist=!0),c})),Bh(this,"getEvent",(e=>{const{eventId:t,topic:n}=e;if(t)return this.events.get(t);const i=Array.from(this.events.values()).find((e=>e.props.properties.topic===n));return i?zh(zh({},i),this.setMethods(i.eventId)):void 0})),Bh(this,"deleteEvent",(e=>{const{eventId:t}=e;this.events.delete(t),this.shouldPersist=!0})),Bh(this,"setEventListeners",(()=>{this.core.heartbeat.on(s.li.pulse,(async()=>{this.shouldPersist&&await this.persist(),this.events.forEach((e=>{(0,h.fromMiliseconds)(Date.now())-(0,h.fromMiliseconds)(e.timestamp)>xo&&(this.events.delete(e.eventId),this.shouldPersist=!0)}))}))})),Bh(this,"setMethods",(e=>({addTrace:t=>this.addTrace(e,t),setError:t=>this.setError(e,t)}))),Bh(this,"addTrace",((e,t)=>{const n=this.events.get(e);n&&(n.props.properties.trace.push(t),this.events.set(e,n),this.shouldPersist=!0)})),Bh(this,"setError",((e,t)=>{const n=this.events.get(e);n&&(n.props.type=t,n.timestamp=Date.now(),this.events.set(e,n),this.shouldPersist=!0)})),Bh(this,"persist",(async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1})),Bh(this,"restore",(async()=>{try{const e=await this.core.storage.getItem(this.storageKey)||[];if(!e.length)return;e.forEach((e=>{this.events.set(e.eventId,zh(zh({},e),this.setMethods(e.eventId)))}))}catch(e){this.logger.warn(e)}})),Bh(this,"submit",(async()=>{if(!this.telemetryEnabled||0===this.events.size)return;const e=[];for(const[n,i]of this.events)i.props.type&&e.push(i);if(0!==e.length)try{if((await this.sendEvent(e)).ok)for(const t of e)this.events.delete(t.eventId),this.shouldPersist=!0}catch(t){this.logger.warn(t)}})),Bh(this,"sendEvent",(async e=>{const t=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Po}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Bs}${t}`,{method:"POST",body:JSON.stringify(e)})})),Bh(this,"getAppDomain",(()=>D().url)),this.logger=(0,a.U5)(t,this.context),this.telemetryEnabled=n,n?this.restore().then((async()=>{await this.submit(),this.setEventListeners()})):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var Fh=Object.defineProperty,Hh=Object.getOwnPropertySymbols,Gh=Object.prototype.hasOwnProperty,Jh=Object.prototype.propertyIsEnumerable,Qh=(e,t,n)=>t in e?Fh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Wh=(e,t)=>{for(var n in t||(t={}))Gh.call(t,n)&&Qh(e,n,t[n]);if(Hh)for(var n of Hh(t))Jh.call(t,n)&&Qh(e,n,t[n]);return e},Yh=(e,t,n)=>Qh(e,"symbol"!=typeof t?t+"":t,n);class Zh extends c.ZP{constructor(e){var t;super(e),Yh(this,"protocol",vs),Yh(this,"version",_s),Yh(this,"name",Es),Yh(this,"relayUrl"),Yh(this,"projectId"),Yh(this,"customStoragePrefix"),Yh(this,"events",new i.EventEmitter),Yh(this,"logger"),Yh(this,"heartbeat"),Yh(this,"relayer"),Yh(this,"crypto"),Yh(this,"storage"),Yh(this,"history"),Yh(this,"expirer"),Yh(this,"pairing"),Yh(this,"verify"),Yh(this,"echoClient"),Yh(this,"linkModeSupportedApps"),Yh(this,"eventClient"),Yh(this,"initialized",!1),Yh(this,"logChunkController"),Yh(this,"on",((e,t)=>this.events.on(e,t))),Yh(this,"once",((e,t)=>this.events.once(e,t))),Yh(this,"off",((e,t)=>this.events.off(e,t))),Yh(this,"removeListener",((e,t)=>this.events.removeListener(e,t))),Yh(this,"dispatchEnvelope",(({topic:e,message:t,sessionExists:n})=>{if(!e||!t)return;const i={topic:e,message:t,publishedAt:Date.now(),transportType:Vs.link_mode};this.relayer.onLinkMessageEvent(i,{sessionExists:n})})),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Us,this.customStoragePrefix=null!=e&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const n=(0,a.iP)({level:"string"==typeof e?.logger&&e.logger?e.logger:Ss.logger,name:Es}),{logger:r,chunkLoggerController:c}=(0,a.D5)({opts:n,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=c,null!=(t=this.logChunkController)&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var e,t;null!=(e=this.logChunkController)&&e.downloadLogsBlobInBrowser&&(null==(t=this.logChunkController)||t.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=(0,a.U5)(r,this.name),this.heartbeat=new s.VH,this.crypto=new Sc(this,this.logger,e?.keychain),this.history=new Sh(this,this.logger),this.expirer=new Oh(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new o.A(Wh(Wh({},xs),e?.storageOptions)),this.relayer=new ch({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new vh(this,this.logger),this.verify=new Nh(this,this.logger,this.storage),this.echoClient=new Lh(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Vh(this,this.logger,e?.telemetryEnabled)}static async init(e){const t=new Zh(e);await t.initialize();const n=await t.crypto.getClientId();return await t.storage.setItem(Hs,n),t}get context(){return(0,a.oI)(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return null==(e=this.logChunkController)?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Gs,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Gs)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Xh=Zh,el="wc",tl=2,nl="client",il=`${el}@${tl}:${nl}:`,rl={name:nl,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},sl="WALLETCONNECT_DEEPLINK_CHOICE",ol="proposal",al="Proposal expired",cl="session",hl=h.SEVEN_DAYS,ll="engine",ul={wc_sessionPropose:{req:{ttl:h.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:h.ONE_DAY,prompt:!1,tag:1104},res:{ttl:h.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:h.ONE_DAY,prompt:!1,tag:1106},res:{ttl:h.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:h.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:h.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:h.ONE_DAY,prompt:!1,tag:1112},res:{ttl:h.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:h.ONE_DAY,prompt:!1,tag:1114},res:{ttl:h.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:h.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:h.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:h.FIVE_MINUTES,prompt:!1,tag:1119}}},pl={min:h.FIVE_MINUTES,max:h.SEVEN_DAYS},dl={idle:"IDLE",active:"ACTIVE"},gl={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},fl="request",yl=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],ml="wc",wl="auth",bl="authKeys",vl="pairingTopics",_l="requests",El=`${ml}@1.5:${wl}:`,Il=`${El}:PUB_KEY`;var Sl=Object.defineProperty,xl=Object.defineProperties,Pl=Object.getOwnPropertyDescriptors,Rl=Object.getOwnPropertySymbols,Ol=Object.prototype.hasOwnProperty,Tl=Object.prototype.propertyIsEnumerable,kl=(e,t,n)=>t in e?Sl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Al=(e,t)=>{for(var n in t||(t={}))Ol.call(t,n)&&kl(e,n,t[n]);if(Rl)for(var n of Rl(t))Tl.call(t,n)&&kl(e,n,t[n]);return e},Nl=(e,t)=>xl(e,Pl(t)),Cl=(e,t,n)=>kl(e,"symbol"!=typeof t?t+"":t,n);class ql extends c.yJ{constructor(e){super(e),Cl(this,"name",ll),Cl(this,"events",new(r())),Cl(this,"initialized",!1),Cl(this,"requestQueue",{state:dl.idle,queue:[]}),Cl(this,"sessionRequestQueue",{state:dl.idle,queue:[]}),Cl(this,"requestQueueDelay",h.ONE_SECOND),Cl(this,"expectedPairingMethodMap",new Map),Cl(this,"recentlyDeletedMap",new Map),Cl(this,"recentlyDeletedLimit",200),Cl(this,"relayMessageCache",[]),Cl(this,"init",(async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(ul)}),this.initialized=!0,setTimeout((()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()}),(0,h.toMiliseconds)(this.requestQueueDelay)))})),Cl(this,"connect",(async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const t=Nl(Al({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(t);const{pairingTopic:n,requiredNamespaces:i,optionalNamespaces:r,sessionProperties:s,relays:o}=t;let a,c=n,l=!1;try{if(c){const e=this.client.core.pairing.pairings.get(c);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),l=e.active}}catch(Yh){throw this.client.logger.error(`connect() -> pairing.get(${c}) failed`),Yh}if(!c||!l){const{topic:e,uri:t}=await this.client.core.pairing.create();c=e,a=t}if(!c){const{message:e}=_r("NO_MATCHING_KEY",`connect() pairing topic: ${c}`);throw new Error(e)}const u=await this.client.core.crypto.generateKeyPair(),p=ul.wc_sessionPropose.req.ttl||h.FIVE_MINUTES,d=Q(p),g=Al({requiredNamespaces:i,optionalNamespaces:r,relays:o??[{protocol:Ds}],proposer:{publicKey:u,metadata:this.client.metadata},expiryTimestamp:d,pairingTopic:c},s&&{sessionProperties:s}),{reject:f,resolve:y,done:m}=B(p,al);this.events.once(Y("session_connect"),(async({error:e,session:t})=>{if(e)f(e);else if(t){t.self.publicKey=u;const e=Nl(Al({},t),{pairingTopic:g.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,transportType:Vs.relay});await this.client.session.set(t.topic,e),await this.setExpiry(t.topic,t.expiry),c&&await this.client.core.pairing.updateMetadata({topic:c,metadata:t.peer.metadata}),this.cleanupDuplicatePairings(e),y(e)}}));const w=await this.sendRequest({topic:c,method:"wc_sessionPropose",params:g,throwOnFailedPublish:!0});return await this.setProposal(w,Al({id:w},g)),{uri:a,approval:m}})),Cl(this,"pair",(async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(t){throw this.client.logger.error("pair() failed"),t}})),Cl(this,"approve",(async e=>{var t,n,i;const r=this.client.core.eventClient.createEvent({properties:{topic:null==(t=e?.id)?void 0:t.toString(),trace:[bo.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(uu){throw r.setError(vo.no_internet_connection),uu}try{await this.isValidProposalId(e?.id)}catch(uu){throw this.client.logger.error(`approve() -> proposal.get(${e?.id}) failed`),r.setError(vo.proposal_not_found),uu}try{await this.isValidApprove(e)}catch(uu){throw this.client.logger.error("approve() -> isValidApprove() failed"),r.setError(vo.session_approve_namespace_validation_failure),uu}const{id:s,relayProtocol:o,namespaces:a,sessionProperties:c,sessionConfig:h}=e,l=this.client.proposal.get(s);this.client.core.eventClient.deleteEvent({eventId:r.eventId});const{pairingTopic:u,proposer:p,requiredNamespaces:d,optionalNamespaces:g}=l;let f=null==(n=this.client.core.eventClient)?void 0:n.getEvent({topic:u});f||(f=null==(i=this.client.core.eventClient)?void 0:i.createEvent({type:bo.session_approve_started,properties:{topic:u,trace:[bo.session_approve_started,bo.session_namespaces_validation_success]}}));const y=await this.client.core.crypto.generateKeyPair(),m=p.publicKey,w=await this.client.core.crypto.generateSharedKey(y,m),b=Al(Al({relay:{protocol:o??"irn"},namespaces:a,controller:{publicKey:y,metadata:this.client.metadata},expiry:Q(hl)},c&&{sessionProperties:c}),h&&{sessionConfig:h}),v=Vs.relay;f.addTrace(bo.subscribing_session_topic);try{await this.client.core.relayer.subscribe(w,{transportType:v})}catch(uu){throw f.setError(vo.subscribe_session_topic_failure),uu}f.addTrace(bo.subscribe_session_topic_success);const _=Nl(Al({},b),{topic:w,requiredNamespaces:d,optionalNamespaces:g,pairingTopic:u,acknowledged:!1,self:b.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:y,transportType:Vs.relay});await this.client.session.set(w,_),f.addTrace(bo.store_session);try{f.addTrace(bo.publishing_session_settle),await this.sendRequest({topic:w,method:"wc_sessionSettle",params:b,throwOnFailedPublish:!0}).catch((e=>{throw f?.setError(vo.session_settle_publish_failure),e})),f.addTrace(bo.session_settle_publish_success),f.addTrace(bo.publishing_session_approve),await this.sendResult({id:s,topic:u,result:{relay:{protocol:o??"irn"},responderPublicKey:y},throwOnFailedPublish:!0}).catch((e=>{throw f?.setError(vo.session_approve_publish_failure),e})),f.addTrace(bo.session_approve_publish_success)}catch(uu){throw this.client.logger.error(uu),this.client.session.delete(w,Er("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(w),uu}return this.client.core.eventClient.deleteEvent({eventId:f.eventId}),await this.client.core.pairing.updateMetadata({topic:u,metadata:p.metadata}),await this.client.proposal.delete(s,Er("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:u}),await this.setExpiry(w,Q(hl)),{topic:w,acknowledged:()=>Promise.resolve(this.client.session.get(w))}})),Cl(this,"reject",(async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(r){throw this.client.logger.error("reject() -> isValidReject() failed"),r}const{id:t,reason:n}=e;let i;try{i=this.client.proposal.get(t).pairingTopic}catch(r){throw this.client.logger.error(`reject() -> proposal.get(${t}) failed`),r}i&&(await this.sendError({id:t,topic:i,error:n,rpcOpts:ul.wc_sessionPropose.reject}),await this.client.proposal.delete(t,Er("USER_DISCONNECTED")))})),Cl(this,"update",(async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:t,namespaces:n}=e,{done:i,resolve:r,reject:s}=B(),o=(0,ys.payloadId)(),a=(0,ys.getBigIntRpcId)().toString(),c=this.client.session.get(t).namespaces;return this.events.once(Y("session_update",o),(({error:e})=>{e?s(e):r()})),await this.client.session.update(t,{namespaces:n}),await this.sendRequest({topic:t,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:o,relayRpcId:a}).catch((e=>{this.client.logger.error(e),this.client.session.update(t,{namespaces:c}),s(e)})),{acknowledged:i}})),Cl(this,"extend",(async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(o){throw this.client.logger.error("extend() -> isValidExtend() failed"),o}const{topic:t}=e,n=(0,ys.payloadId)(),{done:i,resolve:r,reject:s}=B();return this.events.once(Y("session_extend",n),(({error:e})=>{e?s(e):r()})),await this.setExpiry(t,Q(hl)),this.sendRequest({topic:t,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch((e=>{s(e)})),{acknowledged:i}})),Cl(this,"request",(async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(ah){throw this.client.logger.error("request() -> isValidRequest() failed"),ah}const{chainId:t,request:n,topic:i,expiry:r=ul.wc_sessionRequest.req.ttl}=e,s=this.client.session.get(i);s?.transportType===Vs.relay&&await this.confirmOnlineStateOrThrow();const o=(0,ys.payloadId)(),a=(0,ys.getBigIntRpcId)().toString(),{done:c,resolve:h,reject:l}=B(r,"Request expired. Please try again.");this.events.once(Y("session_request",o),(({error:e,result:t})=>{e?l(e):h(t)}));const u="wc_sessionRequest",p=this.getAppLinkIfEnabled(s.peer.metadata,s.transportType);if(p)return await this.sendRequest({clientRpcId:o,relayRpcId:a,topic:i,method:u,params:{request:Nl(Al({},n),{expiryTimestamp:Q(r)}),chainId:t},expiry:r,throwOnFailedPublish:!0,appLink:p}).catch((e=>l(e))),this.client.events.emit("session_request_sent",{topic:i,request:n,chainId:t,id:o}),await c();const d={request:Nl(Al({},n),{expiryTimestamp:Q(r)}),chainId:t},g=this.shouldSetTVF(u,d);return await Promise.all([new Promise((async e=>{await this.sendRequest(Al({clientRpcId:o,relayRpcId:a,topic:i,method:u,params:d,expiry:r,throwOnFailedPublish:!0},g&&{tvf:this.getTVFParams(o,d)})).catch((e=>l(e))),this.client.events.emit("session_request_sent",{topic:i,request:n,chainId:t,id:o}),e()})),new Promise((async e=>{var t;if(null==(t=s.sessionConfig)||!t.disableDeepLink){const e=await ne(this.client.core.storage,sl);await X({id:o,topic:i,wcDeepLink:e})}e()})),c()]).then((e=>e[2]))})),Cl(this,"respond",(async e=>{this.isInitialized(),await this.isValidRespond(e);const{topic:t,response:n}=e,{id:i}=n,r=this.client.session.get(t);r.transportType===Vs.relay&&await this.confirmOnlineStateOrThrow();const s=this.getAppLinkIfEnabled(r.peer.metadata,r.transportType);(0,ys.isJsonRpcResult)(n)?await this.sendResult({id:i,topic:t,result:n.result,throwOnFailedPublish:!0,appLink:s}):(0,ys.isJsonRpcError)(n)&&await this.sendError({id:i,topic:t,error:n.error,appLink:s}),this.cleanupAfterResponse(e)})),Cl(this,"ping",(async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}const{topic:t}=e;if(this.client.session.keys.includes(t)){const e=(0,ys.payloadId)(),n=(0,ys.getBigIntRpcId)().toString(),{done:i,resolve:r,reject:s}=B();this.events.once(Y("session_ping",e),(({error:e})=>{e?s(e):r()})),await Promise.all([this.sendRequest({topic:t,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:e,relayRpcId:n}),i()])}else this.client.core.pairing.pairings.keys.includes(t)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:t}))})),Cl(this,"emit",(async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);const{topic:t,event:n,chainId:i}=e,r=(0,ys.getBigIntRpcId)().toString(),s=(0,ys.payloadId)();await this.sendRequest({topic:t,method:"wc_sessionEvent",params:{event:n,chainId:i},throwOnFailedPublish:!0,relayRpcId:r,clientRpcId:s})})),Cl(this,"disconnect",(async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);const{topic:t}=e;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:"wc_sessionDelete",params:Er("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else{if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:e}=_r("MISMATCHED_TOPIC",`Session or pairing topic not found: ${t}`);throw new Error(e)}await this.client.core.pairing.disconnect({topic:t})}})),Cl(this,"find",(e=>(this.isInitialized(),this.client.session.getAll().filter((t=>Or(t,e)))))),Cl(this,"getPendingSessionRequests",(()=>this.client.pendingRequest.getAll())),Cl(this,"authenticate",(async(e,t)=>{var n;this.isInitialized(),this.isValidAuthenticate(e);const i=t&&this.client.core.linkModeSupportedApps.includes(t)&&(null==(n=this.client.metadata.redirect)?void 0:n.linkMode),r=i?Vs.link_mode:Vs.relay;r===Vs.relay&&await this.confirmOnlineStateOrThrow();const{chains:s,statement:o="",uri:a,domain:c,nonce:h,type:l,exp:u,nbf:p,methods:d=[],expiry:g}=e,f=[...e.resources||[]],{topic:y,uri:m}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:r});this.client.logger.info({message:"Generated new pairing",pairing:{topic:y,uri:m}});const w=await this.client.core.crypto.generateKeyPair(),b=Mi(w);if(await Promise.all([this.client.auth.authKeys.set(Il,{responseTopic:b,publicKey:w}),this.client.auth.pairingTopics.set(b,{topic:b,pairingTopic:y})]),await this.client.core.relayer.subscribe(b,{transportType:r}),this.client.logger.info(`sending request to new pairing topic: ${y}`),d.length>0){const{namespace:e}=E(s[0]);let t=Tt(e,"request",d);Lt(f)&&(t=At(t,f.pop())),f.push(t)}const v=g&&g>ul.wc_sessionAuthenticate.req.ttl?g:ul.wc_sessionAuthenticate.req.ttl,_={authPayload:{type:l??"caip122",chains:s,statement:o,aud:a,domain:c,version:"1",nonce:h,iat:(new Date).toISOString(),exp:u,nbf:p,resources:f},requester:{publicKey:w,metadata:this.client.metadata},expiryTimestamp:Q(v)},I={eip155:{chains:s,methods:[...new Set(["personal_sign",...d])],events:["chainChanged","accountsChanged"]}},S={requiredNamespaces:{},optionalNamespaces:I,relays:[{protocol:"irn"}],pairingTopic:y,proposer:{publicKey:w,metadata:this.client.metadata},expiryTimestamp:Q(ul.wc_sessionPropose.req.ttl)},{done:x,resolve:P,reject:R}=B(v,"Request expired"),O=async({error:e,session:t})=>{if(this.events.off(Y("session_request",k),T),e)R(e);else if(t){t.self.publicKey=w,await this.client.session.set(t.topic,t),await this.setExpiry(t.topic,t.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:t.peer.metadata});const e=this.client.session.get(t.topic);await this.deleteProposal(A),P({session:e})}},T=async e=>{var n,i,s;if(await this.deletePendingAuthRequest(k,{message:"fulfilled",code:0}),e.error){const t=Er("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return e.error.code===t.code?void 0:(this.events.off(Y("session_connect"),O),R(e.error.message))}await this.deleteProposal(A),this.events.off(Y("session_connect"),O);const{cacaos:o,responder:a}=e.result,c=[],h=[];for(const t of o){await vt({cacao:t,projectId:this.client.core.projectId})||(this.client.logger.error(t,"Signature verification failed"),R(Er("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:e}=t,n=Lt(e.resources),i=[wt(e.iss)],r=bt(e.iss);if(n){const e=qt(n),t=Dt(n);c.push(...e),i.push(...t)}for(const t of i)h.push(`${t}:${r}`)}const l=await this.client.core.crypto.generateSharedKey(w,a.publicKey);let u;c.length>0&&(u={topic:l,acknowledged:!0,self:{publicKey:w,metadata:this.client.metadata},peer:a,controller:a.publicKey,expiry:Q(hl),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:y,namespaces:wr([...new Set(c)],[...new Set(h)]),transportType:r},await this.client.core.relayer.subscribe(l,{transportType:r}),await this.client.session.set(l,u),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:a.metadata}),u=this.client.session.get(l)),null!=(n=this.client.metadata.redirect)&&n.linkMode&&null!=(i=a.metadata.redirect)&&i.linkMode&&null!=(s=a.metadata.redirect)&&s.universal&&t&&(this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.session.update(l,{transportType:Vs.link_mode})),P({auths:o,session:u})},k=(0,ys.payloadId)(),A=(0,ys.payloadId)();let N;this.events.once(Y("session_connect"),O),this.events.once(Y("session_request",k),T);try{if(i){const e=(0,ys.formatJsonRpcRequest)("wc_sessionAuthenticate",_,k);this.client.core.history.set(y,e);const n=await this.client.core.crypto.encode("",e,{type:Ni,encoding:Oi});N=pr(t,y,n)}else await Promise.all([this.sendRequest({topic:y,method:"wc_sessionAuthenticate",params:_,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:k}),this.sendRequest({topic:y,method:"wc_sessionPropose",params:S,expiry:ul.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:A})])}catch(Pu){throw this.events.off(Y("session_connect"),O),this.events.off(Y("session_request",k),T),Pu}return await this.setProposal(A,Al({id:A},S)),await this.setAuthRequest(k,{request:Nl(Al({},_),{verifyContext:{}}),pairingTopic:y,transportType:r}),{uri:N??m,response:x}})),Cl(this,"approveSessionAuthenticate",(async e=>{const{id:t,auths:n}=e,i=this.client.core.eventClient.createEvent({properties:{topic:t.toString(),trace:[_o.authenticated_session_approve_started]}});try{this.isInitialized()}catch($s){throw i.setError(Eo.no_internet_connection),$s}const r=this.getPendingAuthRequest(t);if(!r)throw i.setError(Eo.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${t}`);const s=r.transportType||Vs.relay;s===Vs.relay&&await this.confirmOnlineStateOrThrow();const o=r.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Mi(o),h={type:Ai,receiverPublicKey:o,senderPublicKey:a},l=[],u=[];for(const g of n){if(!await vt({cacao:g,projectId:this.client.core.projectId})){i.setError(Eo.invalid_cacao);const e=Er("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:t,topic:c,error:e,encodeOpts:h}),new Error(e.message)}i.addTrace(_o.cacaos_verified);const{p:e}=g,n=Lt(e.resources),r=[wt(e.iss)],s=bt(e.iss);if(n){const e=qt(n),t=Dt(n);l.push(...e),r.push(...t)}for(const t of r)u.push(`${t}:${s}`)}const p=await this.client.core.crypto.generateSharedKey(a,o);let d;if(i.addTrace(_o.create_authenticated_session_topic),l?.length>0){d={topic:p,acknowledged:!0,self:{publicKey:a,metadata:this.client.metadata},peer:{publicKey:o,metadata:r.requester.metadata},controller:o,expiry:Q(hl),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:r.pairingTopic,namespaces:wr([...new Set(l)],[...new Set(u)]),transportType:s},i.addTrace(_o.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:s})}catch($s){throw i.setError(Eo.subscribe_authenticated_session_topic_failure),$s}i.addTrace(_o.subscribe_authenticated_session_topic_success),await this.client.session.set(p,d),i.addTrace(_o.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:r.pairingTopic,metadata:r.requester.metadata})}i.addTrace(_o.publishing_authenticated_session_approve);try{await this.sendResult({topic:c,id:t,result:{cacaos:n,responder:{publicKey:a,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(r.requester.metadata,s)})}catch($s){throw i.setError(Eo.authenticated_session_approve_publish_failure),$s}return await this.client.auth.requests.delete(t,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:r.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:d}})),Cl(this,"rejectSessionAuthenticate",(async e=>{this.isInitialized();const{id:t,reason:n}=e,i=this.getPendingAuthRequest(t);if(!i)throw new Error(`Could not find pending auth request with id ${t}`);i.transportType===Vs.relay&&await this.confirmOnlineStateOrThrow();const r=i.requester.publicKey,s=await this.client.core.crypto.generateKeyPair(),o=Mi(r),a={type:Ai,receiverPublicKey:r,senderPublicKey:s};await this.sendError({id:t,topic:o,error:n,encodeOpts:a,rpcOpts:ul.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(t,{message:"rejected",code:0}),await this.client.proposal.delete(t,Er("USER_DISCONNECTED"))})),Cl(this,"formatAuthMessage",(e=>{this.isInitialized();const{request:t,iss:n}=e;return _t(t,n)})),Cl(this,"processRelayMessageCache",(()=>{setTimeout((async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{const e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(e){this.client.logger.error(e)}}),50)})),Cl(this,"cleanupDuplicatePairings",(async e=>{if(e.pairingTopic)try{const t=this.client.core.pairing.pairings.get(e.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter((n=>{var i,r;return(null==(i=n.peerMetadata)?void 0:i.url)&&(null==(r=n.peerMetadata)?void 0:r.url)===e.peer.metadata.url&&n.topic&&n.topic!==t.topic}));if(0===n.length)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map((e=>this.client.core.pairing.disconnect({topic:e.topic})))),this.client.logger.info("Duplicate pairings clean up finished")}catch(t){this.client.logger.error(t)}})),Cl(this,"deleteSession",(async e=>{var t;const{topic:n,expirerHasDeleted:i=!1,emitEvent:r=!0,id:s=0}=e,{self:o}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,Er("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),i||this.client.core.expirer.del(n),this.client.core.storage.removeItem(sl).catch((e=>this.client.logger.warn(e))),this.getPendingSessionRequests().forEach((e=>{e.topic===n&&this.deletePendingSessionRequest(e.id,Er("USER_DISCONNECTED"))})),n===(null==(t=this.sessionRequestQueue.queue[0])?void 0:t.topic)&&(this.sessionRequestQueue.state=dl.idle),r&&this.client.events.emit("session_delete",{id:s,topic:n})})),Cl(this,"deleteProposal",(async(e,t)=>{if(t)try{const t=this.client.proposal.get(e),n=this.client.core.eventClient.getEvent({topic:t.pairingTopic});n?.setError(vo.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(e,Er("USER_DISCONNECTED")),t?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"proposal")})),Cl(this,"deletePendingSessionRequest",(async(e,t,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,t),n?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter((t=>t.id!==e)),n&&(this.sessionRequestQueue.state=dl.idle,this.client.events.emit("session_request_expire",{id:e}))})),Cl(this,"deletePendingAuthRequest",(async(e,t,n=!1)=>{await Promise.all([this.client.auth.requests.delete(e,t),n?Promise.resolve():this.client.core.expirer.del(e)])})),Cl(this,"setExpiry",(async(e,t)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,t),await this.client.session.update(e,{expiry:t}))})),Cl(this,"setProposal",(async(e,t)=>{this.client.core.expirer.set(e,Q(ul.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,t)})),Cl(this,"setAuthRequest",(async(e,t)=>{const{request:n,pairingTopic:i,transportType:r=Vs.relay}=t;this.client.core.expirer.set(e,n.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:e,pairingTopic:i,verifyContext:n.verifyContext,transportType:r})})),Cl(this,"setPendingSessionRequest",(async e=>{const{id:t,topic:n,params:i,verifyContext:r}=e,s=i.request.expiryTimestamp||Q(ul.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,s),await this.client.pendingRequest.set(t,{id:t,topic:n,params:i,verifyContext:r})})),Cl(this,"sendRequest",(async e=>{const{topic:t,method:i,params:r,expiry:s,relayRpcId:o,clientRpcId:a,throwOnFailedPublish:c,appLink:h,tvf:l}=e,u=(0,ys.formatJsonRpcRequest)(i,r,a);let p;const d=!!h;try{const e=d?Oi:Ri;p=await this.client.core.crypto.encode(t,u,{encoding:e})}catch(ah){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${t} failed`),ah}let g;if(yl.includes(i)){const e=Ki(JSON.stringify(u)),t=Ki(p);g=await this.client.core.verify.register({id:t,decryptedId:e})}const f=ul[i].req;if(f.attestation=g,s&&(f.ttl=s),o&&(f.id=o),this.client.core.history.set(t,u),d){const e=pr(h,t,p);await n.g.Linking.openURL(e,this.client.name)}else{const e=ul[i].req;s&&(e.ttl=s),o&&(e.id=o),e.tvf=Nl(Al({},l),{correlationId:u.id}),c?(e.internal=Nl(Al({},e.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(t,p,e)):this.client.core.relayer.publish(t,p,e).catch((e=>this.client.logger.error(e)))}return u.id})),Cl(this,"sendResult",(async e=>{const{id:t,topic:i,result:r,throwOnFailedPublish:s,encodeOpts:o,appLink:a}=e,c=(0,ys.formatJsonRpcResult)(t,r);let h;const l=a&&typeof(null==n.g?void 0:n.g.Linking)<"u";try{const e=l?Oi:Ri;h=await this.client.core.crypto.encode(i,c,Nl(Al({},o||{}),{encoding:e}))}catch(nu){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),nu}let u,p;try{u=await this.client.core.history.get(i,t);const e=u.request;try{this.shouldSetTVF(e.method,e.params)&&(p=this.getTVFParams(t,e.params,r))}catch(Ih){this.client.logger.warn("sendResult() -> getTVFParams() failed",Ih)}}catch(nu){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${t}) failed`),nu}if(l){const e=pr(a,i,h);await n.g.Linking.openURL(e,this.client.name)}else{const e=ul[u.request.method].res;e.tvf=Nl(Al({},p),{correlationId:t}),s?(e.internal=Nl(Al({},e.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,h,e)):this.client.core.relayer.publish(i,h,e).catch((e=>this.client.logger.error(e)))}await this.client.core.history.resolve(c)})),Cl(this,"sendError",(async e=>{const{id:t,topic:i,error:r,encodeOpts:s,rpcOpts:o,appLink:a}=e,c=(0,ys.formatJsonRpcError)(t,r);let h;const l=a&&typeof(null==n.g?void 0:n.g.Linking)<"u";try{const e=l?Oi:Ri;h=await this.client.core.crypto.encode(i,c,Nl(Al({},s||{}),{encoding:e}))}catch(Xl){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),Xl}let u;try{u=await this.client.core.history.get(i,t)}catch(Xl){throw this.client.logger.error(`sendError() -> history.get(${i}, ${t}) failed`),Xl}if(l){const e=pr(a,i,h);await n.g.Linking.openURL(e,this.client.name)}else{const e=o||ul[u.request.method].res;this.client.core.relayer.publish(i,h,e)}await this.client.core.history.resolve(c)})),Cl(this,"cleanup",(async()=>{const e=[],t=[];this.client.session.getAll().forEach((t=>{let n=!1;W(t.expiry)&&(n=!0),this.client.core.crypto.keychain.has(t.topic)||(n=!0),n&&e.push(t.topic)})),this.client.proposal.getAll().forEach((e=>{W(e.expiryTimestamp)&&t.push(e.id)})),await Promise.all([...e.map((e=>this.deleteSession({topic:e}))),...t.map((e=>this.deleteProposal(e)))])})),Cl(this,"onRelayEventRequest",(async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()})),Cl(this,"processRequestsQueue",(async()=>{if(this.requestQueue.state!==dl.active){for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=dl.active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(e){this.client.logger.warn(e)}}this.requestQueue.state=dl.idle}else this.client.logger.info("Request queue already active, skipping...")})),Cl(this,"processRequest",(async e=>{const{topic:t,payload:n,attestation:i,transportType:r,encryptedId:s}=e,o=n.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:o}))switch(o){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:t,payload:n,attestation:i,encryptedId:s});case"wc_sessionSettle":return await this.onSessionSettleRequest(t,n);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(t,n);case"wc_sessionExtend":return await this.onSessionExtendRequest(t,n);case"wc_sessionPing":return await this.onSessionPingRequest(t,n);case"wc_sessionDelete":return await this.onSessionDeleteRequest(t,n);case"wc_sessionRequest":return await this.onSessionRequest({topic:t,payload:n,attestation:i,encryptedId:s,transportType:r});case"wc_sessionEvent":return await this.onSessionEventRequest(t,n);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:t,payload:n,attestation:i,encryptedId:s,transportType:r});default:return this.client.logger.info(`Unsupported request method ${o}`)}})),Cl(this,"onRelayEventResponse",(async e=>{const{topic:t,payload:n,transportType:i}=e,r=(await this.client.core.history.get(t,n.id)).request.method;switch(r){case"wc_sessionPropose":return this.onSessionProposeResponse(t,n,i);case"wc_sessionSettle":return this.onSessionSettleResponse(t,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(t,n);case"wc_sessionExtend":return this.onSessionExtendResponse(t,n);case"wc_sessionPing":return this.onSessionPingResponse(t,n);case"wc_sessionRequest":return this.onSessionRequestResponse(t,n);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(t,n);default:return this.client.logger.info(`Unsupported response method ${r}`)}})),Cl(this,"onRelayEventUnknownPayload",(e=>{const{topic:t}=e,{message:n}=_r("MISSING_OR_INVALID",`Decoded payload on topic ${t} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)})),Cl(this,"shouldIgnorePairingRequest",(e=>{const{topic:t,requestMethod:n}=e,i=this.expectedPairingMethodMap.get(t);return!(!i||i.includes(n))&&!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)})),Cl(this,"onSessionProposeRequest",(async e=>{const{topic:t,payload:n,attestation:i,encryptedId:r}=e,{params:s,id:o}=n;try{const e=this.client.core.eventClient.getEvent({topic:t});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),e?.setError(wo.proposal_listener_not_found)),this.isValidConnect(Al({},n.params));const a=s.expiryTimestamp||Q(ul.wc_sessionPropose.req.ttl),c=Al({id:o,pairingTopic:t,expiryTimestamp:a},s);await this.setProposal(o,c);const h=await this.getVerifyContext({attestationId:i,hash:Ki(JSON.stringify(n)),encryptedId:r,metadata:c.proposer.metadata});e?.addTrace(mo.emit_session_proposal),this.client.events.emit("session_proposal",{id:o,params:c,verifyContext:h})}catch(Zl){await this.sendError({id:o,topic:t,error:Zl,rpcOpts:ul.wc_sessionPropose.autoReject}),this.client.logger.error(Zl)}})),Cl(this,"onSessionProposeResponse",(async(e,t,n)=>{const{id:i}=t;if((0,ys.isJsonRpcResult)(t)){const{result:r}=t;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:r});const s=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:s});const o=s.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:o});const a=r.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:a});const c=await this.client.core.crypto.generateSharedKey(o,a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:c});const h=await this.client.core.relayer.subscribe(c,{transportType:n});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:e})}else if((0,ys.isJsonRpcError)(t)){await this.client.proposal.delete(i,Er("USER_DISCONNECTED"));const e=Y("session_connect");if(0===this.events.listenerCount(e))throw new Error(`emitting ${e} without any listeners, 954`);this.events.emit(Y("session_connect"),{error:t.error})}})),Cl(this,"onSessionSettleRequest",(async(e,t)=>{const{id:n,params:i}=t;try{this.isValidSessionSettleRequest(i);const{relay:n,controller:r,expiry:s,namespaces:o,sessionProperties:a,sessionConfig:c}=t.params,h=Nl(Al(Al({topic:e,relay:n,expiry:s,namespaces:o,acknowledged:!0,pairingTopic:"",requiredNamespaces:{},optionalNamespaces:{},controller:r.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:r.publicKey,metadata:r.metadata}},a&&{sessionProperties:a}),c&&{sessionConfig:c}),{transportType:Vs.relay}),l=Y("session_connect");if(0===this.events.listenerCount(l))throw new Error(`emitting ${l} without any listeners 997`);this.events.emit(Y("session_connect"),{session:h}),await this.sendResult({id:t.id,topic:e,result:!0,throwOnFailedPublish:!0})}catch(r){await this.sendError({id:n,topic:e,error:r}),this.client.logger.error(r)}})),Cl(this,"onSessionSettleResponse",(async(e,t)=>{const{id:n}=t;(0,ys.isJsonRpcResult)(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(Y("session_approve",n),{})):(0,ys.isJsonRpcError)(t)&&(await this.client.session.delete(e,Er("USER_DISCONNECTED")),this.events.emit(Y("session_approve",n),{error:t.error}))})),Cl(this,"onSessionUpdateRequest",(async(e,t)=>{const{params:n,id:i}=t;try{const t=`${e}_session_update`,s=gs.get(t);if(s&&this.isRequestOutOfSync(s,i))return this.client.logger.warn(`Discarding out of sync request - ${i}`),void this.sendError({id:i,topic:e,error:Er("INVALID_UPDATE_REQUEST")});this.isValidUpdate(Al({topic:e},n));try{gs.set(t,i),await this.client.session.update(e,{namespaces:n.namespaces}),await this.sendResult({id:i,topic:e,result:!0,throwOnFailedPublish:!0})}catch(r){throw gs.delete(t),r}this.client.events.emit("session_update",{id:i,topic:e,params:n})}catch(s){await this.sendError({id:i,topic:e,error:s}),this.client.logger.error(s)}})),Cl(this,"isRequestOutOfSync",((e,t)=>t.toString().slice(0,-3)<e.toString().slice(0,-3))),Cl(this,"onSessionUpdateResponse",((e,t)=>{const{id:n}=t,i=Y("session_update",n);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);(0,ys.isJsonRpcResult)(t)?this.events.emit(Y("session_update",n),{}):(0,ys.isJsonRpcError)(t)&&this.events.emit(Y("session_update",n),{error:t.error})})),Cl(this,"onSessionExtendRequest",(async(e,t)=>{const{id:n}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,Q(hl)),await this.sendResult({id:n,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:n,topic:e})}catch(i){await this.sendError({id:n,topic:e,error:i}),this.client.logger.error(i)}})),Cl(this,"onSessionExtendResponse",((e,t)=>{const{id:n}=t,i=Y("session_extend",n);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);(0,ys.isJsonRpcResult)(t)?this.events.emit(Y("session_extend",n),{}):(0,ys.isJsonRpcError)(t)&&this.events.emit(Y("session_extend",n),{error:t.error})})),Cl(this,"onSessionPingRequest",(async(e,t)=>{const{id:n}=t;try{this.isValidPing({topic:e}),await this.sendResult({id:n,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:e})}catch(i){await this.sendError({id:n,topic:e,error:i}),this.client.logger.error(i)}})),Cl(this,"onSessionPingResponse",((e,t)=>{const{id:n}=t,i=Y("session_ping",n);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);setTimeout((()=>{(0,ys.isJsonRpcResult)(t)?this.events.emit(Y("session_ping",n),{}):(0,ys.isJsonRpcError)(t)&&this.events.emit(Y("session_ping",n),{error:t.error})}),500)})),Cl(this,"onSessionDeleteRequest",(async(e,t)=>{const{id:n}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),Promise.all([new Promise((t=>{this.client.core.relayer.once($s.publish,(async()=>{t(await this.deleteSession({topic:e,id:n}))}))})),this.sendResult({id:n,topic:e,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:Er("USER_DISCONNECTED")})]).catch((e=>this.client.logger.error(e)))}catch(i){this.client.logger.error(i)}})),Cl(this,"onSessionRequest",(async e=>{var t,n,i;const{topic:r,payload:s,attestation:o,encryptedId:a,transportType:c}=e,{id:h,params:l}=s;try{await this.isValidRequest(Al({topic:r},l));const e=this.client.session.get(r),s=await this.getVerifyContext({attestationId:o,hash:Ki(JSON.stringify((0,ys.formatJsonRpcRequest)("wc_sessionRequest",l,h))),encryptedId:a,metadata:e.peer.metadata,transportType:c}),u={id:h,topic:r,params:l,verifyContext:s};await this.setPendingSessionRequest(u),c===Vs.link_mode&&null!=(t=e.peer.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(null==(n=e.peer.metadata.redirect)?void 0:n.universal),null!=(i=this.client.signConfig)&&i.disableRequestQueue?this.emitSessionRequest(u):(this.addSessionRequestToSessionRequestQueue(u),this.processSessionRequestQueue())}catch(Xl){await this.sendError({id:h,topic:r,error:Xl}),this.client.logger.error(Xl)}})),Cl(this,"onSessionRequestResponse",((e,t)=>{const{id:n}=t,i=Y("session_request",n);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);(0,ys.isJsonRpcResult)(t)?this.events.emit(Y("session_request",n),{result:t.result}):(0,ys.isJsonRpcError)(t)&&this.events.emit(Y("session_request",n),{error:t.error})})),Cl(this,"onSessionEventRequest",(async(e,t)=>{const{id:n,params:i}=t;try{const t=`${e}_session_event_${i.event.name}`,r=gs.get(t);if(r&&this.isRequestOutOfSync(r,n))return void this.client.logger.info(`Discarding out of sync request - ${n}`);this.isValidEmit(Al({topic:e},i)),this.client.events.emit("session_event",{id:n,topic:e,params:i}),gs.set(t,n)}catch(r){await this.sendError({id:n,topic:e,error:r}),this.client.logger.error(r)}})),Cl(this,"onSessionAuthenticateResponse",((e,t)=>{const{id:n}=t;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:e,payload:t}),(0,ys.isJsonRpcResult)(t)?this.events.emit(Y("session_request",n),{result:t.result}):(0,ys.isJsonRpcError)(t)&&this.events.emit(Y("session_request",n),{error:t.error})})),Cl(this,"onSessionAuthenticateRequest",(async e=>{var t;const{topic:n,payload:i,attestation:r,encryptedId:s,transportType:o}=e;try{const{requester:e,authPayload:a,expiryTimestamp:c}=i.params,h=await this.getVerifyContext({attestationId:r,hash:Ki(JSON.stringify(i)),encryptedId:s,metadata:e.metadata,transportType:o}),l={requester:e,pairingTopic:n,id:i.id,authPayload:a,verifyContext:h,expiryTimestamp:c};await this.setAuthRequest(i.id,{request:l,pairingTopic:n,transportType:o}),o===Vs.link_mode&&null!=(t=e.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(e.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:n,params:i.params,id:i.id,verifyContext:h})}catch(Zl){this.client.logger.error(Zl);const t=i.params.requester.publicKey,r=await this.client.core.crypto.generateKeyPair(),s=this.getAppLinkIfEnabled(i.params.requester.metadata,o),a={type:Ai,receiverPublicKey:t,senderPublicKey:r};await this.sendError({id:i.id,topic:n,error:Zl,encodeOpts:a,rpcOpts:ul.wc_sessionAuthenticate.autoReject,appLink:s})}})),Cl(this,"addSessionRequestToSessionRequestQueue",(e=>{this.sessionRequestQueue.queue.push(e)})),Cl(this,"cleanupAfterResponse",(e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout((()=>{this.sessionRequestQueue.state=dl.idle,this.processSessionRequestQueue()}),(0,h.toMiliseconds)(this.requestQueueDelay))})),Cl(this,"cleanupPendingSentRequestsForTopic",(({topic:e,error:t})=>{const n=this.client.core.history.pending;n.length>0&&n.filter((t=>t.topic===e&&"wc_sessionRequest"===t.request.method)).forEach((e=>{const n=e.request.id,i=Y("session_request",n);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);this.events.emit(Y("session_request",e.request.id),{error:t})}))})),Cl(this,"processSessionRequestQueue",(()=>{if(this.sessionRequestQueue.state===dl.active)return void this.client.logger.info("session request queue is already active.");const e=this.sessionRequestQueue.queue[0];if(e)try{this.sessionRequestQueue.state=dl.active,this.emitSessionRequest(e)}catch(t){this.client.logger.error(t)}else this.client.logger.info("session request queue is empty.")})),Cl(this,"emitSessionRequest",(e=>{this.client.events.emit("session_request",e)})),Cl(this,"onPairingCreated",(e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;const t=this.client.proposal.getAll().find((t=>t.pairingTopic===e.topic));t&&this.onSessionProposeRequest({topic:e.topic,payload:(0,ys.formatJsonRpcRequest)("wc_sessionPropose",{requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties},t.id)})})),Cl(this,"isValidConnect",(async e=>{if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(e)}`);throw new Error(t)}const{pairingTopic:t,requiredNamespaces:n,optionalNamespaces:i,sessionProperties:r,relays:s}=e;if(xr(t)||await this.isValidPairingTopic(t),!Fr(s,!0)){const{message:e}=_r("MISSING_OR_INVALID",`connect() relays: ${s}`);throw new Error(e)}!xr(n)&&0!==Sr(n)&&this.validateNamespaces(n,"requiredNamespaces"),!xr(i)&&0!==Sr(i)&&this.validateNamespaces(i,"optionalNamespaces"),xr(r)||this.validateSessionProps(r,"sessionProperties")})),Cl(this,"validateNamespaces",((e,t)=>{const n=zr(e,"connect()",t);if(n)throw new Error(n.message)})),Cl(this,"isValidApprove",(async e=>{if(!Gr(e))throw new Error(_r("MISSING_OR_INVALID",`approve() params: ${e}`).message);const{id:t,namespaces:n,relayProtocol:i,sessionProperties:r}=e;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);const s=this.client.proposal.get(t),o=Br(n,"approve()");if(o)throw new Error(o.message);const a=ts(s.requiredNamespaces,n,"approve()");if(a)throw new Error(a.message);if(!Pr(i,!0)){const{message:e}=_r("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(e)}xr(r)||this.validateSessionProps(r,"sessionProperties")})),Cl(this,"isValidReject",(async e=>{if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`reject() params: ${e}`);throw new Error(t)}const{id:t,reason:n}=e;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!Jr(n)){const{message:e}=_r("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(e)}})),Cl(this,"isValidSessionSettleRequest",(e=>{if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${e}`);throw new Error(t)}const{relay:t,controller:n,namespaces:i,expiry:r}=e;if(!Vr(t)){const{message:e}=_r("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(e)}const s=qr(n,"onSessionSettleRequest()");if(s)throw new Error(s.message);const o=Br(i,"onSessionSettleRequest()");if(o)throw new Error(o.message);if(W(r)){const{message:e}=_r("EXPIRED","onSessionSettleRequest()");throw new Error(e)}})),Cl(this,"isValidUpdate",(async e=>{if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`update() params: ${e}`);throw new Error(t)}const{topic:t,namespaces:n}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);const i=this.client.session.get(t),r=Br(n,"update()");if(r)throw new Error(r.message);const s=ts(i.requiredNamespaces,n,"update()");if(s)throw new Error(s.message)})),Cl(this,"isValidExtend",(async e=>{if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`extend() params: ${e}`);throw new Error(t)}const{topic:t}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)})),Cl(this,"isValidRequest",(async e=>{if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`request() params: ${e}`);throw new Error(t)}const{topic:t,request:n,chainId:i,expiry:r}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);const{namespaces:s}=this.client.session.get(t);if(!Zr(s,i)){const{message:e}=_r("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(e)}if(!Qr(n)){const{message:e}=_r("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(e)}if(!Xr(s,i,n.method)){const{message:e}=_r("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(e)}if(r&&!ss(r,pl)){const{message:e}=_r("MISSING_OR_INVALID",`request() expiry: ${r}. Expiry must be a number (in seconds) between ${pl.min} and ${pl.max}`);throw new Error(e)}})),Cl(this,"isValidRespond",(async e=>{var t;if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`respond() params: ${e}`);throw new Error(t)}const{topic:n,response:i}=e;try{await this.isValidSessionTopic(n)}catch(r){throw null!=(t=e?.response)&&t.id&&this.cleanupAfterResponse(e),r}if(!Wr(i)){const{message:e}=_r("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(e)}})),Cl(this,"isValidPing",(async e=>{if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`ping() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)})),Cl(this,"isValidEmit",(async e=>{if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`emit() params: ${e}`);throw new Error(t)}const{topic:t,event:n,chainId:i}=e;await this.isValidSessionTopic(t);const{namespaces:r}=this.client.session.get(t);if(!Zr(r,i)){const{message:e}=_r("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(e)}if(!Yr(n)){const{message:e}=_r("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(e)}if(!es(r,i,n.name)){const{message:e}=_r("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(e)}})),Cl(this,"isValidDisconnect",(async e=>{if(!Gr(e)){const{message:t}=_r("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)})),Cl(this,"isValidAuthenticate",(e=>{const{chains:t,uri:n,domain:i,nonce:r}=e;if(!Array.isArray(t)||0===t.length)throw new Error("chains is required and must be a non-empty array");if(!Pr(n,!1))throw new Error("uri is required parameter");if(!Pr(i,!1))throw new Error("domain is required parameter");if(!Pr(r,!1))throw new Error("nonce is required parameter");if([...new Set(t.map((e=>E(e).namespace)))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:s}=E(t[0]);if("eip155"!==s)throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")})),Cl(this,"getVerifyContext",(async e=>{const{attestationId:t,hash:n,encryptedId:i,metadata:r,transportType:s}=e,o={verified:{verifyUrl:r.verifyUrl||uo,validation:"UNKNOWN",origin:r.url||""}};try{if(s===Vs.link_mode){const e=this.getAppLinkIfEnabled(r,s);return o.verified.validation=e&&new URL(e).origin===new URL(r.url).origin?"VALID":"INVALID",o}const e=await this.client.core.verify.resolve({attestationId:t,hash:n,encryptedId:i,verifyUrl:r.verifyUrl});e&&(o.verified.origin=e.origin,o.verified.isScam=e.isScam,o.verified.validation=e.origin===new URL(r.url).origin?"VALID":"INVALID")}catch(Zl){this.client.logger.warn(Zl)}return this.client.logger.debug(`Verify context: ${JSON.stringify(o)}`),o})),Cl(this,"validateSessionProps",((e,t)=>{Object.values(e).forEach((e=>{if(!Pr(e,!1)){const{message:n}=_r("MISSING_OR_INVALID",`${t} must be in Record<string, string> format. Received: ${JSON.stringify(e)}`);throw new Error(n)}}))})),Cl(this,"getPendingAuthRequest",(e=>{const t=this.client.auth.requests.get(e);return"object"==typeof t?t:void 0})),Cl(this,"addToRecentlyDeleted",((e,t)=>{if(this.recentlyDeletedMap.set(e,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let e=0;const t=this.recentlyDeletedLimit/2;for(const n of this.recentlyDeletedMap.keys()){if(e++>=t)break;this.recentlyDeletedMap.delete(n)}}})),Cl(this,"checkRecentlyDeleted",(e=>{const t=this.recentlyDeletedMap.get(e);if(t){const{message:n}=_r("MISSING_OR_INVALID",`Record was recently deleted - ${t}: ${e}`);throw new Error(n)}})),Cl(this,"isLinkModeEnabled",((e,t)=>{var i,r,s,o,a,c,h,l,u;return!(!e||t!==Vs.link_mode)&&(!0===(null==(r=null==(i=this.client.metadata)?void 0:i.redirect)?void 0:r.linkMode)&&void 0!==(null==(o=null==(s=this.client.metadata)?void 0:s.redirect)?void 0:o.universal)&&""!==(null==(c=null==(a=this.client.metadata)?void 0:a.redirect)?void 0:c.universal)&&void 0!==(null==(h=e?.redirect)?void 0:h.universal)&&""!==(null==(l=e?.redirect)?void 0:l.universal)&&!0===(null==(u=e?.redirect)?void 0:u.linkMode)&&this.client.core.linkModeSupportedApps.includes(e.redirect.universal)&&typeof(null==n.g?void 0:n.g.Linking)<"u")})),Cl(this,"getAppLinkIfEnabled",((e,t)=>{var n;return this.isLinkModeEnabled(e,t)?null==(n=e?.redirect)?void 0:n.universal:void 0})),Cl(this,"handleLinkModeMessage",(({url:e})=>{if(!e||!e.includes("wc_ev")||!e.includes("topic"))return;const t=ie(e,"topic")||"",n=decodeURIComponent(ie(e,"wc_ev")||""),i=this.client.session.keys.includes(t);i&&this.client.session.update(t,{transportType:Vs.link_mode}),this.client.core.dispatchEnvelope({topic:t,message:n,sessionExists:i})})),Cl(this,"registerLinkModeListeners",(async()=>{var e;if(se()||O()&&null!=(e=this.client.metadata.redirect)&&e.linkMode){const e=null==n.g?void 0:n.g.Linking;if(typeof e<"u"){e.addEventListener("url",this.handleLinkModeMessage,this.client.name);const t=await e.getInitialURL();t&&setTimeout((()=>{this.handleLinkModeMessage({url:t})}),50)}}})),Cl(this,"shouldSetTVF",((e,t)=>{if(!t||"wc_sessionRequest"!==e)return!1;const{request:n}=t;return Object.keys(gl).includes(n.method)})),Cl(this,"getTVFParams",((e,t,n)=>{var i,r;try{const s=t.request.method,o=this.extractTxHashesFromResult(s,n);return Nl(Al({correlationId:e,rpcMethods:[s],chainId:t.chainId},this.isValidContractData(t.request.params)&&{contractAddresses:[null==(r=null==(i=t.request.params)?void 0:i[0])?void 0:r.to]}),{txHashes:o})}catch(iu){this.client.logger.warn("Error getting TVF params",iu)}return{}})),Cl(this,"isValidContractData",(e=>{var t;if(!e)return!1;try{const n=e?.data||(null==(t=e?.[0])?void 0:t.data);if(!n.startsWith("0x"))return!1;const i=n.slice(2);return!!/^[0-9a-fA-F]*$/.test(i)&&i.length%2===0}catch{}return!1})),Cl(this,"extractTxHashesFromResult",((e,t)=>{try{const n=gl[e];if("string"==typeof t)return[t];const i=t[n.key];if(Ir(i))return i;if("string"==typeof i)return[i]}catch(n){this.client.logger.warn("Error extracting tx hashes from result",n)}return[]}))}isInitialized(){if(!this.initialized){const{message:e}=_r("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on($s.message,(e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):this.onRelayMessage(e)}))}async onRelayMessage(e){const{topic:t,message:n,attestation:i,transportType:r}=e,{publicKey:s}=this.client.auth.authKeys.keys.includes(Il)?this.client.auth.authKeys.get(Il):{responseTopic:void 0,publicKey:void 0},o=await this.client.core.crypto.decode(t,n,{receiverPublicKey:s,encoding:r===Vs.link_mode?Oi:Ri});try{(0,ys.isJsonRpcRequest)(o)?(this.client.core.history.set(t,o),this.onRelayEventRequest({topic:t,payload:o,attestation:i,transportType:r,encryptedId:Ki(n)})):(0,ys.isJsonRpcResponse)(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:t,payload:o,transportType:r}),this.client.core.history.delete(t,o.id)):this.onRelayEventUnknownPayload({topic:t,payload:o,transportType:r})}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(oo.expired,(async e=>{const{topic:t,id:n}=J(e.target);return n&&this.client.pendingRequest.keys.includes(n)?await this.deletePendingSessionRequest(n,_r("EXPIRED"),!0):n&&this.client.auth.requests.keys.includes(n)?await this.deletePendingAuthRequest(n,_r("EXPIRED"),!0):void(t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n})))}))}registerPairingEvents(){this.client.core.pairing.events.on(to.create,(e=>this.onPairingCreated(e))),this.client.core.pairing.events.on(to.delete,(e=>{this.addToRecentlyDeleted(e.topic,"pairing")}))}isValidPairingTopic(e){if(!Pr(e,!1)){const{message:t}=_r("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=_r("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(W(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=_r("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Pr(e,!1)){const{message:t}=_r("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=_r("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(W(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=_r("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=_r("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else{if(!this.client.core.pairing.pairings.keys.includes(e)){if(Pr(e,!1)){const{message:t}=_r("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}{const{message:t}=_r("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}this.isValidPairingTopic(e)}}async isValidProposalId(e){if(!Hr(e)){const{message:t}=_r("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=_r("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(W(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=_r("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class Dl extends yh{constructor(e,t){super(e,t,ol,il),this.core=e,this.logger=t}}class Ll extends yh{constructor(e,t){super(e,t,cl,il),this.core=e,this.logger=t}}class Ul extends yh{constructor(e,t){super(e,t,fl,il,(e=>e.id)),this.core=e,this.logger=t}}class jl extends yh{constructor(e,t){super(e,t,bl,El,(()=>Il)),this.core=e,this.logger=t}}class $l extends yh{constructor(e,t){super(e,t,vl,El),this.core=e,this.logger=t}}class Ml extends yh{constructor(e,t){super(e,t,_l,El,(e=>e.id)),this.core=e,this.logger=t}}var Kl=Object.defineProperty,zl=(e,t,n)=>t in e?Kl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Bl=(e,t,n)=>zl(e,"symbol"!=typeof t?t+"":t,n);class Vl{constructor(e,t){this.core=e,this.logger=t,Bl(this,"authKeys"),Bl(this,"pairingTopics"),Bl(this,"requests"),this.authKeys=new jl(this.core,this.logger),this.pairingTopics=new $l(this.core,this.logger),this.requests=new Ml(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var Fl=Object.defineProperty,Hl=(e,t,n)=>t in e?Fl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Gl=(e,t,n)=>Hl(e,"symbol"!=typeof t?t+"":t,n);class Jl extends c.S9{constructor(e){super(e),Gl(this,"protocol",el),Gl(this,"version",tl),Gl(this,"name",rl.name),Gl(this,"metadata"),Gl(this,"core"),Gl(this,"logger"),Gl(this,"events",new i.EventEmitter),Gl(this,"engine"),Gl(this,"session"),Gl(this,"proposal"),Gl(this,"pendingRequest"),Gl(this,"auth"),Gl(this,"signConfig"),Gl(this,"on",((e,t)=>this.events.on(e,t))),Gl(this,"once",((e,t)=>this.events.once(e,t))),Gl(this,"off",((e,t)=>this.events.off(e,t))),Gl(this,"removeListener",((e,t)=>this.events.removeListener(e,t))),Gl(this,"removeAllListeners",(e=>this.events.removeAllListeners(e))),Gl(this,"connect",(async e=>{try{return await this.engine.connect(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"pair",(async e=>{try{return await this.engine.pair(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"approve",(async e=>{try{return await this.engine.approve(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"reject",(async e=>{try{return await this.engine.reject(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"update",(async e=>{try{return await this.engine.update(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"extend",(async e=>{try{return await this.engine.extend(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"request",(async e=>{try{return await this.engine.request(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"respond",(async e=>{try{return await this.engine.respond(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"ping",(async e=>{try{return await this.engine.ping(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"emit",(async e=>{try{return await this.engine.emit(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"disconnect",(async e=>{try{return await this.engine.disconnect(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"find",(e=>{try{return this.engine.find(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"getPendingSessionRequests",(()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}})),Gl(this,"authenticate",(async(e,t)=>{try{return await this.engine.authenticate(e,t)}catch(n){throw this.logger.error(n.message),n}})),Gl(this,"formatAuthMessage",(e=>{try{return this.engine.formatAuthMessage(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"approveSessionAuthenticate",(async e=>{try{return await this.engine.approveSessionAuthenticate(e)}catch(t){throw this.logger.error(t.message),t}})),Gl(this,"rejectSessionAuthenticate",(async e=>{try{return await this.engine.rejectSessionAuthenticate(e)}catch(t){throw this.logger.error(t.message),t}})),this.name=e?.name||rl.name,this.metadata=e?.metadata||D(),this.signConfig=e?.signConfig;const t=typeof e?.logger<"u"&&"string"!=typeof e?.logger?e.logger:(0,a.h6)((0,a.iP)({level:e?.logger||rl.logger}));this.core=e?.core||new Xh(e),this.logger=(0,a.U5)(t,this.name),this.session=new Ll(this.core,this.logger),this.proposal=new Dl(this.core,this.logger),this.pendingRequest=new Ul(this.core,this.logger),this.engine=new ql(this),this.auth=new Vl(this.core,this.logger)}static async init(e){const t=new Jl(e);return await t.initialize(),t}get context(){return(0,a.oI)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout((()=>{this.engine.processRelayMessageCache()}),(0,h.toMiliseconds)(h.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const Ql=Ll,Wl=Jl;var Yl,Zl={exports:{}},Xl="object"==typeof Reflect?Reflect:null,eu=Xl&&"function"==typeof Xl.apply?Xl.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};function tu(e){console&&console.warn&&console.warn(e)}Yl=Xl&&"function"==typeof Xl.ownKeys?Xl.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var nu=Number.isNaN||function(e){return e!==e};function iu(){iu.init.call(this)}Zl.exports=iu,Zl.exports.once=fu,iu.EventEmitter=iu,iu.prototype._events=void 0,iu.prototype._eventsCount=0,iu.prototype._maxListeners=void 0;var ru=10;function su(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function ou(e){return void 0===e._maxListeners?iu.defaultMaxListeners:e._maxListeners}function au(e,t,n,i){var r,s,o;if(su(n),s=e._events,void 0===s?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),r=ou(e),r>0&&o.length>r&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,tu(a)}return e}function cu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function hu(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=cu.bind(i);return r.listener=n,i.wrapFn=r,r}function lu(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?gu(r):pu(r,r.length)}function uu(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function pu(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function du(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function gu(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function fu(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,s),i(n)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}mu(e,t,s,{once:!0}),"error"!==t&&yu(e,r,{once:!0})}))}function yu(e,t,n){"function"==typeof e.on&&mu(e,"error",t,n)}function mu(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(s){i.once&&e.removeEventListener(t,r),n(s)}))}}Object.defineProperty(iu,"defaultMaxListeners",{enumerable:!0,get:function(){return ru},set:function(e){if("number"!=typeof e||e<0||nu(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");ru=e}}),iu.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},iu.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||nu(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},iu.prototype.getMaxListeners=function(){return ou(this)},iu.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=r[e];if(void 0===a)return!1;if("function"==typeof a)eu(a,this,t);else{var c=a.length,h=pu(a,c);for(n=0;n<c;++n)eu(h[n],this,t)}return!0},iu.prototype.addListener=function(e,t){return au(this,e,t,!1)},iu.prototype.on=iu.prototype.addListener,iu.prototype.prependListener=function(e,t){return au(this,e,t,!0)},iu.prototype.once=function(e,t){return su(t),this.on(e,hu(this,e,t)),this},iu.prototype.prependOnceListener=function(e,t){return su(t),this.prependListener(e,hu(this,e,t)),this},iu.prototype.removeListener=function(e,t){var n,i,r,s,o;if(su(t),i=this._events,void 0===i)return this;if(n=i[e],void 0===n)return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,r=s;break}if(r<0)return this;0===r?n.shift():du(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},iu.prototype.off=iu.prototype.removeListener,iu.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,void 0===n)return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,s=Object.keys(n);for(i=0;i<s.length;++i)r=s[i],"removeListener"!==r&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],"function"==typeof t)this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},iu.prototype.listeners=function(e){return lu(this,e,!0)},iu.prototype.rawListeners=function(e){return lu(this,e,!1)},iu.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):uu.call(e,t)},iu.prototype.listenerCount=uu,iu.prototype.eventNames=function(){return this._eventsCount>0?Yl(this._events):[]};const wu="wc",bu=2,vu="WalletKit",_u=`${wu}@2:${vu}:`,Eu={database:":memory:"},Iu="request";class Su extends Zl.exports{constructor(){super()}}class xu{constructor(e){this.opts=e}}class Pu{constructor(e){this.client=e}}var Ru=Object.defineProperty,Ou=Object.defineProperties,Tu=Object.getOwnPropertyDescriptors,ku=Object.getOwnPropertySymbols,Au=Object.prototype.hasOwnProperty,Nu=Object.prototype.propertyIsEnumerable,Cu=(e,t,n)=>t in e?Ru(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,qu=(e,t)=>{for(var n in t||(t={}))Au.call(t,n)&&Cu(e,n,t[n]);if(ku)for(var n of ku(t))Nu.call(t,n)&&Cu(e,n,t[n]);return e},Du=(e,t)=>Ou(e,Tu(t));class Lu extends Pu{constructor(e){super(e),this.init=async()=>{this.signClient=await Wl.init({core:this.client.core,metadata:this.client.metadata,signConfig:this.client.signConfig}),this.signClient.core.eventClient.init().catch((e=>{this.client.logger.warn(e)}))},this.pair=async e=>{await this.client.core.pairing.pair(e)},this.approveSession=async e=>{const{topic:t,acknowledged:n}=await this.signClient.approve(Du(qu({},e),{id:e.id,namespaces:e.namespaces,sessionProperties:e.sessionProperties,sessionConfig:e.sessionConfig}));return await n(),this.signClient.session.get(t)},this.rejectSession=async e=>await this.signClient.reject(e),this.updateSession=async e=>await this.signClient.update(e),this.extendSession=async e=>await this.signClient.extend(e),this.respondSessionRequest=async e=>await this.signClient.respond(e),this.disconnectSession=async e=>await this.signClient.disconnect(e),this.emitSessionEvent=async e=>await this.signClient.emit(e),this.getActiveSessions=()=>this.signClient.session.getAll().reduce(((e,t)=>(e[t.topic]=t,e)),{}),this.getPendingSessionProposals=()=>this.signClient.proposal.getAll(),this.getPendingSessionRequests=()=>this.signClient.getPendingSessionRequests(),this.approveSessionAuthenticate=async e=>await this.signClient.approveSessionAuthenticate(e),this.rejectSessionAuthenticate=async e=>await this.signClient.rejectSessionAuthenticate(e),this.formatAuthMessage=e=>this.signClient.formatAuthMessage(e),this.registerDeviceToken=e=>this.client.core.echoClient.registerDeviceToken(e),this.on=(e,t)=>(this.setEvent(e,"off"),this.setEvent(e,"on"),this.client.events.on(e,t)),this.once=(e,t)=>(this.setEvent(e,"off"),this.setEvent(e,"once"),this.client.events.once(e,t)),this.off=(e,t)=>(this.setEvent(e,"off"),this.client.events.off(e,t)),this.removeListener=(e,t)=>(this.setEvent(e,"removeListener"),this.client.events.removeListener(e,t)),this.onSessionRequest=e=>{this.client.events.emit("session_request",e)},this.onSessionProposal=e=>{this.client.events.emit("session_proposal",e)},this.onSessionDelete=e=>{this.client.events.emit("session_delete",e)},this.onProposalExpire=e=>{this.client.events.emit("proposal_expire",e)},this.onSessionRequestExpire=e=>{this.client.events.emit("session_request_expire",e)},this.onSessionRequestAuthenticate=e=>{this.client.events.emit("session_authenticate",e)},this.setEvent=(e,t)=>{switch(e){case"session_request":this.signClient.events[t]("session_request",this.onSessionRequest);break;case"session_proposal":this.signClient.events[t]("session_proposal",this.onSessionProposal);break;case"session_delete":this.signClient.events[t]("session_delete",this.onSessionDelete);break;case"proposal_expire":this.signClient.events[t]("proposal_expire",this.onProposalExpire);break;case"session_request_expire":this.signClient.events[t]("session_request_expire",this.onSessionRequestExpire);break;case"session_authenticate":this.signClient.events[t]("session_authenticate",this.onSessionRequestAuthenticate);break}},this.signClient={}}}const Uu={decryptMessage:async e=>{const t={core:new Xh({storageOptions:e.storageOptions,storage:e.storage})};await t.core.crypto.init();const n=t.core.crypto.decode(e.topic,e.encryptedMessage);return t.core=null,n},getMetadata:async e=>{const t={core:new Xh({storageOptions:e.storageOptions,storage:e.storage}),sessionStore:null};t.sessionStore=new Ql(t.core,t.core.logger),await t.sessionStore.init();const n=t.sessionStore.get(e.topic),i=n?.peer.metadata;return t.core=null,t.sessionStore=null,i}},ju=class extends xu{constructor(e){super(e),this.events=new Zl.exports,this.on=(e,t)=>this.engine.on(e,t),this.once=(e,t)=>this.engine.once(e,t),this.off=(e,t)=>this.engine.off(e,t),this.removeListener=(e,t)=>this.engine.removeListener(e,t),this.pair=async e=>{try{return await this.engine.pair(e)}catch(t){throw this.logger.error(t.message),t}},this.approveSession=async e=>{try{return await this.engine.approveSession(e)}catch(t){throw this.logger.error(t.message),t}},this.rejectSession=async e=>{try{return await this.engine.rejectSession(e)}catch(t){throw this.logger.error(t.message),t}},this.updateSession=async e=>{try{return await this.engine.updateSession(e)}catch(t){throw this.logger.error(t.message),t}},this.extendSession=async e=>{try{return await this.engine.extendSession(e)}catch(t){throw this.logger.error(t.message),t}},this.respondSessionRequest=async e=>{try{return await this.engine.respondSessionRequest(e)}catch(t){throw this.logger.error(t.message),t}},this.disconnectSession=async e=>{try{return await this.engine.disconnectSession(e)}catch(t){throw this.logger.error(t.message),t}},this.emitSessionEvent=async e=>{try{return await this.engine.emitSessionEvent(e)}catch(t){throw this.logger.error(t.message),t}},this.getActiveSessions=()=>{try{return this.engine.getActiveSessions()}catch(e){throw this.logger.error(e.message),e}},this.getPendingSessionProposals=()=>{try{return this.engine.getPendingSessionProposals()}catch(e){throw this.logger.error(e.message),e}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}},this.registerDeviceToken=e=>{try{return this.engine.registerDeviceToken(e)}catch(t){throw this.logger.error(t.message),t}},this.approveSessionAuthenticate=e=>{try{return this.engine.approveSessionAuthenticate(e)}catch(t){throw this.logger.error(t.message),t}},this.rejectSessionAuthenticate=e=>{try{return this.engine.rejectSessionAuthenticate(e)}catch(t){throw this.logger.error(t.message),t}},this.formatAuthMessage=e=>{try{return this.engine.formatAuthMessage(e)}catch(t){throw this.logger.error(t.message),t}},this.metadata=e.metadata,this.name=e.name||vu,this.signConfig=e.signConfig,this.core=e.core,this.logger=this.core.logger,this.engine=new Lu(this)}static async init(e){const t=new ju(e);return await t.initialize(),t}async initialize(){this.logger.trace("Initialized");try{await this.engine.init(),this.logger.info("WalletKit Initialization Success")}catch(e){throw this.logger.info("WalletKit Initialization Failure"),this.logger.error(e.message),e}}};let $u=ju;$u.notifications=Uu;const Mu=$u},63203:(e,t)=>{"use strict";
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function n(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function i(e,t){return!!Array.isArray(t)&&(0===t.length||(e?t.every((e=>"string"===typeof e)):t.every((e=>Number.isSafeInteger(e)))))}function r(e){if("function"!==typeof e)throw new Error("function expected");return!0}function s(e,t){if("string"!==typeof t)throw new Error(`${e}: string expected`);return!0}function o(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function a(e){if(!Array.isArray(e))throw new Error("array expected")}function c(e,t){if(!i(!0,t))throw new Error(`${e}: array of strings expected`)}function h(e,t){if(!i(!1,t))throw new Error(`${e}: array of numbers expected`)}function l(...e){const t=e=>e,n=(e,t)=>n=>e(t(n)),i=e.map((e=>e.encode)).reduceRight(n,t),r=e.map((e=>e.decode)).reduce(n,t);return{encode:i,decode:r}}function u(e){const t="string"===typeof e?e.split(""):e,n=t.length;c("alphabet",t);const i=new Map(t.map(((e,t)=>[e,t])));return{encode:i=>(a(i),i.map((i=>{if(!Number.isSafeInteger(i)||i<0||i>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${i}". Allowed: ${e}`);return t[i]}))),decode:t=>(a(t),t.map((t=>{s("alphabet.decode",t);const n=i.get(t);if(void 0===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n})))}}function p(e=""){return s("join",e),{encode:t=>(c("join.decode",t),t.join(e)),decode:t=>(s("join.decode",t),t.split(e))}}function d(e,t="="){return o(e),s("padding",t),{encode(n){c("padding.encode",n);while(n.length*e%8)n.push(t);return n},decode(n){c("padding.decode",n);let i=n.length;if(i*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&n[i-1]===t;i--){const t=i-1,n=t*e;if(n%8===0)throw new Error("padding: invalid, string has too much padding")}return n.slice(0,i)}}}function g(e){return r(e),{encode:e=>e,decode:t=>e(t)}}function f(e,t,n){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(a(e),!e.length)return[];let i=0;const r=[],s=Array.from(e,(e=>{if(o(e),e<0||e>=t)throw new Error(`invalid integer: ${e}`);return e})),c=s.length;while(1){let e=0,o=!0;for(let r=i;r<c;r++){const a=s[r],c=t*e,h=c+a;if(!Number.isSafeInteger(h)||c/t!==e||h-a!==c)throw new Error("convertRadix: carry overflow");const l=h/n;e=h%n;const u=Math.floor(l);if(s[r]=u,!Number.isSafeInteger(u)||u*n+e!==h)throw new Error("convertRadix: carry overflow");o&&(u?o=!1:i=r)}if(r.push(e),o)break}for(let o=0;o<e.length-1&&0===e[o];o++)r.push(0);return r.reverse()}Object.defineProperty(t,"__esModule",{value:!0}),t.bytes=t.stringToBytes=t.str=t.bytesToString=t.hex=t.utf8=t.bech32m=t.bech32=t.base58check=t.createBase58check=t.base58xmr=t.base58xrp=t.base58flickr=t.base58=t.base64urlnopad=t.base64url=t.base64nopad=t.base64=t.base32crockford=t.base32hexnopad=t.base32hex=t.base32nopad=t.base32=t.base16=t.utils=t.assertNumber=void 0,t.assertNumber=o;const y=(e,t)=>0===t?e:y(t,e%t),m=(e,t)=>e+(t-y(e,t)),w=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function b(e,t,n,i){if(a(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(m(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${m(t,n)}`);let r=0,s=0;const c=w[t],h=w[n]-1,l=[];for(const a of e){if(o(a),a>=c)throw new Error(`convertRadix2: invalid data word=${a} from=${t}`);if(r=r<<t|a,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)l.push((r>>s-n&h)>>>0);const e=w[s];if(void 0===e)throw new Error("invalid carry");r&=e-1}if(r=r<<n-s&h,!i&&s>=t)throw new Error("Excess padding");if(!i&&r>0)throw new Error(`Non-zero padding: ${r}`);return i&&s>0&&l.push(r>>>0),l}function v(e){o(e);const t=256;return{encode:i=>{if(!n(i))throw new Error("radix.encode input should be Uint8Array");return f(Array.from(i),t,e)},decode:n=>(h("radix.decode",n),Uint8Array.from(f(n,e,t)))}}function _(e,t=!1){if(o(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(m(8,e)>32||m(e,8)>32)throw new Error("radix2: carry overflow");return{encode:i=>{if(!n(i))throw new Error("radix2.encode input should be Uint8Array");return b(Array.from(i),8,e,!t)},decode:n=>(h("radix2.decode",n),Uint8Array.from(b(n,e,8,t)))}}function E(e){return r(e),function(...t){try{return e.apply(null,t)}catch(n){}}}function I(e,t){return o(e),r(t),{encode(i){if(!n(i))throw new Error("checksum.encode: input should be Uint8Array");const r=t(i).slice(0,e),s=new Uint8Array(i.length+e);return s.set(i),s.set(r,i.length),s},decode(i){if(!n(i))throw new Error("checksum.decode: input should be Uint8Array");const r=i.slice(0,-e),s=i.slice(-e),o=t(r).slice(0,e);for(let t=0;t<e;t++)if(o[t]!==s[t])throw new Error("Invalid checksum");return r}}}t.utils={alphabet:u,chain:l,checksum:I,convertRadix:f,convertRadix2:b,radix:v,radix2:_,join:p,padding:d},t.base16=l(_(4),u("0123456789ABCDEF"),p("")),t.base32=l(_(5),u("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),d(5),p("")),t.base32nopad=l(_(5),u("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),p("")),t.base32hex=l(_(5),u("0123456789ABCDEFGHIJKLMNOPQRSTUV"),d(5),p("")),t.base32hexnopad=l(_(5),u("0123456789ABCDEFGHIJKLMNOPQRSTUV"),p("")),t.base32crockford=l(_(5),u("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),p(""),g((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),t.base64=l(_(6),u("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),d(6),p("")),t.base64nopad=l(_(6),u("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),p("")),t.base64url=l(_(6),u("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),d(6),p("")),t.base64urlnopad=l(_(6),u("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),p(""));const S=e=>l(v(58),u(e),p(""));t.base58=S("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),t.base58flickr=S("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),t.base58xrp=S("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const x=[0,2,3,5,6,7,9,10,11];t.base58xmr={encode(e){let n="";for(let i=0;i<e.length;i+=8){const r=e.subarray(i,i+8);n+=t.base58.encode(r).padStart(x[r.length],"1")}return n},decode(e){let n=[];for(let i=0;i<e.length;i+=11){const r=e.slice(i,i+11),s=x.indexOf(r.length),o=t.base58.decode(r);for(let e=0;e<o.length-s;e++)if(0!==o[e])throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(o.slice(o.length-s)))}return Uint8Array.from(n)}};const P=e=>l(I(4,(t=>e(e(t)))),t.base58);t.createBase58check=P,t.base58check=t.createBase58check;const R=l(u("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),p("")),O=[996825010,642813549,513874426,1027748829,705979059];function T(e){const t=e>>25;let n=(33554431&e)<<5;for(let i=0;i<O.length;i++)1===(t>>i&1)&&(n^=O[i]);return n}function k(e,t,n=1){const i=e.length;let r=1;for(let s=0;s<i;s++){const t=e.charCodeAt(s);if(t<33||t>126)throw new Error(`Invalid prefix (${e})`);r=T(r)^t>>5}r=T(r);for(let s=0;s<i;s++)r=T(r)^31&e.charCodeAt(s);for(let s of t)r=T(r)^s;for(let s=0;s<6;s++)r=T(r);return r^=n,R.encode(b([r%w[30]],30,5,!1))}function A(e){const t="bech32"===e?1:734539939,i=_(5),r=i.decode,o=i.encode,a=E(r);function c(e,i,r=90){s("bech32.encode prefix",e),n(i)&&(i=Array.from(i)),h("bech32.encode",i);const o=e.length;if(0===o)throw new TypeError(`Invalid prefix length ${o}`);const a=o+7+i.length;if(!1!==r&&a>r)throw new TypeError(`Length ${a} exceeds limit ${r}`);const c=e.toLowerCase(),l=k(c,i,t);return`${c}1${R.encode(i)}${l}`}function l(e,n=90){s("bech32.decode input",e);const i=e.length;if(i<8||!1!==n&&i>n)throw new TypeError(`invalid string length: ${i} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const o=r.lastIndexOf("1");if(0===o||-1===o)throw new Error('Letter "1" must be present between prefix and data only');const a=r.slice(0,o),c=r.slice(o+1);if(c.length<6)throw new Error("Data must be at least 6 characters long");const h=R.decode(c).slice(0,-6),l=k(a,h,t);if(!c.endsWith(l))throw new Error(`Invalid checksum in ${e}: expected "${l}"`);return{prefix:a,words:h}}const u=E(l);function p(e){const{prefix:t,words:n}=l(e,!1);return{prefix:t,words:n,bytes:r(n)}}function d(e,t){return c(e,o(t))}return{encode:c,decode:l,encodeFromBytes:d,decodeToBytes:p,decodeUnsafe:u,fromWords:r,fromWordsUnsafe:a,toWords:o}}t.bech32=A("bech32"),t.bech32m=A("bech32m"),t.utf8={encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)},t.hex=l(_(4),u("0123456789abcdef"),p(""),g((e=>{if("string"!==typeof e||e.length%2!==0)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})));const N={utf8:t.utf8,hex:t.hex,base16:t.base16,base32:t.base32,base64:t.base64,base64url:t.base64url,base58:t.base58,base58xmr:t.base58xmr},C="Invalid encoding type. Available types: utf8, hex, base16, base32, base64, base64url, base58, base58xmr",q=(e,t)=>{if("string"!==typeof e||!N.hasOwnProperty(e))throw new TypeError(C);if(!n(t))throw new TypeError("bytesToString() expects Uint8Array");return N[e].encode(t)};t.bytesToString=q,t.str=t.bytesToString;const D=(e,t)=>{if(!N.hasOwnProperty(e))throw new TypeError(C);if("string"!==typeof t)throw new TypeError("stringToBytes() expects string");return N[e].decode(t)};t.stringToBytes=D,t.bytes=t.stringToBytes},74765:e=>{"use strict";var t=String.prototype.replace,n=/%20/g,i={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports={default:i.RFC3986,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:i.RFC1738,RFC3986:i.RFC3986}},55373:(e,t,n)=>{"use strict";var i=n(98636),r=n(62642),s=n(74765);e.exports={formats:s,parse:r,stringify:i}},62642:(e,t,n)=>{"use strict";var i=n(37720),r=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:i.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"===typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},h="utf8=%26%2310003%3B",l="utf8=%E2%9C%93",u=function(e,t){var n={__proto__:null},u=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;u=u.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var p,d=t.parameterLimit===1/0?void 0:t.parameterLimit,g=u.split(t.delimiter,d),f=-1,y=t.charset;if(t.charsetSentinel)for(p=0;p<g.length;++p)0===g[p].indexOf("utf8=")&&(g[p]===l?y="utf-8":g[p]===h&&(y="iso-8859-1"),f=p,p=g.length);for(p=0;p<g.length;++p)if(p!==f){var m,w,b=g[p],v=b.indexOf("]="),_=-1===v?b.indexOf("="):v+1;-1===_?(m=t.decoder(b,o.decoder,y,"key"),w=t.strictNullHandling?null:""):(m=t.decoder(b.slice(0,_),o.decoder,y,"key"),w=i.maybeMap(c(b.slice(_+1),t),(function(e){return t.decoder(e,o.decoder,y,"value")}))),w&&t.interpretNumericEntities&&"iso-8859-1"===y&&(w=a(String(w))),b.indexOf("[]=")>-1&&(w=s(w)?[w]:w);var E=r.call(n,m);E&&"combine"===t.duplicates?n[m]=i.combine(n[m],w):E&&"last"!==t.duplicates||(n[m]=w)}return n},p=function(e,t,n,i){for(var r=i?t:c(t,n),s=e.length-1;s>=0;--s){var o,a=e[s];if("[]"===a&&n.parseArrays)o=n.allowEmptyArrays&&(""===r||n.strictNullHandling&&null===r)?[]:[].concat(r);else{o=n.plainObjects?{__proto__:null}:{};var h="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,l=n.decodeDotInKeys?h.replace(/%2E/g,"."):h,u=parseInt(l,10);n.parseArrays||""!==l?!isNaN(u)&&a!==l&&String(u)===l&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(o=[],o[u]=r):"__proto__"!==l&&(o[l]=r):o={0:r}}r=o}return r},d=function(e,t,n,i){if(e){var s=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,c=n.depth>0&&o.exec(s),h=c?s.slice(0,c.index):s,l=[];if(h){if(!n.plainObjects&&r.call(Object.prototype,h)&&!n.allowPrototypes)return;l.push(h)}var u=0;while(n.depth>0&&null!==(c=a.exec(s))&&u<n.depth){if(u+=1,!n.plainObjects&&r.call(Object.prototype,c[1].slice(1,-1))&&!n.allowPrototypes)return;l.push(c[1])}if(c){if(!0===n.strictDepth)throw new RangeError("Input depth exceeded depth option of "+n.depth+" and strictDepth is true");l.push("["+s.slice(c.index)+"]")}return p(l,t,n,i)}},g=function(e){if(!e)return o;if("undefined"!==typeof e.allowEmptyArrays&&"boolean"!==typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if("undefined"!==typeof e.decodeDotInKeys&&"boolean"!==typeof e.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&"undefined"!==typeof e.decoder&&"function"!==typeof e.decoder)throw new TypeError("Decoder has to be a function.");if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t="undefined"===typeof e.charset?o.charset:e.charset,n="undefined"===typeof e.duplicates?o.duplicates:e.duplicates;if("combine"!==n&&"first"!==n&&"last"!==n)throw new TypeError("The duplicates option must be either combine, first, or last");var r="undefined"===typeof e.allowDots?!0===e.decodeDotInKeys||o.allowDots:!!e.allowDots;return{allowDots:r,allowEmptyArrays:"boolean"===typeof e.allowEmptyArrays?!!e.allowEmptyArrays:o.allowEmptyArrays,allowPrototypes:"boolean"===typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"===typeof e.allowSparse?e.allowSparse:o.allowSparse,arrayLimit:"number"===typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"===typeof e.comma?e.comma:o.comma,decodeDotInKeys:"boolean"===typeof e.decodeDotInKeys?e.decodeDotInKeys:o.decodeDotInKeys,decoder:"function"===typeof e.decoder?e.decoder:o.decoder,delimiter:"string"===typeof e.delimiter||i.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"===typeof e.depth||!1===e.depth?+e.depth:o.depth,duplicates:n,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"===typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"===typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"===typeof e.plainObjects?e.plainObjects:o.plainObjects,strictDepth:"boolean"===typeof e.strictDepth?!!e.strictDepth:o.strictDepth,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}};e.exports=function(e,t){var n=g(t);if(""===e||null===e||"undefined"===typeof e)return n.plainObjects?{__proto__:null}:{};for(var r="string"===typeof e?u(e,n):e,s=n.plainObjects?{__proto__:null}:{},o=Object.keys(r),a=0;a<o.length;++a){var c=o[a],h=d(c,r[c],n,"string"===typeof e);s=i.merge(s,h,n)}return!0===n.allowSparse?s:i.compact(s)}},98636:(e,t,n)=>{"use strict";var i=n(920),r=n(37720),s=n(74765),o=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},c=Array.isArray,h=Array.prototype.push,l=function(e,t){h.apply(e,c(t)?t:[t])},u=Date.prototype.toISOString,p=s["default"],d={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:r.encode,encodeValuesOnly:!1,filter:void 0,format:p,formatter:s.formatters[p],indices:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},g=function(e){return"string"===typeof e||"number"===typeof e||"boolean"===typeof e||"symbol"===typeof e||"bigint"===typeof e},f={},y=function e(t,n,s,o,a,h,u,p,y,m,w,b,v,_,E,I,S,x){var P=t,R=x,O=0,T=!1;while(void 0!==(R=R.get(f))&&!T){var k=R.get(t);if(O+=1,"undefined"!==typeof k){if(k===O)throw new RangeError("Cyclic object value");T=!0}"undefined"===typeof R.get(f)&&(O=0)}if("function"===typeof m?P=m(n,P):P instanceof Date?P=v(P):"comma"===s&&c(P)&&(P=r.maybeMap(P,(function(e){return e instanceof Date?v(e):e}))),null===P){if(h)return y&&!I?y(n,d.encoder,S,"key",_):n;P=""}if(g(P)||r.isBuffer(P)){if(y){var A=I?n:y(n,d.encoder,S,"key",_);return[E(A)+"="+E(y(P,d.encoder,S,"value",_))]}return[E(n)+"="+E(String(P))]}var N,C=[];if("undefined"===typeof P)return C;if("comma"===s&&c(P))I&&y&&(P=r.maybeMap(P,y)),N=[{value:P.length>0?P.join(",")||null:void 0}];else if(c(m))N=m;else{var q=Object.keys(P);N=w?q.sort(w):q}var D=p?String(n).replace(/\./g,"%2E"):String(n),L=o&&c(P)&&1===P.length?D+"[]":D;if(a&&c(P)&&0===P.length)return L+"[]";for(var U=0;U<N.length;++U){var j=N[U],$="object"===typeof j&&j&&"undefined"!==typeof j.value?j.value:P[j];if(!u||null!==$){var M=b&&p?String(j).replace(/\./g,"%2E"):String(j),K=c(P)?"function"===typeof s?s(L,M):L:L+(b?"."+M:"["+M+"]");x.set(t,O);var z=i();z.set(f,x),l(C,e($,K,s,o,a,h,u,p,"comma"===s&&I&&c(P)?null:y,m,w,b,v,_,E,I,S,z))}}return C},m=function(e){if(!e)return d;if("undefined"!==typeof e.allowEmptyArrays&&"boolean"!==typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if("undefined"!==typeof e.encodeDotInKeys&&"boolean"!==typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&"undefined"!==typeof e.encoder&&"function"!==typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||d.charset;if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=s["default"];if("undefined"!==typeof e.format){if(!o.call(s.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var i,r=s.formatters[n],h=d.filter;if(("function"===typeof e.filter||c(e.filter))&&(h=e.filter),i=e.arrayFormat in a?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":d.arrayFormat,"commaRoundTrip"in e&&"boolean"!==typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var l="undefined"===typeof e.allowDots?!0===e.encodeDotInKeys||d.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"===typeof e.addQueryPrefix?e.addQueryPrefix:d.addQueryPrefix,allowDots:l,allowEmptyArrays:"boolean"===typeof e.allowEmptyArrays?!!e.allowEmptyArrays:d.allowEmptyArrays,arrayFormat:i,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:d.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:"undefined"===typeof e.delimiter?d.delimiter:e.delimiter,encode:"boolean"===typeof e.encode?e.encode:d.encode,encodeDotInKeys:"boolean"===typeof e.encodeDotInKeys?e.encodeDotInKeys:d.encodeDotInKeys,encoder:"function"===typeof e.encoder?e.encoder:d.encoder,encodeValuesOnly:"boolean"===typeof e.encodeValuesOnly?e.encodeValuesOnly:d.encodeValuesOnly,filter:h,format:n,formatter:r,serializeDate:"function"===typeof e.serializeDate?e.serializeDate:d.serializeDate,skipNulls:"boolean"===typeof e.skipNulls?e.skipNulls:d.skipNulls,sort:"function"===typeof e.sort?e.sort:null,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:d.strictNullHandling}};e.exports=function(e,t){var n,r,s=e,o=m(t);"function"===typeof o.filter?(r=o.filter,s=r("",s)):c(o.filter)&&(r=o.filter,n=r);var h=[];if("object"!==typeof s||null===s)return"";var u=a[o.arrayFormat],p="comma"===u&&o.commaRoundTrip;n||(n=Object.keys(s)),o.sort&&n.sort(o.sort);for(var d=i(),g=0;g<n.length;++g){var f=n[g],w=s[f];o.skipNulls&&null===w||l(h,y(w,f,u,p,o.allowEmptyArrays,o.strictNullHandling,o.skipNulls,o.encodeDotInKeys,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.format,o.formatter,o.encodeValuesOnly,o.charset,d))}var b=h.join(o.delimiter),v=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&("iso-8859-1"===o.charset?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),b.length>0?v+b:""}},37720:(e,t,n)=>{"use strict";var i=n(74765),r=Object.prototype.hasOwnProperty,s=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e){while(e.length>1){var t=e.pop(),n=t.obj[t.prop];if(s(n)){for(var i=[],r=0;r<n.length;++r)"undefined"!==typeof n[r]&&i.push(n[r]);t.obj[t.prop]=i}}},c=function(e,t){for(var n=t&&t.plainObjects?{__proto__:null}:{},i=0;i<e.length;++i)"undefined"!==typeof e[i]&&(n[i]=e[i]);return n},h=function e(t,n,i){if(!n)return t;if("object"!==typeof n&&"function"!==typeof n){if(s(t))t.push(n);else{if(!t||"object"!==typeof t)return[t,n];(i&&(i.plainObjects||i.allowPrototypes)||!r.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!==typeof t)return[t].concat(n);var o=t;return s(t)&&!s(n)&&(o=c(t,i)),s(t)&&s(n)?(n.forEach((function(n,s){if(r.call(t,s)){var o=t[s];o&&"object"===typeof o&&n&&"object"===typeof n?t[s]=e(o,n,i):t.push(n)}else t[s]=n})),t):Object.keys(n).reduce((function(t,s){var o=n[s];return r.call(t,s)?t[s]=e(t[s],o,i):t[s]=o,t}),o)},l=function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},u=function(e,t,n){var i=e.replace(/\+/g," ");if("iso-8859-1"===n)return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch(r){return i}},p=1024,d=function(e,t,n,r,s){if(0===e.length)return e;var a=e;if("symbol"===typeof e?a=Symbol.prototype.toString.call(e):"string"!==typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",h=0;h<a.length;h+=p){for(var l=a.length>=p?a.slice(h,h+p):a,u=[],d=0;d<l.length;++d){var g=l.charCodeAt(d);45===g||46===g||95===g||126===g||g>=48&&g<=57||g>=65&&g<=90||g>=97&&g<=122||s===i.RFC1738&&(40===g||41===g)?u[u.length]=l.charAt(d):g<128?u[u.length]=o[g]:g<2048?u[u.length]=o[192|g>>6]+o[128|63&g]:g<55296||g>=57344?u[u.length]=o[224|g>>12]+o[128|g>>6&63]+o[128|63&g]:(d+=1,g=65536+((1023&g)<<10|1023&l.charCodeAt(d)),u[u.length]=o[240|g>>18]+o[128|g>>12&63]+o[128|g>>6&63]+o[128|63&g])}c+=u.join("")}return c},g=function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],i=0;i<t.length;++i)for(var r=t[i],s=r.obj[r.prop],o=Object.keys(s),c=0;c<o.length;++c){var h=o[c],l=s[h];"object"===typeof l&&null!==l&&-1===n.indexOf(l)&&(t.push({obj:s,prop:h}),n.push(l))}return a(t),e},f=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},y=function(e){return!(!e||"object"!==typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},m=function(e,t){return[].concat(e,t)},w=function(e,t){if(s(e)){for(var n=[],i=0;i<e.length;i+=1)n.push(t(e[i]));return n}return t(e)};e.exports={arrayToObject:c,assign:l,combine:m,compact:g,decode:u,encode:d,isBuffer:y,isRegExp:f,maybeMap:w,merge:h}},40793:e=>{"use strict";function t(e){try{return JSON.stringify(e)}catch(t){return'"[Circular]"'}}function n(e,n,i){var r=i&&i.stringify||t,s=1;if("object"===typeof e&&null!==e){var o=n.length+s;if(1===o)return e;var a=new Array(o);a[0]=r(e);for(var c=1;c<o;c++)a[c]=r(n[c]);return a.join(" ")}if("string"!==typeof e)return e;var h=n.length;if(0===h)return e;for(var l="",u=1-s,p=-1,d=e&&e.length||0,g=0;g<d;){if(37===e.charCodeAt(g)&&g+1<d){switch(p=p>-1?p:0,e.charCodeAt(g+1)){case 100:case 102:if(u>=h)break;if(null==n[u])break;p<g&&(l+=e.slice(p,g)),l+=Number(n[u]),p=g+2,g++;break;case 105:if(u>=h)break;if(null==n[u])break;p<g&&(l+=e.slice(p,g)),l+=Math.floor(Number(n[u])),p=g+2,g++;break;case 79:case 111:case 106:if(u>=h)break;if(void 0===n[u])break;p<g&&(l+=e.slice(p,g));var f=typeof n[u];if("string"===f){l+="'"+n[u]+"'",p=g+2,g++;break}if("function"===f){l+=n[u].name||"<anonymous>",p=g+2,g++;break}l+=r(n[u]),p=g+2,g++;break;case 115:if(u>=h)break;p<g&&(l+=e.slice(p,g)),l+=String(n[u]),p=g+2,g++;break;case 37:p<g&&(l+=e.slice(p,g)),l+="%",p=g+2,g++,u--;break}++u}++g}return-1===p?e:(p<d&&(l+=e.slice(p)),l)}e.exports=n},53209:(e,t,n)=>{"use strict";var i=n(65606),r=65536,s=4294967295;function o(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}var a=n(92861).Buffer,c=n.g.crypto||n.g.msCrypto;function h(e,t){if(e>s)throw new RangeError("requested too many random bytes");var n=a.allocUnsafe(e);if(e>0)if(e>r)for(var o=0;o<e;o+=r)c.getRandomValues(n.slice(o,o+r));else c.getRandomValues(n);return"function"===typeof t?i.nextTick((function(){t(null,n)})):n}c&&c.getRandomValues?e.exports=h:e.exports=o},76983:(e,t,n)=>{"use strict";var i=n(65606);function r(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var s=n(92861),o=n(53209),a=s.Buffer,c=s.kMaxLength,h=n.g.crypto||n.g.msCrypto,l=Math.pow(2,32)-1;function u(e,t){if("number"!==typeof e||e!==e)throw new TypeError("offset must be a number");if(e>l||e<0)throw new TypeError("offset must be a uint32");if(e>c||e>t)throw new RangeError("offset out of range")}function p(e,t,n){if("number"!==typeof e||e!==e)throw new TypeError("size must be a number");if(e>l||e<0)throw new TypeError("size must be a uint32");if(e+t>n||e>c)throw new RangeError("buffer too small")}function d(e,t,i,r){if(!a.isBuffer(e)&&!(e instanceof n.g.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"===typeof t)r=t,t=0,i=e.length;else if("function"===typeof i)r=i,i=e.length-t;else if("function"!==typeof r)throw new TypeError('"cb" argument must be a function');return u(t,e.length),p(i,t,e.length),g(e,t,i,r)}function g(e,t,n,r){if(i.browser){var s=e.buffer,a=new Uint8Array(s,t,n);return h.getRandomValues(a),r?void i.nextTick((function(){r(null,e)})):e}if(!r){var c=o(n);return c.copy(e,t),e}o(n,(function(n,i){if(n)return r(n);i.copy(e,t),r(null,e)}))}function f(e,t,i){if("undefined"===typeof t&&(t=0),!a.isBuffer(e)&&!(e instanceof n.g.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return u(t,e.length),void 0===i&&(i=e.length-t),p(i,t,e.length),g(e,t,i)}h&&h.getRandomValues||!i.browser?(t.randomFill=d,t.randomFillSync=f):(t.randomFill=r,t.randomFillSync=r)},66011:(e,t,n)=>{"use strict";var i=n(48287).Buffer,r=n(56698),s=n(4729),o=new Array(16),a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],c=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],h=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],l=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],u=[0,1518500249,1859775393,2400959708,2840853838],p=[1352829926,1548603684,1836072691,2053994217,0];function d(){s.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function g(e,t){return e<<t|e>>>32-t}function f(e,t,n,i,r,s,o,a){return g(e+(t^n^i)+s+o|0,a)+r|0}function y(e,t,n,i,r,s,o,a){return g(e+(t&n|~t&i)+s+o|0,a)+r|0}function m(e,t,n,i,r,s,o,a){return g(e+((t|~n)^i)+s+o|0,a)+r|0}function w(e,t,n,i,r,s,o,a){return g(e+(t&i|n&~i)+s+o|0,a)+r|0}function b(e,t,n,i,r,s,o,a){return g(e+(t^(n|~i))+s+o|0,a)+r|0}r(d,s),d.prototype._update=function(){for(var e=o,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);for(var n=0|this._a,i=0|this._b,r=0|this._c,s=0|this._d,d=0|this._e,v=0|this._a,_=0|this._b,E=0|this._c,I=0|this._d,S=0|this._e,x=0;x<80;x+=1){var P,R;x<16?(P=f(n,i,r,s,d,e[a[x]],u[0],h[x]),R=b(v,_,E,I,S,e[c[x]],p[0],l[x])):x<32?(P=y(n,i,r,s,d,e[a[x]],u[1],h[x]),R=w(v,_,E,I,S,e[c[x]],p[1],l[x])):x<48?(P=m(n,i,r,s,d,e[a[x]],u[2],h[x]),R=m(v,_,E,I,S,e[c[x]],p[2],l[x])):x<64?(P=w(n,i,r,s,d,e[a[x]],u[3],h[x]),R=y(v,_,E,I,S,e[c[x]],p[3],l[x])):(P=b(n,i,r,s,d,e[a[x]],u[4],h[x]),R=f(v,_,E,I,S,e[c[x]],p[4],l[x])),n=d,d=s,s=g(r,10),r=i,i=P,v=S,S=I,I=g(E,10),E=_,_=R}var O=this._b+r+I|0;this._b=this._c+s+S|0,this._c=this._d+d+v|0,this._d=this._e+n+_|0,this._e=this._a+i+E|0,this._a=O},d.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=i.alloc?i.alloc(20):new i(20);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e.writeInt32LE(this._e,16),e},e.exports=d},50858:(e,t)=>{"use strict";function n(e){if(Array.isArray(e)){const t=[];for(let r=0;r<e.length;r++)t.push(n(e[r]));const i=p(...t);return p(s(i.length,192),i)}const t=w(e);return 1===t.length&&t[0]<128?t:p(s(t.length,128),t)}function i(e,t,n){if(n>e.length)throw new Error("invalid RLP (safeSlice): end slice of Uint8Array out-of-bounds");return e.slice(t,n)}function r(e){if(0===e[0])throw new Error("invalid RLP: extra zeros");return l(h(e))}function s(e,t){if(e<56)return Uint8Array.from([e+t]);const n=g(e),i=n.length/2,r=g(t+55+i);return Uint8Array.from(u(r+n))}function o(e,t=!1){if(!e||0===e.length)return Uint8Array.from([]);const n=w(e),i=a(n);if(t)return i;if(0!==i.remainder.length)throw new Error("invalid RLP: remainder must be zero");return i.data}function a(e){let t,n,s,o,c;const h=[],l=e[0];if(l<=127)return{data:e.slice(0,1),remainder:e.slice(1)};if(l<=183){if(t=l-127,s=128===l?Uint8Array.from([]):i(e,1,t),2===t&&s[0]<128)throw new Error("invalid RLP encoding: invalid prefix, single byte < 0x80 are not prefixed");return{data:s,remainder:e.slice(t)}}if(l<=191){if(n=l-182,e.length-1<n)throw new Error("invalid RLP: not enough bytes for string length");if(t=r(i(e,1,n)),t<=55)throw new Error("invalid RLP: expected string length to be greater than 55");return s=i(e,n,t+n),{data:s,remainder:e.slice(t+n)}}if(l<=247){t=l-191,o=i(e,1,t);while(o.length)c=a(o),h.push(c.data),o=c.remainder;return{data:h,remainder:e.slice(t)}}{if(n=l-246,t=r(i(e,1,n)),t<56)throw new Error("invalid RLP: encoded list too short");const s=n+t;if(s>e.length)throw new Error("invalid RLP: total length is larger than the data");o=i(e,n,s);while(o.length)c=a(o),h.push(c.data),o=c.remainder;return{data:h,remainder:e.slice(s)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.utils=t.decode=t.encode=void 0,t.encode=n,t.decode=o;const c=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function h(e){let t="";for(let n=0;n<e.length;n++)t+=c[e[n]];return t}function l(e){const t=Number.parseInt(e,16);if(Number.isNaN(t))throw new Error("Invalid byte sequence");return t}function u(e){if("string"!==typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let n=0;n<t.length;n++){const i=2*n;t[n]=l(e.slice(i,i+2))}return t}function p(...e){if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t);for(let i=0,r=0;i<e.length;i++){const t=e[i];n.set(t,r),r+=t.length}return n}function d(e){return(new TextEncoder).encode(e)}function g(e){if(e<0)throw new Error("Invalid integer as argument, must be unsigned!");const t=e.toString(16);return t.length%2?`0${t}`:t}function f(e){return e.length%2?`0${e}`:e}function y(e){return e.length>=2&&"0"===e[0]&&"x"===e[1]}function m(e){return"string"!==typeof e?e:y(e)?e.slice(2):e}function w(e){if(e instanceof Uint8Array)return e;if("string"===typeof e)return y(e)?u(f(m(e))):d(e);if("number"===typeof e||"bigint"===typeof e)return e?u(g(e)):Uint8Array.from([]);if(null===e||void 0===e)return Uint8Array.from([]);throw new Error("toBytes: received unsupported type "+typeof e)}t.utils={bytesToHex:h,concatBytes:p,hexToBytes:u,utf8ToBytes:d};const b={encode:n,decode:o};t["default"]=b},64399:(e,t,n)=>{"use strict";var i=n(70453),r=i("%Array.prototype.concat%"),s=n(10487),o=n(36556),a=o("Array.prototype.slice"),c=n(41333)(),h=c&&Symbol.isConcatSpreadable,l=[],u=h?s.apply(r,l):null,p=h?n(64634):null;e.exports=h?function(e){for(var t=0;t<arguments.length;t+=1){var n=arguments[t];if(n&&"object"===typeof n&&"boolean"===typeof n[h]){l[h]||(l[h]=!0);var i=p(n)?a(n):[n];i[h]=!0,arguments[t]=i}}return u(arguments)}:s(r,l)},92861:(e,t,n)=>{
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var i=n(48287),r=i.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(s(i,t),t.Buffer=o),o.prototype=Object.create(r.prototype),s(r,o),o.from=function(e,t,n){if("number"===typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},o.alloc=function(e,t,n){if("number"!==typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"===typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},o.allocUnsafe=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return r(e)},o.allocUnsafeSlow=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},99721:(e,t,n)=>{"use strict";var i=n(36556),r=n(14035),s=i("RegExp.prototype.exec"),o=n(69675);e.exports=function(e){if(!r(e))throw new o("`regex` must be a RegExp");return function(t){return null!==s(e,t)}}},14673:(e,t,n)=>{var i=n(43360),r=1e8;function s(e){return Number(e)}Number.isInteger||(Number.isInteger=function(e){return"number"===typeof e&&e%1===0}),e.exports={toBitcoin:function(e){var t=typeof e;if("string"===t&&(e=s(e),t="number"),"number"!==t)throw new TypeError("toBitcoin must be called on a number or string, got "+t);if(!Number.isInteger(e))throw new TypeError("toBitcoin must be called on a whole number or string format whole number");var n=new i(e);return Number(n.div(r))},toSatoshi:function(e){var t=typeof e;if("string"===t&&(e=s(e),t="number"),"number"!==t)throw new TypeError("toSatoshi must be called on a number or string, got "+t);var n=new i(e);return Number(n.times(r))}}},43360:function(e,t,n){var i;(function(){"use strict";var r,s=20,o=1,a=1e6,c=1e6,h=-7,l=21,u={},p=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function d(){function e(t){var n=this;if(!(n instanceof e))return void 0===t?d():new e(t);t instanceof e?(n.s=t.s,n.e=t.e,n.c=t.c.slice()):f(n,t),n.constructor=e}return e.prototype=u,e.DP=s,e.RM=o,e.E_NEG=h,e.E_POS=l,e}function g(e,t,n){var i=e.constructor,r=t-(e=new i(e)).e,s=e.c;for(s.length>++t&&y(e,r,i.RM),s[0]?n?r=t:(s=e.c,r=e.e+r+1):++r;s.length<r;s.push(0));return r=e.e,1===n||n&&(t<=r||r<=i.E_NEG)?(e.s<0&&s[0]?"-":"")+(s.length>1?s[0]+"."+s.join("").slice(1):s[0])+(r<0?"e":"e+")+r:e.toString()}function f(e,t){var n,i,r;for(0===t&&1/t<0?t="-0":p.test(t+="")||m(NaN),e.s="-"==t.charAt(0)?(t=t.slice(1),-1):1,(n=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(n<0&&(n=i),n+=+t.slice(i+1),t=t.substring(0,i)):n<0&&(n=t.length),r=t.length,i=0;i<r&&"0"==t.charAt(i);i++);if(i==r)e.c=[e.e=0];else{for(;r>0&&"0"==t.charAt(--r););for(e.e=n-i-1,e.c=[];i<=r;e.c.push(+t.charAt(i++)));}return e}function y(e,t,n,i){var r,s=e.c,o=e.e+t+1;if(1===n?i=s[o]>=5:2===n?i=s[o]>5||5==s[o]&&(i||o<0||s[o+1]!==r||1&s[o-1]):3===n?i=i||s[o]!==r||o<0:(i=!1,0!==n&&m("!Big.RM!")),o<1||!s[0])i?(e.e=-t,e.c=[1]):e.c=[e.e=0];else{if(s.length=o--,i)for(;++s[o]>9;)s[o]=0,o--||(++e.e,s.unshift(1));for(o=s.length;!s[--o];s.pop());}return e}function m(e){var t=new Error(e);throw t.name="BigError",t}u.abs=function(){var e=new this.constructor(this);return e.s=1,e},u.cmp=function(e){var t,n=this,i=n.c,r=(e=new n.constructor(e)).c,s=n.s,o=e.s,a=n.e,c=e.e;if(!i[0]||!r[0])return i[0]?s:r[0]?-o:0;if(s!=o)return s;if(t=s<0,a!=c)return a>c^t?1:-1;for(s=-1,o=(a=i.length)<(c=r.length)?a:c;++s<o;)if(i[s]!=r[s])return i[s]>r[s]^t?1:-1;return a==c?0:a>c^t?1:-1},u.div=function(e){var t=this,n=t.constructor,i=t.c,r=(e=new n(e)).c,s=t.s==e.s?1:-1,o=n.DP;if((o!==~~o||o<0||o>a)&&m("!Big.DP!"),!i[0]||!r[0])return i[0]==r[0]&&m(NaN),r[0]||m(s/0),new n(0*s);var c,h,l,u,p,d,g=r.slice(),f=c=r.length,w=i.length,b=i.slice(0,c),v=b.length,_=e,E=_.c=[],I=0,S=o+(_.e=t.e-e.e)+1;for(_.s=s,s=S<0?0:S,g.unshift(0);v++<c;b.push(0));do{for(l=0;l<10;l++){if(c!=(v=b.length))u=c>v?1:-1;else for(p=-1,u=0;++p<c;)if(r[p]!=b[p]){u=r[p]>b[p]?1:-1;break}if(!(u<0))break;for(h=v==c?r:g;v;){if(b[--v]<h[v]){for(p=v;p&&!b[--p];b[p]=9);--b[p],b[v]+=10}b[v]-=h[v]}for(;!b[0];b.shift());}E[I++]=u?l:++l,b[0]&&u?b[v]=i[f]||0:b=[i[f]]}while((f++<w||b[0]!==d)&&s--);return E[0]||1==I||(E.shift(),_.e--),I>S&&y(_,o,n.RM,b[0]!==d),_},u.eq=function(e){return!this.cmp(e)},u.gt=function(e){return this.cmp(e)>0},u.gte=function(e){return this.cmp(e)>-1},u.lt=function(e){return this.cmp(e)<0},u.lte=function(e){return this.cmp(e)<1},u.sub=u.minus=function(e){var t,n,i,r,s=this,o=s.constructor,a=s.s,c=(e=new o(e)).s;if(a!=c)return e.s=-c,s.plus(e);var h=s.c.slice(),l=s.e,u=e.c,p=e.e;if(!h[0]||!u[0])return u[0]?(e.s=-c,e):new o(h[0]?s:0);if(a=l-p){for((r=a<0)?(a=-a,i=h):(p=l,i=u),i.reverse(),c=a;c--;i.push(0));i.reverse()}else for(n=((r=h.length<u.length)?h:u).length,a=c=0;c<n;c++)if(h[c]!=u[c]){r=h[c]<u[c];break}if(r&&(i=h,h=u,u=i,e.s=-e.s),(c=(n=u.length)-(t=h.length))>0)for(;c--;h[t++]=0);for(c=t;n>a;){if(h[--n]<u[n]){for(t=n;t&&!h[--t];h[t]=9);--h[t],h[n]+=10}h[n]-=u[n]}for(;0===h[--c];h.pop());for(;0===h[0];)h.shift(),--p;return h[0]||(e.s=1,h=[p=0]),e.c=h,e.e=p,e},u.mod=function(e){var t,n=this,i=n.constructor,r=n.s,s=(e=new i(e)).s;return e.c[0]||m(NaN),n.s=e.s=1,t=1==e.cmp(n),n.s=r,e.s=s,t?new i(n):(r=i.DP,s=i.RM,i.DP=i.RM=0,n=n.div(e),i.DP=r,i.RM=s,this.minus(n.times(e)))},u.add=u.plus=function(e){var t,n=this,i=n.constructor,r=n.s,s=(e=new i(e)).s;if(r!=s)return e.s=-s,n.minus(e);var o=n.e,a=n.c,c=e.e,h=e.c;if(!a[0]||!h[0])return h[0]?e:new i(a[0]?n:0*r);if(a=a.slice(),r=o-c){for(r>0?(c=o,t=h):(r=-r,t=a),t.reverse();r--;t.push(0));t.reverse()}for(a.length-h.length<0&&(t=h,h=a,a=t),r=h.length,s=0;r;)s=(a[--r]=a[r]+h[r]+s)/10|0,a[r]%=10;for(s&&(a.unshift(s),++c),r=a.length;0===a[--r];a.pop());return e.c=a,e.e=c,e},u.pow=function(e){var t=this,n=new t.constructor(1),i=n,r=e<0;for((e!==~~e||e<-c||e>c)&&m("!pow!"),e=r?-e:e;;){if(1&e&&(i=i.times(t)),e>>=1,!e)break;t=t.times(t)}return r?n.div(i):i},u.round=function(e,t){var n=this,i=n.constructor;return null==e?e=0:(e!==~~e||e<0||e>a)&&m("!round!"),y(n=new i(n),e,null==t?i.RM:t),n},u.sqrt=function(){var e,t,n,i=this,r=i.constructor,s=i.c,o=i.s,a=i.e,c=new r("0.5");if(!s[0])return new r(i);o<0&&m(NaN),o=Math.sqrt(i.toString()),0===o||o===1/0?(e=s.join(""),e.length+a&1||(e+="0"),t=new r(Math.sqrt(e).toString()),t.e=((a+1)/2|0)-(a<0||1&a)):t=new r(o.toString()),o=t.e+(r.DP+=4);do{n=t,t=c.times(n.plus(i.div(n)))}while(n.c.slice(0,o).join("")!==t.c.slice(0,o).join(""));return y(t,r.DP-=4,r.RM),t},u.mul=u.times=function(e){var t,n=this,i=n.constructor,r=n.c,s=(e=new i(e)).c,o=r.length,a=s.length,c=n.e,h=e.e;if(e.s=n.s==e.s?1:-1,!r[0]||!s[0])return new i(0*e.s);for(e.e=c+h,o<a&&(t=r,r=s,s=t,h=o,o=a,a=h),t=new Array(h=o+a);h--;t[h]=0);for(c=a;c--;){for(a=0,h=o+c;h>c;)a=t[h]+s[c]*r[h-c-1]+a,t[h--]=a%10,a=a/10|0;t[h]=(t[h]+a)%10}for(a&&++e.e,t[0]||t.shift(),c=t.length;!t[--c];t.pop());return e.c=t,e},u.toString=u.valueOf=u.toJSON=function(){var e=this,t=e.constructor,n=e.e,i=e.c.join(""),r=i.length;if(n<=t.E_NEG||n>=t.E_POS)i=i.charAt(0)+(r>1?"."+i.slice(1):"")+(n<0?"e":"e+")+n;else if(n<0){for(;++n;i="0"+i);i="0."+i}else if(n>0)if(++n>r)for(n-=r;n--;i+="0");else n<r&&(i=i.slice(0,n)+"."+i.slice(n));else r>1&&(i=i.charAt(0)+"."+i.slice(1));return e.s<0&&e.c[0]?"-"+i:i},u.toExponential=function(e){return null==e?e=this.c.length-1:(e!==~~e||e<0||e>a)&&m("!toExp!"),g(this,e,1)},u.toFixed=function(e){var t,n=this,i=n.constructor,r=i.E_NEG,s=i.E_POS;return i.E_NEG=-(i.E_POS=1/0),null==e?t=n.toString():e===~~e&&e>=0&&e<=a&&(t=g(n,n.e+e),n.s<0&&n.c[0]&&t.indexOf("-")<0&&(t="-"+t)),i.E_NEG=r,i.E_POS=s,t||m("!toFix!"),t},u.toPrecision=function(e){return null==e?this.toString():((e!==~~e||e<1||e>a)&&m("!toPre!"),g(this,e-1,2))},r=d(),i=function(){return r}.call(t,n,t,e),void 0===i||(e.exports=i)})()},96897:(e,t,n)=>{"use strict";var i=n(70453),r=n(30041),s=n(30592)(),o=n(75795),a=n(69675),c=i("%Math.floor%");e.exports=function(e,t){if("function"!==typeof e)throw new a("`fn` is not a function");if("number"!==typeof t||t<0||t>4294967295||c(t)!==t)throw new a("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,h=!0;if("length"in e&&o){var l=o(e,"length");l&&!l.configurable&&(i=!1),l&&!l.writable&&(h=!1)}return(i||h||!n)&&(s?r(e,"length",t,!0,!0):r(e,"length",t)),e}},42791:function(e,t,n){var i=n(65606);(function(e,t){"use strict";if(!e.setImmediate){var n,r=1,s={},o=!1,a=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,"[object process]"==={}.toString.call(e.process)?d():g()?f():e.MessageChannel?y():a&&"onreadystatechange"in a.createElement("script")?m():w(),c.setImmediate=h,c.clearImmediate=l}function h(e){"function"!==typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var o={callback:e,args:t};return s[r]=o,n(r),r++}function l(e){delete s[e]}function u(e){var n=e.callback,i=e.args;switch(i.length){case 0:n();break;case 1:n(i[0]);break;case 2:n(i[0],i[1]);break;case 3:n(i[0],i[1],i[2]);break;default:n.apply(t,i);break}}function p(e){if(o)setTimeout(p,0,e);else{var t=s[e];if(t){o=!0;try{u(t)}finally{l(e),o=!1}}}}function d(){n=function(e){i.nextTick((function(){p(e)}))}}function g(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function f(){var t="setImmediate$"+Math.random()+"$",i=function(n){n.source===e&&"string"===typeof n.data&&0===n.data.indexOf(t)&&p(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),n=function(n){e.postMessage(t+n,"*")}}function y(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;p(t)},n=function(t){e.port2.postMessage(t)}}function m(){var e=a.documentElement;n=function(t){var n=a.createElement("script");n.onreadystatechange=function(){p(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}function w(){n=function(e){setTimeout(p,0,e)}}})("undefined"===typeof self?"undefined"===typeof n.g?this:n.g:self)},90392:(e,t,n)=>{var i=n(92861).Buffer;function r(e,t){this._block=i.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}r.prototype.update=function(e,t){"string"===typeof e&&(t=t||"utf8",e=i.from(e,t));for(var n=this._block,r=this._blockSize,s=e.length,o=this._len,a=0;a<s;){for(var c=o%r,h=Math.min(s-a,r-c),l=0;l<h;l++)n[c+l]=e[a+l];o+=h,a+=h,o%r===0&&this._update(n)}return this._len+=s,this},r.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var i=(4294967295&n)>>>0,r=(n-i)/4294967296;this._block.writeUInt32BE(r,this._blockSize-8),this._block.writeUInt32BE(i,this._blockSize-4)}this._update(this._block);var s=this._hash();return e?s.toString(e):s},r.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=r},62802:(e,t,n)=>{var i=e.exports=function(e){e=e.toLowerCase();var t=i[e];if(!t)throw new Error(e+" is not supported (we accept pull requests)");return new t};i.sha=n(27816),i.sha1=n(63737),i.sha224=n(26710),i.sha256=n(24107),i.sha384=n(32827),i.sha512=n(82890)},27816:(e,t,n)=>{var i=n(56698),r=n(90392),s=n(92861).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function c(){this.init(),this._w=a,r.call(this,64,56)}function h(e){return e<<5|e>>>27}function l(e){return e<<30|e>>>2}function u(e,t,n,i){return 0===e?t&n|~t&i:2===e?t&n|t&i|n&i:t^n^i}i(c,r),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t=this._w,n=0|this._a,i=0|this._b,r=0|this._c,s=0|this._d,a=0|this._e,c=0;c<16;++c)t[c]=e.readInt32BE(4*c);for(;c<80;++c)t[c]=t[c-3]^t[c-8]^t[c-14]^t[c-16];for(var p=0;p<80;++p){var d=~~(p/20),g=h(n)+u(d,i,r,s)+a+t[p]+o[d]|0;a=s,s=r,r=l(i),i=n,n=g}this._a=n+this._a|0,this._b=i+this._b|0,this._c=r+this._c|0,this._d=s+this._d|0,this._e=a+this._e|0},c.prototype._hash=function(){var e=s.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},63737:(e,t,n)=>{var i=n(56698),r=n(90392),s=n(92861).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function c(){this.init(),this._w=a,r.call(this,64,56)}function h(e){return e<<1|e>>>31}function l(e){return e<<5|e>>>27}function u(e){return e<<30|e>>>2}function p(e,t,n,i){return 0===e?t&n|~t&i:2===e?t&n|t&i|n&i:t^n^i}i(c,r),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t=this._w,n=0|this._a,i=0|this._b,r=0|this._c,s=0|this._d,a=0|this._e,c=0;c<16;++c)t[c]=e.readInt32BE(4*c);for(;c<80;++c)t[c]=h(t[c-3]^t[c-8]^t[c-14]^t[c-16]);for(var d=0;d<80;++d){var g=~~(d/20),f=l(n)+p(g,i,r,s)+a+t[d]+o[g]|0;a=s,s=r,r=u(i),i=n,n=f}this._a=n+this._a|0,this._b=i+this._b|0,this._c=r+this._c|0,this._d=s+this._d|0,this._e=a+this._e|0},c.prototype._hash=function(){var e=s.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},26710:(e,t,n)=>{var i=n(56698),r=n(24107),s=n(90392),o=n(92861).Buffer,a=new Array(64);function c(){this.init(),this._w=a,s.call(this,64,56)}i(c,r),c.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},c.prototype._hash=function(){var e=o.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=c},24107:(e,t,n)=>{var i=n(56698),r=n(90392),s=n(92861).Buffer,o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a=new Array(64);function c(){this.init(),this._w=a,r.call(this,64,56)}function h(e,t,n){return n^e&(t^n)}function l(e,t,n){return e&t|n&(e|t)}function u(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function p(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function d(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}function g(e){return(e>>>17|e<<15)^(e>>>19|e<<13)^e>>>10}i(c,r),c.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},c.prototype._update=function(e){for(var t=this._w,n=0|this._a,i=0|this._b,r=0|this._c,s=0|this._d,a=0|this._e,c=0|this._f,f=0|this._g,y=0|this._h,m=0;m<16;++m)t[m]=e.readInt32BE(4*m);for(;m<64;++m)t[m]=g(t[m-2])+t[m-7]+d(t[m-15])+t[m-16]|0;for(var w=0;w<64;++w){var b=y+p(a)+h(a,c,f)+o[w]+t[w]|0,v=u(n)+l(n,i,r)|0;y=f,f=c,c=a,a=s+b|0,s=r,r=i,i=n,n=b+v|0}this._a=n+this._a|0,this._b=i+this._b|0,this._c=r+this._c|0,this._d=s+this._d|0,this._e=a+this._e|0,this._f=c+this._f|0,this._g=f+this._g|0,this._h=y+this._h|0},c.prototype._hash=function(){var e=s.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=c},32827:(e,t,n)=>{var i=n(56698),r=n(82890),s=n(90392),o=n(92861).Buffer,a=new Array(160);function c(){this.init(),this._w=a,s.call(this,128,112)}i(c,r),c.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},c.prototype._hash=function(){var e=o.allocUnsafe(48);function t(t,n,i){e.writeInt32BE(t,i),e.writeInt32BE(n,i+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=c},82890:(e,t,n)=>{var i=n(56698),r=n(90392),s=n(92861).Buffer,o=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],a=new Array(160);function c(){this.init(),this._w=a,r.call(this,128,112)}function h(e,t,n){return n^e&(t^n)}function l(e,t,n){return e&t|n&(e|t)}function u(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function p(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function d(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function g(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function f(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function y(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function m(e,t){return e>>>0<t>>>0?1:0}i(c,r),c.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},c.prototype._update=function(e){for(var t=this._w,n=0|this._ah,i=0|this._bh,r=0|this._ch,s=0|this._dh,a=0|this._eh,c=0|this._fh,w=0|this._gh,b=0|this._hh,v=0|this._al,_=0|this._bl,E=0|this._cl,I=0|this._dl,S=0|this._el,x=0|this._fl,P=0|this._gl,R=0|this._hl,O=0;O<32;O+=2)t[O]=e.readInt32BE(4*O),t[O+1]=e.readInt32BE(4*O+4);for(;O<160;O+=2){var T=t[O-30],k=t[O-30+1],A=d(T,k),N=g(k,T);T=t[O-4],k=t[O-4+1];var C=f(T,k),q=y(k,T),D=t[O-14],L=t[O-14+1],U=t[O-32],j=t[O-32+1],$=N+L|0,M=A+D+m($,N)|0;$=$+q|0,M=M+C+m($,q)|0,$=$+j|0,M=M+U+m($,j)|0,t[O]=M,t[O+1]=$}for(var K=0;K<160;K+=2){M=t[K],$=t[K+1];var z=l(n,i,r),B=l(v,_,E),V=u(n,v),F=u(v,n),H=p(a,S),G=p(S,a),J=o[K],Q=o[K+1],W=h(a,c,w),Y=h(S,x,P),Z=R+G|0,X=b+H+m(Z,R)|0;Z=Z+Y|0,X=X+W+m(Z,Y)|0,Z=Z+Q|0,X=X+J+m(Z,Q)|0,Z=Z+$|0,X=X+M+m(Z,$)|0;var ee=F+B|0,te=V+z+m(ee,F)|0;b=w,R=P,w=c,P=x,c=a,x=S,S=I+Z|0,a=s+X+m(S,I)|0,s=r,I=E,r=i,E=_,i=n,_=v,v=Z+ee|0,n=X+te+m(v,Z)|0}this._al=this._al+v|0,this._bl=this._bl+_|0,this._cl=this._cl+E|0,this._dl=this._dl+I|0,this._el=this._el+S|0,this._fl=this._fl+x|0,this._gl=this._gl+P|0,this._hl=this._hl+R|0,this._ah=this._ah+n+m(this._al,v)|0,this._bh=this._bh+i+m(this._bl,_)|0,this._ch=this._ch+r+m(this._cl,E)|0,this._dh=this._dh+s+m(this._dl,I)|0,this._eh=this._eh+a+m(this._el,S)|0,this._fh=this._fh+c+m(this._fl,x)|0,this._gh=this._gh+w+m(this._gl,P)|0,this._hh=this._hh+b+m(this._hl,R)|0},c.prototype._hash=function(){var e=s.allocUnsafe(64);function t(t,n,i){e.writeInt32BE(t,i),e.writeInt32BE(n,i+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=c},36268:(e,t,n)=>{"use strict";var i=n(70453),r=n(6966),s=n(47730),o=n(19723),a=n(69675),c=i("%Object.getPrototypeOf%",!0),h=i("%Object.prototype%"),l=n(7176);e.exports=function(e){if("Object"!==s(e))throw new a("Reflect.getPrototypeOf called on non-object");if(c)return c(e);if(l){var t=l(e);if(t||null===t)return t}var n=o(e);if(n){var u=i("%"+n+".prototype%",!0);if(u)return u}return r(e.constructor)?e.constructor.prototype:e instanceof Object?h:null}},99897:(e,t,n)=>{"use strict";var i=n(47730),r=n(69675),s=n(36268),o=[].__proto__===Array.prototype,a=n(7176),c=function(e){if("Object"!==i(e))throw new r("Reflect.getPrototypeOf called on non-object");return a?a(e):e.__proto__};e.exports=function(){return"object"===typeof Reflect&&Reflect&&Reflect.getPrototypeOf?Reflect.getPrototypeOf:o?c:s}},69821:(e,t,n)=>{"use strict";n.d(t,{we:()=>K,kw:()=>J,JB:()=>H});var i=n(89190),r=n(86910),s=n(78226),o=n(43008),a=n(68279);
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function c(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function h(e,t){return!!Array.isArray(t)&&(0===t.length||(e?t.every((e=>"string"===typeof e)):t.every((e=>Number.isSafeInteger(e)))))}function l(e){if("function"!==typeof e)throw new Error("function expected");return!0}function u(e,t){if("string"!==typeof t)throw new Error(`${e}: string expected`);return!0}function p(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function d(e){if(!Array.isArray(e))throw new Error("array expected")}function g(e,t){if(!h(!0,t))throw new Error(`${e}: array of strings expected`)}function f(e,t){if(!h(!1,t))throw new Error(`${e}: array of numbers expected`)}function y(...e){const t=e=>e,n=(e,t)=>n=>e(t(n)),i=e.map((e=>e.encode)).reduceRight(n,t),r=e.map((e=>e.decode)).reduce(n,t);return{encode:i,decode:r}}function m(e){const t="string"===typeof e?e.split(""):e,n=t.length;g("alphabet",t);const i=new Map(t.map(((e,t)=>[e,t])));return{encode:i=>(d(i),i.map((i=>{if(!Number.isSafeInteger(i)||i<0||i>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${i}". Allowed: ${e}`);return t[i]}))),decode:t=>(d(t),t.map((t=>{u("alphabet.decode",t);const n=i.get(t);if(void 0===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n})))}}function w(e=""){return u("join",e),{encode:t=>(g("join.decode",t),t.join(e)),decode:t=>(u("join.decode",t),t.split(e))}}function b(e,t="="){return p(e),u("padding",t),{encode(n){g("padding.encode",n);while(n.length*e%8)n.push(t);return n},decode(n){g("padding.decode",n);let i=n.length;if(i*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&n[i-1]===t;i--){const t=i-1,n=t*e;if(n%8===0)throw new Error("padding: invalid, string has too much padding")}return n.slice(0,i)}}}function v(e){return l(e),{encode:e=>e,decode:t=>e(t)}}function _(e,t,n){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(d(e),!e.length)return[];let i=0;const r=[],s=Array.from(e,(e=>{if(p(e),e<0||e>=t)throw new Error(`invalid integer: ${e}`);return e})),o=s.length;while(1){let e=0,a=!0;for(let r=i;r<o;r++){const o=s[r],c=t*e,h=c+o;if(!Number.isSafeInteger(h)||c/t!==e||h-o!==c)throw new Error("convertRadix: carry overflow");const l=h/n;e=h%n;const u=Math.floor(l);if(s[r]=u,!Number.isSafeInteger(u)||u*n+e!==h)throw new Error("convertRadix: carry overflow");a&&(u?a=!1:i=r)}if(r.push(e),a)break}for(let a=0;a<e.length-1&&0===e[a];a++)r.push(0);return r.reverse()}const E=(e,t)=>0===t?e:E(t,e%t),I=(e,t)=>e+(t-E(e,t)),S=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function x(e,t,n,i){if(d(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(I(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${I(t,n)}`);let r=0,s=0;const o=S[t],a=S[n]-1,c=[];for(const h of e){if(p(h),h>=o)throw new Error(`convertRadix2: invalid data word=${h} from=${t}`);if(r=r<<t|h,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)c.push((r>>s-n&a)>>>0);const e=S[s];if(void 0===e)throw new Error("invalid carry");r&=e-1}if(r=r<<n-s&a,!i&&s>=t)throw new Error("Excess padding");if(!i&&r>0)throw new Error(`Non-zero padding: ${r}`);return i&&s>0&&c.push(r>>>0),c}function P(e){p(e);const t=256;return{encode:n=>{if(!c(n))throw new Error("radix.encode input should be Uint8Array");return _(Array.from(n),t,e)},decode:n=>(f("radix.decode",n),Uint8Array.from(_(n,e,t)))}}function R(e,t=!1){if(p(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(I(8,e)>32||I(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!c(n))throw new Error("radix2.encode input should be Uint8Array");return x(Array.from(n),8,e,!t)},decode:n=>(f("radix2.decode",n),Uint8Array.from(x(n,e,8,t)))}}function O(e){return l(e),function(...t){try{return e.apply(null,t)}catch(n){}}}function T(e,t){return p(e),l(t),{encode(n){if(!c(n))throw new Error("checksum.encode: input should be Uint8Array");const i=t(n).slice(0,e),r=new Uint8Array(n.length+e);return r.set(n),r.set(i,n.length),r},decode(n){if(!c(n))throw new Error("checksum.decode: input should be Uint8Array");const i=n.slice(0,-e),r=n.slice(-e),s=t(i).slice(0,e);for(let t=0;t<e;t++)if(s[t]!==r[t])throw new Error("Invalid checksum");return i}}}const k={alphabet:m,chain:y,checksum:T,convertRadix:_,convertRadix2:x,radix:P,radix2:R,join:w,padding:b},A=(y(R(4),m("0123456789ABCDEF"),w("")),y(R(5),m("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),b(5),w("")),y(R(5),m("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),w("")),y(R(5),m("0123456789ABCDEFGHIJKLMNOPQRSTUV"),b(5),w("")),y(R(5),m("0123456789ABCDEFGHIJKLMNOPQRSTUV"),w("")),y(R(5),m("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),w(""),v((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),y(R(6),m("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),b(6),w("")),y(R(6),m("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),w("")),y(R(6),m("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),b(6),w("")),y(R(6),m("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),w("")),e=>y(P(58),m(e),w(""))),N=(A("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),A("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),A("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),y(m("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),w(""))),C=[996825010,642813549,513874426,1027748829,705979059];function q(e){const t=e>>25;let n=(33554431&e)<<5;for(let i=0;i<C.length;i++)1===(t>>i&1)&&(n^=C[i]);return n}function D(e,t,n=1){const i=e.length;let r=1;for(let s=0;s<i;s++){const t=e.charCodeAt(s);if(t<33||t>126)throw new Error(`Invalid prefix (${e})`);r=q(r)^t>>5}r=q(r);for(let s=0;s<i;s++)r=q(r)^31&e.charCodeAt(s);for(let s of t)r=q(r)^s;for(let s=0;s<6;s++)r=q(r);return r^=n,N.encode(x([r%S[30]],30,5,!1))}function L(e){const t="bech32"===e?1:734539939,n=R(5),i=n.decode,r=n.encode,s=O(i);function o(e,n,i=90){u("bech32.encode prefix",e),c(n)&&(n=Array.from(n)),f("bech32.encode",n);const r=e.length;if(0===r)throw new TypeError(`Invalid prefix length ${r}`);const s=r+7+n.length;if(!1!==i&&s>i)throw new TypeError(`Length ${s} exceeds limit ${i}`);const o=e.toLowerCase(),a=D(o,n,t);return`${o}1${N.encode(n)}${a}`}function a(e,n=90){u("bech32.decode input",e);const i=e.length;if(i<8||!1!==n&&i>n)throw new TypeError(`invalid string length: ${i} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const s=r.lastIndexOf("1");if(0===s||-1===s)throw new Error('Letter "1" must be present between prefix and data only');const o=r.slice(0,s),a=r.slice(s+1);if(a.length<6)throw new Error("Data must be at least 6 characters long");const c=N.decode(a).slice(0,-6),h=D(o,c,t);if(!a.endsWith(h))throw new Error(`Invalid checksum in ${e}: expected "${h}"`);return{prefix:o,words:c}}const h=O(a);function l(e){const{prefix:t,words:n}=a(e,!1);return{prefix:t,words:n,bytes:i(n)}}function p(e,t){return o(e,r(t))}return{encode:o,decode:a,encodeFromBytes:p,decodeToBytes:l,decodeUnsafe:h,fromWords:i,fromWordsUnsafe:s,toWords:r}}L("bech32"),L("bech32m"),y(R(4),m("0123456789abcdef"),w(""),v((e=>{if("string"!==typeof e||e.length%2!==0)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})));const U=e=>"あいこくしん"===e[0];function j(e){if("string"!==typeof e)throw new TypeError("invalid mnemonic type: "+typeof e);return e.normalize("NFKD")}function $(e){const t=j(e),n=t.split(" ");if(![12,15,18,21,24].includes(n.length))throw new Error("Invalid mnemonic");return{nfkd:t,words:n}}function M(e){(0,i.DO)(e,16,20,24,28,32)}function K(e,t=128){if((0,i.Fe)(t),t%32!==0||t>256)throw new TypeError("Invalid entropy");return F((0,a.po)(t/8),e)}const z=e=>{const t=8-e.length/4;return new Uint8Array([(0,s.sc)(e)[0]>>t<<t])};function B(e){if(!Array.isArray(e)||2048!==e.length||"string"!==typeof e[0])throw new Error("Wordlist: expected array of 2048 strings");return e.forEach((e=>{if("string"!==typeof e)throw new Error("wordlist: non-string element: "+e)})),k.chain(k.checksum(1,z),k.radix2(11,!0),k.alphabet(e))}function V(e,t){const{words:n}=$(e),i=B(t).decode(n);return M(i),i}function F(e,t){M(e);const n=B(t).encode(e);return n.join(U(t)?"　":" ")}function H(e,t){try{V(e,t)}catch(n){return!1}return!0}const G=e=>j("mnemonic"+e);function J(e,t=""){return(0,r.A)(o.Zf,$(e).nfkd,G(t),{c:2048,dkLen:64})}},89414:(e,t,n)=>{"use strict";n.d(t,{p:()=>i});const i="abandon\nability\nable\nabout\nabove\nabsent\nabsorb\nabstract\nabsurd\nabuse\naccess\naccident\naccount\naccuse\nachieve\nacid\nacoustic\nacquire\nacross\nact\naction\nactor\nactress\nactual\nadapt\nadd\naddict\naddress\nadjust\nadmit\nadult\nadvance\nadvice\naerobic\naffair\nafford\nafraid\nagain\nage\nagent\nagree\nahead\naim\nair\nairport\naisle\nalarm\nalbum\nalcohol\nalert\nalien\nall\nalley\nallow\nalmost\nalone\nalpha\nalready\nalso\nalter\nalways\namateur\namazing\namong\namount\namused\nanalyst\nanchor\nancient\nanger\nangle\nangry\nanimal\nankle\nannounce\nannual\nanother\nanswer\nantenna\nantique\nanxiety\nany\napart\napology\nappear\napple\napprove\napril\narch\narctic\narea\narena\nargue\narm\narmed\narmor\narmy\naround\narrange\narrest\narrive\narrow\nart\nartefact\nartist\nartwork\nask\naspect\nassault\nasset\nassist\nassume\nasthma\nathlete\natom\nattack\nattend\nattitude\nattract\nauction\naudit\naugust\naunt\nauthor\nauto\nautumn\naverage\navocado\navoid\nawake\naware\naway\nawesome\nawful\nawkward\naxis\nbaby\nbachelor\nbacon\nbadge\nbag\nbalance\nbalcony\nball\nbamboo\nbanana\nbanner\nbar\nbarely\nbargain\nbarrel\nbase\nbasic\nbasket\nbattle\nbeach\nbean\nbeauty\nbecause\nbecome\nbeef\nbefore\nbegin\nbehave\nbehind\nbelieve\nbelow\nbelt\nbench\nbenefit\nbest\nbetray\nbetter\nbetween\nbeyond\nbicycle\nbid\nbike\nbind\nbiology\nbird\nbirth\nbitter\nblack\nblade\nblame\nblanket\nblast\nbleak\nbless\nblind\nblood\nblossom\nblouse\nblue\nblur\nblush\nboard\nboat\nbody\nboil\nbomb\nbone\nbonus\nbook\nboost\nborder\nboring\nborrow\nboss\nbottom\nbounce\nbox\nboy\nbracket\nbrain\nbrand\nbrass\nbrave\nbread\nbreeze\nbrick\nbridge\nbrief\nbright\nbring\nbrisk\nbroccoli\nbroken\nbronze\nbroom\nbrother\nbrown\nbrush\nbubble\nbuddy\nbudget\nbuffalo\nbuild\nbulb\nbulk\nbullet\nbundle\nbunker\nburden\nburger\nburst\nbus\nbusiness\nbusy\nbutter\nbuyer\nbuzz\ncabbage\ncabin\ncable\ncactus\ncage\ncake\ncall\ncalm\ncamera\ncamp\ncan\ncanal\ncancel\ncandy\ncannon\ncanoe\ncanvas\ncanyon\ncapable\ncapital\ncaptain\ncar\ncarbon\ncard\ncargo\ncarpet\ncarry\ncart\ncase\ncash\ncasino\ncastle\ncasual\ncat\ncatalog\ncatch\ncategory\ncattle\ncaught\ncause\ncaution\ncave\nceiling\ncelery\ncement\ncensus\ncentury\ncereal\ncertain\nchair\nchalk\nchampion\nchange\nchaos\nchapter\ncharge\nchase\nchat\ncheap\ncheck\ncheese\nchef\ncherry\nchest\nchicken\nchief\nchild\nchimney\nchoice\nchoose\nchronic\nchuckle\nchunk\nchurn\ncigar\ncinnamon\ncircle\ncitizen\ncity\ncivil\nclaim\nclap\nclarify\nclaw\nclay\nclean\nclerk\nclever\nclick\nclient\ncliff\nclimb\nclinic\nclip\nclock\nclog\nclose\ncloth\ncloud\nclown\nclub\nclump\ncluster\nclutch\ncoach\ncoast\ncoconut\ncode\ncoffee\ncoil\ncoin\ncollect\ncolor\ncolumn\ncombine\ncome\ncomfort\ncomic\ncommon\ncompany\nconcert\nconduct\nconfirm\ncongress\nconnect\nconsider\ncontrol\nconvince\ncook\ncool\ncopper\ncopy\ncoral\ncore\ncorn\ncorrect\ncost\ncotton\ncouch\ncountry\ncouple\ncourse\ncousin\ncover\ncoyote\ncrack\ncradle\ncraft\ncram\ncrane\ncrash\ncrater\ncrawl\ncrazy\ncream\ncredit\ncreek\ncrew\ncricket\ncrime\ncrisp\ncritic\ncrop\ncross\ncrouch\ncrowd\ncrucial\ncruel\ncruise\ncrumble\ncrunch\ncrush\ncry\ncrystal\ncube\nculture\ncup\ncupboard\ncurious\ncurrent\ncurtain\ncurve\ncushion\ncustom\ncute\ncycle\ndad\ndamage\ndamp\ndance\ndanger\ndaring\ndash\ndaughter\ndawn\nday\ndeal\ndebate\ndebris\ndecade\ndecember\ndecide\ndecline\ndecorate\ndecrease\ndeer\ndefense\ndefine\ndefy\ndegree\ndelay\ndeliver\ndemand\ndemise\ndenial\ndentist\ndeny\ndepart\ndepend\ndeposit\ndepth\ndeputy\nderive\ndescribe\ndesert\ndesign\ndesk\ndespair\ndestroy\ndetail\ndetect\ndevelop\ndevice\ndevote\ndiagram\ndial\ndiamond\ndiary\ndice\ndiesel\ndiet\ndiffer\ndigital\ndignity\ndilemma\ndinner\ndinosaur\ndirect\ndirt\ndisagree\ndiscover\ndisease\ndish\ndismiss\ndisorder\ndisplay\ndistance\ndivert\ndivide\ndivorce\ndizzy\ndoctor\ndocument\ndog\ndoll\ndolphin\ndomain\ndonate\ndonkey\ndonor\ndoor\ndose\ndouble\ndove\ndraft\ndragon\ndrama\ndrastic\ndraw\ndream\ndress\ndrift\ndrill\ndrink\ndrip\ndrive\ndrop\ndrum\ndry\nduck\ndumb\ndune\nduring\ndust\ndutch\nduty\ndwarf\ndynamic\neager\neagle\nearly\nearn\nearth\neasily\neast\neasy\necho\necology\neconomy\nedge\nedit\neducate\neffort\negg\neight\neither\nelbow\nelder\nelectric\nelegant\nelement\nelephant\nelevator\nelite\nelse\nembark\nembody\nembrace\nemerge\nemotion\nemploy\nempower\nempty\nenable\nenact\nend\nendless\nendorse\nenemy\nenergy\nenforce\nengage\nengine\nenhance\nenjoy\nenlist\nenough\nenrich\nenroll\nensure\nenter\nentire\nentry\nenvelope\nepisode\nequal\nequip\nera\nerase\nerode\nerosion\nerror\nerupt\nescape\nessay\nessence\nestate\neternal\nethics\nevidence\nevil\nevoke\nevolve\nexact\nexample\nexcess\nexchange\nexcite\nexclude\nexcuse\nexecute\nexercise\nexhaust\nexhibit\nexile\nexist\nexit\nexotic\nexpand\nexpect\nexpire\nexplain\nexpose\nexpress\nextend\nextra\neye\neyebrow\nfabric\nface\nfaculty\nfade\nfaint\nfaith\nfall\nfalse\nfame\nfamily\nfamous\nfan\nfancy\nfantasy\nfarm\nfashion\nfat\nfatal\nfather\nfatigue\nfault\nfavorite\nfeature\nfebruary\nfederal\nfee\nfeed\nfeel\nfemale\nfence\nfestival\nfetch\nfever\nfew\nfiber\nfiction\nfield\nfigure\nfile\nfilm\nfilter\nfinal\nfind\nfine\nfinger\nfinish\nfire\nfirm\nfirst\nfiscal\nfish\nfit\nfitness\nfix\nflag\nflame\nflash\nflat\nflavor\nflee\nflight\nflip\nfloat\nflock\nfloor\nflower\nfluid\nflush\nfly\nfoam\nfocus\nfog\nfoil\nfold\nfollow\nfood\nfoot\nforce\nforest\nforget\nfork\nfortune\nforum\nforward\nfossil\nfoster\nfound\nfox\nfragile\nframe\nfrequent\nfresh\nfriend\nfringe\nfrog\nfront\nfrost\nfrown\nfrozen\nfruit\nfuel\nfun\nfunny\nfurnace\nfury\nfuture\ngadget\ngain\ngalaxy\ngallery\ngame\ngap\ngarage\ngarbage\ngarden\ngarlic\ngarment\ngas\ngasp\ngate\ngather\ngauge\ngaze\ngeneral\ngenius\ngenre\ngentle\ngenuine\ngesture\nghost\ngiant\ngift\ngiggle\nginger\ngiraffe\ngirl\ngive\nglad\nglance\nglare\nglass\nglide\nglimpse\nglobe\ngloom\nglory\nglove\nglow\nglue\ngoat\ngoddess\ngold\ngood\ngoose\ngorilla\ngospel\ngossip\ngovern\ngown\ngrab\ngrace\ngrain\ngrant\ngrape\ngrass\ngravity\ngreat\ngreen\ngrid\ngrief\ngrit\ngrocery\ngroup\ngrow\ngrunt\nguard\nguess\nguide\nguilt\nguitar\ngun\ngym\nhabit\nhair\nhalf\nhammer\nhamster\nhand\nhappy\nharbor\nhard\nharsh\nharvest\nhat\nhave\nhawk\nhazard\nhead\nhealth\nheart\nheavy\nhedgehog\nheight\nhello\nhelmet\nhelp\nhen\nhero\nhidden\nhigh\nhill\nhint\nhip\nhire\nhistory\nhobby\nhockey\nhold\nhole\nholiday\nhollow\nhome\nhoney\nhood\nhope\nhorn\nhorror\nhorse\nhospital\nhost\nhotel\nhour\nhover\nhub\nhuge\nhuman\nhumble\nhumor\nhundred\nhungry\nhunt\nhurdle\nhurry\nhurt\nhusband\nhybrid\nice\nicon\nidea\nidentify\nidle\nignore\nill\nillegal\nillness\nimage\nimitate\nimmense\nimmune\nimpact\nimpose\nimprove\nimpulse\ninch\ninclude\nincome\nincrease\nindex\nindicate\nindoor\nindustry\ninfant\ninflict\ninform\ninhale\ninherit\ninitial\ninject\ninjury\ninmate\ninner\ninnocent\ninput\ninquiry\ninsane\ninsect\ninside\ninspire\ninstall\nintact\ninterest\ninto\ninvest\ninvite\ninvolve\niron\nisland\nisolate\nissue\nitem\nivory\njacket\njaguar\njar\njazz\njealous\njeans\njelly\njewel\njob\njoin\njoke\njourney\njoy\njudge\njuice\njump\njungle\njunior\njunk\njust\nkangaroo\nkeen\nkeep\nketchup\nkey\nkick\nkid\nkidney\nkind\nkingdom\nkiss\nkit\nkitchen\nkite\nkitten\nkiwi\nknee\nknife\nknock\nknow\nlab\nlabel\nlabor\nladder\nlady\nlake\nlamp\nlanguage\nlaptop\nlarge\nlater\nlatin\nlaugh\nlaundry\nlava\nlaw\nlawn\nlawsuit\nlayer\nlazy\nleader\nleaf\nlearn\nleave\nlecture\nleft\nleg\nlegal\nlegend\nleisure\nlemon\nlend\nlength\nlens\nleopard\nlesson\nletter\nlevel\nliar\nliberty\nlibrary\nlicense\nlife\nlift\nlight\nlike\nlimb\nlimit\nlink\nlion\nliquid\nlist\nlittle\nlive\nlizard\nload\nloan\nlobster\nlocal\nlock\nlogic\nlonely\nlong\nloop\nlottery\nloud\nlounge\nlove\nloyal\nlucky\nluggage\nlumber\nlunar\nlunch\nluxury\nlyrics\nmachine\nmad\nmagic\nmagnet\nmaid\nmail\nmain\nmajor\nmake\nmammal\nman\nmanage\nmandate\nmango\nmansion\nmanual\nmaple\nmarble\nmarch\nmargin\nmarine\nmarket\nmarriage\nmask\nmass\nmaster\nmatch\nmaterial\nmath\nmatrix\nmatter\nmaximum\nmaze\nmeadow\nmean\nmeasure\nmeat\nmechanic\nmedal\nmedia\nmelody\nmelt\nmember\nmemory\nmention\nmenu\nmercy\nmerge\nmerit\nmerry\nmesh\nmessage\nmetal\nmethod\nmiddle\nmidnight\nmilk\nmillion\nmimic\nmind\nminimum\nminor\nminute\nmiracle\nmirror\nmisery\nmiss\nmistake\nmix\nmixed\nmixture\nmobile\nmodel\nmodify\nmom\nmoment\nmonitor\nmonkey\nmonster\nmonth\nmoon\nmoral\nmore\nmorning\nmosquito\nmother\nmotion\nmotor\nmountain\nmouse\nmove\nmovie\nmuch\nmuffin\nmule\nmultiply\nmuscle\nmuseum\nmushroom\nmusic\nmust\nmutual\nmyself\nmystery\nmyth\nnaive\nname\nnapkin\nnarrow\nnasty\nnation\nnature\nnear\nneck\nneed\nnegative\nneglect\nneither\nnephew\nnerve\nnest\nnet\nnetwork\nneutral\nnever\nnews\nnext\nnice\nnight\nnoble\nnoise\nnominee\nnoodle\nnormal\nnorth\nnose\nnotable\nnote\nnothing\nnotice\nnovel\nnow\nnuclear\nnumber\nnurse\nnut\noak\nobey\nobject\noblige\nobscure\nobserve\nobtain\nobvious\noccur\nocean\noctober\nodor\noff\noffer\noffice\noften\noil\nokay\nold\nolive\nolympic\nomit\nonce\none\nonion\nonline\nonly\nopen\nopera\nopinion\noppose\noption\norange\norbit\norchard\norder\nordinary\norgan\norient\noriginal\norphan\nostrich\nother\noutdoor\nouter\noutput\noutside\noval\noven\nover\nown\nowner\noxygen\noyster\nozone\npact\npaddle\npage\npair\npalace\npalm\npanda\npanel\npanic\npanther\npaper\nparade\nparent\npark\nparrot\nparty\npass\npatch\npath\npatient\npatrol\npattern\npause\npave\npayment\npeace\npeanut\npear\npeasant\npelican\npen\npenalty\npencil\npeople\npepper\nperfect\npermit\nperson\npet\nphone\nphoto\nphrase\nphysical\npiano\npicnic\npicture\npiece\npig\npigeon\npill\npilot\npink\npioneer\npipe\npistol\npitch\npizza\nplace\nplanet\nplastic\nplate\nplay\nplease\npledge\npluck\nplug\nplunge\npoem\npoet\npoint\npolar\npole\npolice\npond\npony\npool\npopular\nportion\nposition\npossible\npost\npotato\npottery\npoverty\npowder\npower\npractice\npraise\npredict\nprefer\nprepare\npresent\npretty\nprevent\nprice\npride\nprimary\nprint\npriority\nprison\nprivate\nprize\nproblem\nprocess\nproduce\nprofit\nprogram\nproject\npromote\nproof\nproperty\nprosper\nprotect\nproud\nprovide\npublic\npudding\npull\npulp\npulse\npumpkin\npunch\npupil\npuppy\npurchase\npurity\npurpose\npurse\npush\nput\npuzzle\npyramid\nquality\nquantum\nquarter\nquestion\nquick\nquit\nquiz\nquote\nrabbit\nraccoon\nrace\nrack\nradar\nradio\nrail\nrain\nraise\nrally\nramp\nranch\nrandom\nrange\nrapid\nrare\nrate\nrather\nraven\nraw\nrazor\nready\nreal\nreason\nrebel\nrebuild\nrecall\nreceive\nrecipe\nrecord\nrecycle\nreduce\nreflect\nreform\nrefuse\nregion\nregret\nregular\nreject\nrelax\nrelease\nrelief\nrely\nremain\nremember\nremind\nremove\nrender\nrenew\nrent\nreopen\nrepair\nrepeat\nreplace\nreport\nrequire\nrescue\nresemble\nresist\nresource\nresponse\nresult\nretire\nretreat\nreturn\nreunion\nreveal\nreview\nreward\nrhythm\nrib\nribbon\nrice\nrich\nride\nridge\nrifle\nright\nrigid\nring\nriot\nripple\nrisk\nritual\nrival\nriver\nroad\nroast\nrobot\nrobust\nrocket\nromance\nroof\nrookie\nroom\nrose\nrotate\nrough\nround\nroute\nroyal\nrubber\nrude\nrug\nrule\nrun\nrunway\nrural\nsad\nsaddle\nsadness\nsafe\nsail\nsalad\nsalmon\nsalon\nsalt\nsalute\nsame\nsample\nsand\nsatisfy\nsatoshi\nsauce\nsausage\nsave\nsay\nscale\nscan\nscare\nscatter\nscene\nscheme\nschool\nscience\nscissors\nscorpion\nscout\nscrap\nscreen\nscript\nscrub\nsea\nsearch\nseason\nseat\nsecond\nsecret\nsection\nsecurity\nseed\nseek\nsegment\nselect\nsell\nseminar\nsenior\nsense\nsentence\nseries\nservice\nsession\nsettle\nsetup\nseven\nshadow\nshaft\nshallow\nshare\nshed\nshell\nsheriff\nshield\nshift\nshine\nship\nshiver\nshock\nshoe\nshoot\nshop\nshort\nshoulder\nshove\nshrimp\nshrug\nshuffle\nshy\nsibling\nsick\nside\nsiege\nsight\nsign\nsilent\nsilk\nsilly\nsilver\nsimilar\nsimple\nsince\nsing\nsiren\nsister\nsituate\nsix\nsize\nskate\nsketch\nski\nskill\nskin\nskirt\nskull\nslab\nslam\nsleep\nslender\nslice\nslide\nslight\nslim\nslogan\nslot\nslow\nslush\nsmall\nsmart\nsmile\nsmoke\nsmooth\nsnack\nsnake\nsnap\nsniff\nsnow\nsoap\nsoccer\nsocial\nsock\nsoda\nsoft\nsolar\nsoldier\nsolid\nsolution\nsolve\nsomeone\nsong\nsoon\nsorry\nsort\nsoul\nsound\nsoup\nsource\nsouth\nspace\nspare\nspatial\nspawn\nspeak\nspecial\nspeed\nspell\nspend\nsphere\nspice\nspider\nspike\nspin\nspirit\nsplit\nspoil\nsponsor\nspoon\nsport\nspot\nspray\nspread\nspring\nspy\nsquare\nsqueeze\nsquirrel\nstable\nstadium\nstaff\nstage\nstairs\nstamp\nstand\nstart\nstate\nstay\nsteak\nsteel\nstem\nstep\nstereo\nstick\nstill\nsting\nstock\nstomach\nstone\nstool\nstory\nstove\nstrategy\nstreet\nstrike\nstrong\nstruggle\nstudent\nstuff\nstumble\nstyle\nsubject\nsubmit\nsubway\nsuccess\nsuch\nsudden\nsuffer\nsugar\nsuggest\nsuit\nsummer\nsun\nsunny\nsunset\nsuper\nsupply\nsupreme\nsure\nsurface\nsurge\nsurprise\nsurround\nsurvey\nsuspect\nsustain\nswallow\nswamp\nswap\nswarm\nswear\nsweet\nswift\nswim\nswing\nswitch\nsword\nsymbol\nsymptom\nsyrup\nsystem\ntable\ntackle\ntag\ntail\ntalent\ntalk\ntank\ntape\ntarget\ntask\ntaste\ntattoo\ntaxi\nteach\nteam\ntell\nten\ntenant\ntennis\ntent\nterm\ntest\ntext\nthank\nthat\ntheme\nthen\ntheory\nthere\nthey\nthing\nthis\nthought\nthree\nthrive\nthrow\nthumb\nthunder\nticket\ntide\ntiger\ntilt\ntimber\ntime\ntiny\ntip\ntired\ntissue\ntitle\ntoast\ntobacco\ntoday\ntoddler\ntoe\ntogether\ntoilet\ntoken\ntomato\ntomorrow\ntone\ntongue\ntonight\ntool\ntooth\ntop\ntopic\ntopple\ntorch\ntornado\ntortoise\ntoss\ntotal\ntourist\ntoward\ntower\ntown\ntoy\ntrack\ntrade\ntraffic\ntragic\ntrain\ntransfer\ntrap\ntrash\ntravel\ntray\ntreat\ntree\ntrend\ntrial\ntribe\ntrick\ntrigger\ntrim\ntrip\ntrophy\ntrouble\ntruck\ntrue\ntruly\ntrumpet\ntrust\ntruth\ntry\ntube\ntuition\ntumble\ntuna\ntunnel\nturkey\nturn\nturtle\ntwelve\ntwenty\ntwice\ntwin\ntwist\ntwo\ntype\ntypical\nugly\numbrella\nunable\nunaware\nuncle\nuncover\nunder\nundo\nunfair\nunfold\nunhappy\nuniform\nunique\nunit\nuniverse\nunknown\nunlock\nuntil\nunusual\nunveil\nupdate\nupgrade\nuphold\nupon\nupper\nupset\nurban\nurge\nusage\nuse\nused\nuseful\nuseless\nusual\nutility\nvacant\nvacuum\nvague\nvalid\nvalley\nvalve\nvan\nvanish\nvapor\nvarious\nvast\nvault\nvehicle\nvelvet\nvendor\nventure\nvenue\nverb\nverify\nversion\nvery\nvessel\nveteran\nviable\nvibrant\nvicious\nvictory\nvideo\nview\nvillage\nvintage\nviolin\nvirtual\nvirus\nvisa\nvisit\nvisual\nvital\nvivid\nvocal\nvoice\nvoid\nvolcano\nvolume\nvote\nvoyage\nwage\nwagon\nwait\nwalk\nwall\nwalnut\nwant\nwarfare\nwarm\nwarrior\nwash\nwasp\nwaste\nwater\nwave\nway\nwealth\nweapon\nwear\nweasel\nweather\nweb\nwedding\nweekend\nweird\nwelcome\nwest\nwet\nwhale\nwhat\nwheat\nwheel\nwhen\nwhere\nwhip\nwhisper\nwide\nwidth\nwife\nwild\nwill\nwin\nwindow\nwine\nwing\nwink\nwinner\nwinter\nwire\nwisdom\nwise\nwish\nwitness\nwolf\nwoman\nwonder\nwood\nwool\nword\nwork\nworld\nworry\nworth\nwrap\nwreck\nwrestle\nwrist\nwrite\nwrong\nyard\nyear\nyellow\nyou\nyoung\nyouth\nzebra\nzero\nzone\nzoo".split("\n")}}]);